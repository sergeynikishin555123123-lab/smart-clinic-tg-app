<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–∫–∞–¥–µ–º–∏—è –ê–ù–ë</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app">
        <header class="header">
            <h1>–ê–∫–∞–¥–µ–º–∏—è –ê–ù–ë</h1>
            <div class="admin-badge" id="adminBadge" style="display: none;">üîß –ê–¥–º–∏–Ω</div>
        </header>

        <main class="main" id="mainContent">
            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è JavaScript -->
        </main>

        <nav class="nav">
            <button class="nav-btn active" data-page="home">üè† –î–æ–º–æ–π</button>
            <button class="nav-btn" data-page="courses">üìö –ö—É—Ä—Å—ã</button>
            <button class="nav-btn" data-page="content">üé¨ –ö–æ–Ω—Ç–µ–Ω—Ç</button>
            <button class="nav-btn" data-page="materials">üìö –ú–∞—Ç–µ—Ä–∏–∞–ª—ã</button>
            <button class="nav-btn" data-page="profile">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
        </nav>
    </div>

    <script>
        // ==================== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –°–¢–†–ê–ù–ò–¶ ====================
        const pages = {
            home: {
                title: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ê–∫–∞–¥–µ–º–∏—é –ê–ù–ë!',
                content: `
                    <div class="search">
                        <input type="text" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∫—É—Ä—Å–∞–º, –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º, —ç—Ñ–∏—Ä–∞–º..." class="search-input" id="searchInput">
                    </div>
                    
                    <div class="grid">
                        <div class="card" onclick="openSection('courses')">üìö –ö—É—Ä—Å—ã</div>
                        <div class="card" onclick="openSection('fm')">üéß –ê–ù–ë FM</div>
                        <div class="card" onclick="openSection('streams')">üìπ –≠—Ñ–∏—Ä—ã|–†–∞–∑–±–æ—Ä—ã</div>
                        <div class="card" onclick="openSection('cheats')">üéØ –í–∏–¥–µ–æ-—à–ø–∞—Ä–≥–∞–ª–∫–∏</div>
                        <div class="card" onclick="openSection('practice')">üìã –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã</div>
                        <div class="card" onclick="openSection('events')">üó∫Ô∏è –ö–∞—Ä—Ç–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π</div>
                        <div class="card" onclick="openSection('offers')">üî• –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</div>
                        <div class="card" onclick="openSection('support')">üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞</div>
                    </div>

                    <div class="news">
                        <h3>üì∞ –õ–µ–Ω—Ç–∞ –Ω–æ–≤–æ—Å—Ç–µ–π</h3>
                        <div class="filters">
                            <button class="filter active">–í—Å–µ</button>
                            <button class="filter">–°—Ç–∞—Ç—å–∏</button>
                            <button class="filter">–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ</button>
                            <button class="filter">–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–≤—ã–∫–∏</button>
                        </div>
                        <div class="news-list">
                            <div class="news-item">
                                <strong>–ù–æ–≤—ã–π –∫—É—Ä—Å: "–ú–∞–Ω—É–∞–ª—å–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ –≤ –ø—Ä–∞–∫—Ç–∏–∫–µ"</strong>
                                <p>–î–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –≤—Å–µ—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ ‚Ä¢ 6 –º–æ–¥—É–ª–µ–π</p>
                            </div>
                            <div class="news-item">
                                <strong>–í–µ–±–∏–Ω–∞—Ä –ø–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º –º–µ—Ç–æ–¥–∞–º —Ä–µ–∞–±–∏–ª–∏—Ç–∞—Ü–∏–∏</strong>
                                <p>28 –Ω–æ—è–±—Ä—è –≤ 19:00 ‚Ä¢ –°–ø–∏–∫–µ—Ä: –ò–ª—å—è –ß–∏—Å—Ç—è–∫–æ–≤</p>
                            </div>
                        </div>
                    </div>
                `
            },
            courses: {
                title: 'üìö –ö—É—Ä—Å—ã –ê–∫–∞–¥–µ–º–∏–∏',
                content: `
                    <div class="content-list" id="coursesList">
                        <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∫—É—Ä—Å–æ–≤...</div>
                    </div>
                `
            },
            content: {
                title: 'üé¨ –ú–µ–¥–∏–∞-–∫–æ–Ω—Ç–µ–Ω—Ç',
                content: `
                    <div class="tabs">
                        <button class="tab active" onclick="switchContentTab('podcasts')">üéß –ê–ù–ë FM</button>
                        <button class="tab" onclick="switchContentTab('streams')">üìπ –≠—Ñ–∏—Ä—ã</button>
                        <button class="tab" onclick="switchContentTab('videos')">üéØ –®–ø–∞—Ä–≥–∞–ª–∫–∏</button>
                    </div>
                    
                    <div class="tab-content active" id="podcasts">
                        <div class="content-list" id="podcastsList">
                            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–¥–∫–∞—Å—Ç–æ–≤...</div>
                        </div>
                    </div>
                    
                    <div class="tab-content" id="streams">
                        <div class="content-list" id="streamsList">
                            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —ç—Ñ–∏—Ä–æ–≤...</div>
                        </div>
                    </div>
                    
                    <div class="tab-content" id="videos">
                        <div class="content-list" id="videosList">
                            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ-—à–ø–∞—Ä–≥–∞–ª–æ–∫...</div>
                        </div>
                    </div>
                `
            },
            materials: {
                title: 'üìö –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã',
                content: `
                    <div class="materials-grid">
                        <div class="card" onclick="openMaterials('mri')">
                            <div class="card-icon">ü©ª</div>
                            <div>–ú–†–¢ —Ä–∞–∑–±–æ—Ä—ã</div>
                        </div>
                        <div class="card" onclick="openMaterials('cases')">
                            <div class="card-icon">üìã</div>
                            <div>–ö–ª–∏–Ω–∏—á–µ—Å–∫–∏–µ —Å–ª—É—á–∞–∏</div>
                        </div>
                        <div class="card" onclick="openMaterials('checklists')">
                            <div class="card-icon">‚úÖ</div>
                            <div>–ß–µ–∫-–ª–∏—Å—Ç—ã</div>
                        </div>
                    </div>
                    
                    <div class="materials-list" id="materialsList">
                        <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤...</div>
                    </div>
                `
            },
            profile: {
                title: 'üë§ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç',
                content: `
                    <div class="profile-header">
                        <div class="avatar">üë§</div>
                        <div class="profile-info">
                            <div class="name" id="userName">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
                            <div class="status">–ß–ª–µ–Ω –ê–∫–∞–¥–µ–º–∏–∏ –ê–ù–ë —Å <span id="joinDate">${new Date().toLocaleDateString('ru-RU', {month: 'long', year: 'numeric'})}</span></div>
                            <div class="subscription" id="subscriptionStatus">–ü–æ–¥–ø–∏—Å–∫–∞: –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞</div>
                            <button class="btn" onclick="changeSubscription()">–ò–∑–º–µ–Ω–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É</button>
                        </div>
                    </div>

                    <div class="journey">
                        <h3>üéØ –ú–æ–π –ø—É—Ç—å —Ä–∞–∑–≤–∏—Ç–∏—è</h3>
                        <div class="journey-steps">
                            <div class="step active">
                                <div class="step-number">1Ô∏è‚É£</div>
                                <div class="step-info">
                                    <div class="step-title">–ü–æ–Ω–∏–º–∞—é</div>
                                    <div class="step-progress">–ü—Ä–æ–≥—Ä–µ—Å—Å: 100%</div>
                                    <div class="step-hint">–ù–∞—á–∏–Ω–∞—é –∑–∞–º–µ—á–∞—Ç—å –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏</div>
                                </div>
                            </div>
                            <div class="step">
                                <div class="step-number">2Ô∏è‚É£</div>
                                <div class="step-info">
                                    <div class="step-title">–°–≤—è–∑—ã–≤–∞—é</div>
                                    <div class="step-progress">–ü—Ä–æ–≥—Ä–µ—Å—Å: 60%</div>
                                    <div class="step-hint">–ó–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏ —Å–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –≤ –µ–¥–∏–Ω—É—é –∫–∞—Ä—Ç–∏–Ω—É</div>
                                </div>
                            </div>
                            <div class="step">
                                <div class="step-number">3Ô∏è‚É£</div>
                                <div class="step-info">
                                    <div class="step-title">–ü—Ä–∏–º–µ–Ω—è—é</div>
                                    <div class="step-progress">–ü—Ä–æ–≥—Ä–µ—Å—Å: 20%</div>
                                    <div class="step-hint">–ò—Å–ø–æ–ª—å–∑—É—é –∑–Ω–∞–Ω–∏—è –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">üìö</div>
                            <div class="stat-title">–ü—Ä–æ–π–¥–µ–Ω–æ –∫—É—Ä—Å–æ–≤</div>
                            <div class="stat-value" id="coursesCompleted">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üéØ</div>
                            <div class="stat-title">–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</div>
                            <div class="stat-value" id="materialsWatched">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üë•</div>
                            <div class="stat-title">–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π</div>
                            <div class="stat-value" id="eventsAttended">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üíæ</div>
                            <div class="stat-title">–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ</div>
                            <div class="stat-value" id="materialsSaved">0</div>
                        </div>
                    </div>
                `
            }
        };

        // ==================== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================
        let currentPage = 'home';
        let currentUser = null;
        let allContent = {};

        function renderPage(page) {
            currentPage = page;
            const pageData = pages[page];
            
            document.getElementById('mainContent').innerHTML = `
                <div class="page">
                    <h2>${pageData.title}</h2>
                    ${pageData.content}
                </div>
            `;

            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.page === page);
            });

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            if (page === 'courses') loadCourses();
            if (page === 'content') loadContent();
            if (page === 'materials') loadMaterials();
            if (page === 'profile') updateProfileStats();

            console.log('‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞:', page);
        }

        async function loadCourses() {
            try {
                const response = await fetch('/api/content/courses');
                const data = await response.json();
                
                if (data.success) {
                    const coursesList = document.getElementById('coursesList');
                    coursesList.innerHTML = data.data.map(course => `
                        <div class="content-item">
                            <div class="content-icon">${course.image || 'üìö'}</div>
                            <div class="content-info">
                                <div class="content-title">${course.title}</div>
                                <div class="content-description">${course.description}</div>
                                <div class="content-meta">
                                    <span class="duration">${course.duration}</span>
                                    <span class="price">${course.price ? course.price + ' —Ä—É–±.' : '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ'}</span>
                                </div>
                            </div>
                            <button class="btn btn-small" onclick="enrollCourse(${course.id})">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è</button>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫—É—Ä—Å–æ–≤:', error);
            }
        }

        async function loadContent() {
            await loadPodcasts();
        }

        async function loadPodcasts() {
            try {
                const response = await fetch('/api/content/podcasts');
                const data = await response.json();
                
                if (data.success) {
                    const podcastsList = document.getElementById('podcastsList');
                    podcastsList.innerHTML = data.data.map(podcast => `
                        <div class="content-item">
                            <div class="content-icon">${podcast.audio || 'üéß'}</div>
                            <div class="content-info">
                                <div class="content-title">${podcast.title}</div>
                                <div class="content-description">${podcast.description}</div>
                                <div class="content-meta">
                                    <span class="duration">${podcast.duration}</span>
                                </div>
                            </div>
                            <button class="btn btn-small" onclick="playContent('podcast', ${podcast.id})">–°–ª—É—à–∞—Ç—å</button>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–¥–∫–∞—Å—Ç–æ–≤:', error);
            }
        }

        async function loadMaterials() {
            try {
                const response = await fetch('/api/content/materials');
                const data = await response.json();
                
                if (data.success) {
                    const materialsList = document.getElementById('materialsList');
                    materialsList.innerHTML = data.data.map(material => `
                        <div class="material-item">
                            <div class="material-icon">${material.file || 'üìÑ'}</div>
                            <div class="material-info">
                                <div class="material-title">${material.title}</div>
                                <div class="material-description">${material.description}</div>
                                <div class="material-type">${getMaterialType(material.type)}</div>
                            </div>
                            <button class="btn btn-small" onclick="openMaterial(${material.id})">–û—Ç–∫—Ä—ã—Ç—å</button>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤:', error);
            }
        }

        function getMaterialType(type) {
            const types = {
                'mri': '–ú–†–¢ —Ä–∞–∑–±–æ—Ä',
                'case': '–ö–ª–∏–Ω–∏—á–µ—Å–∫–∏–π —Å–ª—É—á–∞–π',
                'checklist': '–ß–µ–∫-–ª–∏—Å—Ç'
            };
            return types[type] || '–ú–∞—Ç–µ—Ä–∏–∞–ª';
        }

        function switchContentTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            const targetTab = document.getElementById(tabId);
            if (targetTab) {
                targetTab.classList.add('active');
                
                if (tabId === 'streams') loadStreams();
                if (tabId === 'videos') loadVideos();
            }
            event.target.classList.add('active');
        }

        async function loadStreams() {
            try {
                const response = await fetch('/api/content/streams');
                const data = await response.json();
                
                if (data.success) {
                    const streamsList = document.getElementById('streamsList');
                    streamsList.innerHTML = data.data.map(stream => `
                        <div class="content-item">
                            <div class="content-icon">${stream.video || 'üìπ'}</div>
                            <div class="content-info">
                                <div class="content-title">${stream.title}</div>
                                <div class="content-description">${stream.description}</div>
                                <div class="content-meta">
                                    <span class="duration">${stream.duration}</span>
                                </div>
                            </div>
                            <button class="btn btn-small" onclick="playContent('stream', ${stream.id})">–°–º–æ—Ç—Ä–µ—Ç—å</button>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —ç—Ñ–∏—Ä–æ–≤:', error);
            }
        }

        async function loadVideos() {
            try {
                const response = await fetch('/api/content/videos');
                const data = await response.json();
                
                if (data.success) {
                    const videosList = document.getElementById('videosList');
                    videosList.innerHTML = data.data.map(video => `
                        <div class="content-item">
                            <div class="content-icon">${video.video || 'üéØ'}</div>
                            <div class="content-info">
                                <div class="content-title">${video.title}</div>
                                <div class="content-description">${video.description}</div>
                                <div class="content-meta">
                                    <span class="duration">${video.duration}</span>
                                </div>
                            </div>
                            <button class="btn btn-small" onclick="playContent('video', ${video.id})">–°–º–æ—Ç—Ä–µ—Ç—å</button>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ:', error);
            }
        }

        function openSection(section) {
            const sections = {
                'courses': 'üìö –ö—É—Ä—Å—ã',
                'fm': 'üéß –ê–ù–ë FM', 
                'streams': 'üìπ –≠—Ñ–∏—Ä—ã –∏ –†–∞–∑–±–æ—Ä—ã',
                'cheats': 'üéØ –í–∏–¥–µ–æ-—à–ø–∞—Ä–≥–∞–ª–∫–∏',
                'practice': 'üìã –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã',
                'events': 'üó∫Ô∏è –ö–∞—Ä—Ç–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π',
                'offers': 'üî• –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ',
                'support': 'üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞'
            };
            
            alert(`üéØ –û—Ç–∫—Ä—ã–≤–∞–µ–º: ${sections[section] || section}`);
        }

        function openMaterials(type) {
            const types = {
                'mri': '–ú–†–¢ —Ä–∞–∑–±–æ—Ä—ã',
                'cases': '–ö–ª–∏–Ω–∏—á–µ—Å–∫–∏–µ —Å–ª—É—á–∞–∏',
                'checklists': '–ß–µ–∫-–ª–∏—Å—Ç—ã'
            };
            alert(`üìã –û—Ç–∫—Ä—ã–≤–∞–µ–º: ${types[type] || type}`);
        }

        function enrollCourse(courseId) {
            alert(`üéì –ó–∞–ø–∏—Å—å –Ω–∞ –∫—É—Ä—Å ID: ${courseId}\n\n–§—É–Ω–∫—Ü–∏—è –æ–ø–ª–∞—Ç—ã –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏.`);
        }

        function playContent(type, contentId) {
            const types = {
                'podcast': '–ü–æ–¥–∫–∞—Å—Ç',
                'stream': '–≠—Ñ–∏—Ä',
                'video': '–í–∏–¥–µ–æ-—à–ø–∞—Ä–≥–∞–ª–∫–∞'
            };
            alert(`‚ñ∂Ô∏è –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ: ${types[type]} ID: ${contentId}`);
        }

        function openMaterial(materialId) {
            alert(`üìÑ –û—Ç–∫—Ä—ã—Ç–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ ID: ${materialId}`);
        }

        function changeSubscription() {
            alert(`üí≥ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–æ–π\n\n–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å: ${currentUser?.subscription?.status === 'trial' ? '–ü—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥' : '–ù–µ –∞–∫—Ç–∏–≤–Ω–∞'}\n\n–î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–∞ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä—É.`);
        }

        function updateProfileStats() {
            if (!currentUser) return;
            
            document.getElementById('coursesCompleted').textContent = currentUser.progress.steps.coursesBought || 0;
            document.getElementById('materialsWatched').textContent = currentUser.progress.steps.materialsWatched || 0;
            document.getElementById('eventsAttended').textContent = currentUser.progress.steps.eventsParticipated || 0;
            document.getElementById('materialsSaved').textContent = currentUser.progress.steps.materialsSaved || 0;
        }

        // ==================== –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –° –ë–û–¢–û–ú ====================
        async function loadUserData() {
            try {
                if (window.Telegram && Telegram.WebApp) {
                    const tgUser = Telegram.WebApp.initDataUnsafe.user;
                    if (tgUser && tgUser.id) {
                        const response = await fetch(`/api/user/${tgUser.id}`);
                        const data = await response.json();
                        
                        if (data.success) {
                            currentUser = data.user;
                            updateUIWithUserData();
                        }
                    }
                }
            } catch (error) {
                console.log('‚ÑπÔ∏è –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ Telegram');
                if (window.Telegram && Telegram.WebApp) {
                    const tgUser = Telegram.WebApp.initDataUnsafe.user;
                    if (tgUser) {
                        currentUser = {
                            firstName: tgUser.first_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                            subscription: { status: 'inactive' },
                            progress: { steps: {} }
                        };
                        updateUIWithUserData();
                    }
                }
            }
        }

        function updateUIWithUserData() {
            if (!currentUser) return;
            
            const userNameElement = document.getElementById('userName');
            const subscriptionStatusElement = document.getElementById('subscriptionStatus');
            
            if (userNameElement) {
                userNameElement.textContent = currentUser.firstName;
            }
            
            if (subscriptionStatusElement) {
                let statusText = '–ü–æ–¥–ø–∏—Å–∫–∞: –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞';
                let statusClass = 'inactive';
                
                if (currentUser.subscription.status === 'trial') {
                    statusText = '–ü–æ–¥–ø–∏—Å–∫–∞: –ø—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥';
                    statusClass = 'active';
                }
                
                subscriptionStatusElement.textContent = statusText;
                subscriptionStatusElement.className = `subscription ${statusClass}`;
            }
            
            if (currentUser.id === 898508164) {
                document.getElementById('adminBadge').style.display = 'block';
            }
        }

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    renderPage(this.dataset.page);
                });
            });

            renderPage('home');
            loadUserData();

            if (window.Telegram && Telegram.WebApp) {
                Telegram.WebApp.expand();
                Telegram.WebApp.ready();
            }

            console.log('‚úÖ WebApp –∑–∞–≥—Ä—É–∂–µ–Ω!');
        });
    </script>
</body>
</html>
