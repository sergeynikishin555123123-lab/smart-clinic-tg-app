<!DOCTYPE html>
<html lang="ru" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Академия АНБ - Современное образование для врачей</title>
    <meta name="description" content="Академия АНБ - платформа для непрерывного медицинского образования">
    
    <!-- Telegram WebApp -->
    <script>
        if (!window.Telegram) {
            window.Telegram = {
                WebApp: {
                    initData: '',
                    initDataUnsafe: {},
                    version: '6.0',
                    platform: 'web',
                    viewportHeight: window.innerHeight,
                    viewportStableHeight: window.innerHeight,
                    isExpanded: true,
                    themeParams: {
                        bg_color: '#172554',
                        text_color: '#ffffff',
                        hint_color: '#aaaaaa',
                        link_color: '#3b82f6',
                        button_color: '#3b82f6',
                        button_text_color: '#ffffff'
                    },
                    ready: function() { console.log('Telegram WebApp ready (fallback)'); },
                    expand: function() { console.log('Telegram WebApp expand (fallback)'); },
                    showPopup: function() { console.log('Telegram WebApp showPopup (fallback)'); },
                    BackButton: {
                        isVisible: false,
                        show: function() { this.isVisible = true; },
                        hide: function() { this.isVisible = false; },
                        onClick: function(callback) { this.callback = callback; }
                    }
                }
            };
            console.log('✅ Telegram WebApp fallback loaded');
        }
    </script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <style>
        /* Все существующие стили остаются без изменений */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: #1e293b;
            --text-primary: #ffffff;
            --text-secondary: #94a3b8;
            --accent: #3b82f6;
            --accent-hover: #2563eb;
            --border: #334155;
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --info: #06b6d4;
            --light-bg: #f8fafc;
            --light-text: #1e293b;
            --light-secondary: #64748b;
        }
        
        [data-theme="light"] {
            --bg-primary: #f8fafc;
            --bg-secondary: #e2e8f0;
            --bg-card: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border: #cbd5e1;
        }
        
        body {
            margin: 0;
            padding: 0;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
            transition: background-color 0.3s, color 0.3s;
        }

        /* ==================== LOADING & ERROR STATES ==================== */
        
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: var(--bg-primary);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 9999;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top: 3px solid var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }
        
        .loading-text {
            color: var(--text-secondary);
            font-size: 16px;
        }
        
        .error-container {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: var(--bg-primary);
            text-align: center;
            padding: 20px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 9999;
        }
        
        #app {
            display: none;
            min-height: 100vh;
            background: var(--bg-primary);
        }

        /* ==================== LAYOUT STRUCTURE ==================== */
        
        .top-header {
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border);
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 999;
            backdrop-filter: blur(10px);
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .header-brand {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .brand-icon {
            font-size: 1.5rem;
        }

        .admin-badge {
            background: var(--warning);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            display: none;
        }

        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
            padding-bottom: 80px;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border);
            z-index: 1000;
            padding: 0.5rem 0;
        }

        .nav-scroll-container {
            display: flex;
            overflow-x: auto;
            gap: 0.5rem;
            padding: 0 1rem;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .nav-scroll-container::-webkit-scrollbar {
            display: none;
        }

        /* ==================== NAVIGATION BUTTONS ==================== */
        
        .bottom-nav .nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: none;
            border: none;
            color: var(--text-secondary);
            padding: 0.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 60px;
            position: relative;
            flex-shrink: 0;
        }

        .bottom-nav .nav-btn:hover,
        .bottom-nav .nav-btn.active {
            background: var(--accent);
            color: white;
        }

        .nav-icon {
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
        }

        .nav-label {
            font-size: 0.7rem;
            white-space: nowrap;
        }

        .nav-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            background: var(--error);
            color: white;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            font-size: 0.6rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ==================== HOME PAGE STYLES ==================== */
        
        .home-page {
            padding-bottom: 100px;
        }

        .hero-section {
            background: linear-gradient(135deg, var(--accent), #1e40af);
            border-radius: 1rem;
            padding: 2rem 1.5rem;
            margin-bottom: 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=800&h=400&fit=crop') center/cover;
            opacity: 0.1;
        }

        .hero-content {
            position: relative;
            z-index: 2;
        }

        .hero-content h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        .hero-subtitle {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        .hero-search {
            display: flex;
            gap: 1rem;
            max-width: 500px;
            margin: 0 auto 2rem auto;
        }

        .search-input {
            flex: 1;
            padding: 1rem;
            border: none;
            border-radius: 0.75rem;
            background: rgba(255, 255, 255, 0.9);
            font-size: 1rem;
            color: #1e293b;
        }

        .search-btn {
            padding: 1rem 1.5rem;
            border: none;
            border-radius: 0.75rem;
            background: var(--accent);
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .search-btn:hover {
            background: var(--accent-hover);
        }

        .hero-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        .stat {
            text-align: center;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
            backdrop-filter: blur(10px);
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.875rem;
            opacity: 0.9;
        }

        /* ==================== MAIN NAVIGATION GRID ==================== */
        
        .main-navigation-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .nav-card-large {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 1rem;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            aspect-ratio: 1.6;
        }

        .nav-card-large:hover {
            transform: translateY(-5px);
            border-color: var(--accent);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .nav-card-image {
            position: relative;
            height: 100%;
            overflow: hidden;
        }

        .nav-card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .nav-card-large:hover .nav-card-image img {
            transform: scale(1.05);
        }

        .nav-card-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.9), rgba(30, 64, 175, 0.8));
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            padding: 1.5rem;
        }

        .nav-card-icon {
            font-size: 2.5rem;
            margin-bottom: 0.75rem;
        }

        .nav-card-overlay h3 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        .nav-card-overlay p {
            font-size: 0.875rem;
            opacity: 0.9;
        }

        .nav-count {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 1rem;
            font-size: 0.75rem;
        }

        /* ==================== CONTENT SECTIONS ==================== */
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .quick-nav-section,
        .featured-section,
        .streams-section,
        .events-section,
        .news-section,
        .learning-stats-section {
            margin-bottom: 3rem;
        }

        .section-divider {
            height: 1px;
            background: var(--border);
            margin: 2rem 0;
        }

        /* ==================== CONTENT GRID & CARDS ==================== */
        
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .content-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            overflow: hidden;
            transition: all 0.3s;
            position: relative;
        }

        .content-card:hover {
            transform: translateY(-4px);
            border-color: var(--accent);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .card-image {
            position: relative;
            height: 200px;
            overflow: hidden;
        }

        .card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }

        .content-card:hover .card-image img {
            transform: scale(1.05);
        }

        .card-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: flex-start;
            justify-content: flex-end;
            padding: 1rem;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .content-card:hover .card-overlay {
            opacity: 1;
        }

        .favorite-btn,
        .play-btn,
        .preview-btn,
        .download-btn {
            background: rgba(0, 0, 0, 0.7);
            border: none;
            color: white;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin-left: 0.5rem;
            transition: all 0.3s;
        }

        .favorite-btn.active {
            background: var(--error);
        }

        .favorite-btn:hover,
        .play-btn:hover,
        .preview-btn:hover,
        .download-btn:hover {
            transform: scale(1.1);
        }

        .card-content {
            padding: 1.5rem;
        }

        .card-category {
            color: var(--accent);
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }

        .card-title {
            font-size: 1.125rem;
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }

        .card-description {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .card-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .meta-item {
            color: var(--text-secondary);
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .price-section {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .price-original {
            color: var(--text-secondary);
            text-decoration: line-through;
            font-size: 0.875rem;
        }

        .price-current {
            font-weight: bold;
            color: var(--accent);
        }

        /* ==================== BUTTONS ==================== */
        
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-hover);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-primary);
        }

        .btn-outline:hover {
            background: var(--bg-secondary);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-small {
            padding: 0.375rem 0.75rem;
            font-size: 0.75rem;
        }

        .btn-large {
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
        }

        /* ==================== BADGES ==================== */
        
        .featured-badge,
        .discount-badge,
        .live-badge,
        .progress-badge {
            position: absolute;
            top: 1rem;
            left: 1rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .featured-badge {
            background: var(--warning);
            color: white;
        }

        .discount-badge {
            background: var(--error);
            color: white;
        }

        .live-badge {
            background: var(--error);
            color: white;
        }

        .progress-badge {
            background: var(--success);
            color: white;
        }

        /* ==================== PROGRESS & STATS ==================== */
        
        .progress-section {
            margin: 1rem 0;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        .progress-bar {
            background: var(--bg-primary);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            background: var(--accent);
            height: 100%;
            transition: width 0.3s;
        }

        .progress-text {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .stat-card.large {
            grid-column: span 1;
        }

        .stat-icon {
            font-size: 2rem;
            background: var(--accent);
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .stat-content {
            flex: 1;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }

        .stat-trend {
            color: var(--success);
            font-size: 0.75rem;
        }

        /* ==================== NEWS & EVENTS ==================== */
        
        .news-filters {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.875rem;
        }

        .filter-btn.active,
        .filter-btn:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .news-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .events-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .events-timeline {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        /* ==================== MODALS ==================== */
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: 1rem;
            max-width: 90vw;
            max-height: 90vh;
            width: 100%;
            overflow: hidden;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: bold;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.25rem;
        }

        .modal-close:hover {
            background: var(--bg-secondary);
        }

        .modal-body {
            padding: 1.5rem;
            max-height: 70vh;
            overflow-y: auto;
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        /* ==================== MEDIA PLAYER ==================== */
        
        .media-player {
            width: 100%;
            background: #000;
            border-radius: 0.5rem;
            overflow: hidden;
        }

        .media-player video,
        .media-player audio {
            width: 100%;
            display: block;
        }

        .audio-player {
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: 0.5rem;
        }

        .audio-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .audio-cover {
            width: 80px;
            height: 80px;
            border-radius: 0.5rem;
            object-fit: cover;
        }

        .audio-details {
            flex: 1;
        }

        .audio-title {
            font-size: 1.125rem;
            margin-bottom: 0.25rem;
        }

        .audio-author {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .audio-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .audio-progress {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .progress-bar-container {
            background: var(--bg-primary);
            height: 4px;
            border-radius: 2px;
            overflow: hidden;
            cursor: pointer;
        }

        .progress-bar-fill {
            background: var(--accent);
            height: 100%;
            width: 0%;
            transition: width 0.1s;
        }

        .time-display {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .control-btn {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn:hover {
            background: var(--bg-secondary);
        }

        /* ==================== NOTIFICATIONS ==================== */
        
        .notification {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            padding: 1rem;
            max-width: 300px;
            z-index: 1002;
            animation: slideIn 0.3s ease-out;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .notification-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            margin-left: auto;
            padding: 0.25rem;
            border-radius: 0.25rem;
        }

        .notification-close:hover {
            background: var(--bg-secondary);
        }

        /* ==================== EMPTY STATES ==================== */
        
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-secondary);
        }

        .empty-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .empty-title {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
        }

        .empty-description {
            font-size: 0.875rem;
            margin-bottom: 1.5rem;
        }

        .empty-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* ==================== FORMS ==================== */
        
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--accent);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        /* ==================== ADMIN PANEL ==================== */
        
        .admin-panel {
            padding: 1rem;
        }

        .admin-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--border);
            padding-bottom: 0.5rem;
        }

        .admin-tab {
            padding: 0.75rem 1.5rem;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 0.5rem 0.5rem 0 0;
            transition: all 0.3s;
        }

        .admin-tab.active {
            background: var(--accent);
            color: white;
        }

        .admin-content {
            background: var(--bg-card);
            border-radius: 0.75rem;
            padding: 1.5rem;
            border: 1px solid var(--border);
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .admin-stat {
            background: var(--bg-secondary);
            padding: 1.5rem;
            border-radius: 0.75rem;
            text-align: center;
        }

        .admin-stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .admin-stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
        }

        .admin-table th,
        .admin-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .admin-table th {
            background: var(--bg-secondary);
            font-weight: 600;
        }

        .admin-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* ==================== ANIMATIONS ==================== */
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* ==================== RESPONSIVE DESIGN ==================== */
        
        @media (max-width: 768px) {
            .header-brand .brand-text {
                display: none;
            }
            
            .nav-label {
                font-size: 0.65rem;
            }
            
            .bottom-nav .nav-btn {
                min-width: 50px;
                padding: 0.4rem;
            }

            .hero-content h1 {
                font-size: 2rem;
            }

            .hero-subtitle {
                font-size: 1rem;
            }

            .hero-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .hero-search {
                flex-direction: column;
            }

            .main-navigation-grid {
                grid-template-columns: 1fr;
            }

            .content-grid {
                grid-template-columns: 1fr;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .stats-cards {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .admin-tabs {
                flex-wrap: wrap;
            }

            .admin-table {
                display: block;
                overflow-x: auto;
            }
        }

        @media (max-width: 480px) {
            .main-content {
                padding: 0.5rem;
            }
            
            .hero-section {
                padding: 1.5rem 1rem;
                margin-bottom: 1.5rem;
            }

            .hero-content h1 {
                font-size: 1.75rem;
            }

            .nav-card-overlay {
                padding: 1rem;
            }

            .nav-card-overlay h3 {
                font-size: 1.1rem;
            }

            .nav-scroll-container {
                padding: 0 0.5rem;
            }
            
            .bottom-nav .nav-btn {
                min-width: 45px;
            }
            
            .nav-icon {
                font-size: 1.1rem;
            }
            
            .nav-label {
                font-size: 0.6rem;
            }

            .modal-content {
                max-width: 95vw;
                max-height: 95vh;
            }
        }

        /* ==================== FOOTER ==================== */
        
        .main-footer {
            background: var(--bg-secondary);
            border-top: 1px solid var(--border);
            margin-top: 3rem;
        }

        .footer-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }

        .footer-section h3 {
            margin-bottom: 1rem;
        }

        .footer-links {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .footer-links a {
            color: var(--text-secondary);
            text-decoration: none;
        }

        .footer-links a:hover {
            color: var(--accent);
        }

        .footer-bottom {
            border-top: 1px solid var(--border);
            padding: 1rem;
            text-align: center;
            color: var(--text-secondary);
        }

        /* ==================== DETAIL PAGES ==================== */
        
        .detail-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .back-btn {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .back-btn:hover {
            background: var(--bg-secondary);
        }

        .detail-content {
            background: var(--bg-card);
            border-radius: 1rem;
            padding: 2rem;
            border: 1px solid var(--border);
            margin-bottom: 2rem;
        }

        .detail-image {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .detail-meta {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .detail-meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .detail-description {
            line-height: 1.6;
            margin-bottom: 1.5rem;
        }

        .detail-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .module-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .module-item {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .module-item:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .module-icon {
            font-size: 1.5rem;
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            background: var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .module-content {
            flex: 1;
        }

        .module-title {
            font-size: 1.125rem;
            margin-bottom: 0.5rem;
        }

        .module-description {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .module-duration {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .instructor-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .instructor-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
        }

        .instructor-info {
            flex: 1;
        }

        .instructor-name {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
        }

        .instructor-specialization {
            color: var(--accent);
            margin-bottom: 0.5rem;
        }

        .instructor-bio {
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.5;
        }

        /* ==================== CONTENT FILTERS ==================== */
        
        .content-filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-select {
            padding: 0.5rem;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            background: var(--bg-card);
            color: var(--text-primary);
            min-width: 150px;
        }

        /* ==================== TABS ==================== */
        
        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .tab-btn {
            padding: 0.75rem 1.5rem;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 0.5rem 0.5rem 0 0;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: var(--accent);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        /* ==================== COMMUNITY STYLES ==================== */
        .community-container {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 2rem;
        }

        .community-feed {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .community-post {
            background: var(--bg-card);
            border-radius: 0.75rem;
            padding: 1.5rem;
            border: 1px solid var(--border);
        }

        .post-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .post-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .post-author {
            font-weight: bold;
        }

        .post-time {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .post-content {
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .post-actions {
            display: flex;
            gap: 1rem;
        }

        .post-action {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: all 0.3s;
        }

        .post-action:hover {
            background: var(--bg-secondary);
        }

        .community-sidebar {
            background: var(--bg-card);
            border-radius: 0.75rem;
            padding: 1.5rem;
            border: 1px solid var(--border);
            height: fit-content;
        }

        .sidebar-section {
            margin-bottom: 2rem;
        }

        .sidebar-section:last-child {
            margin-bottom: 0;
        }

        .sidebar-title {
            font-size: 1.125rem;
            margin-bottom: 1rem;
            font-weight: bold;
        }

        .expert-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .expert-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem;
            border-radius: 0.5rem;
            transition: all 0.3s;
            cursor: pointer;
        }

        .expert-item:hover {
            background: var(--bg-secondary);
        }

        .expert-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .expert-info {
            flex: 1;
        }

        .expert-name {
            font-weight: bold;
            font-size: 0.875rem;
        }

        .expert-specialty {
            color: var(--text-secondary);
            font-size: 0.75rem;
        }

        .online-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
        }

        /* ==================== CHAT STYLES ==================== */
        .chats-container {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 2rem;
            height: 70vh;
        }

        .chats-list {
            background: var(--bg-card);
            border-radius: 0.75rem;
            border: 1px solid var(--border);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .chats-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .chats-search {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .chat-items {
            flex: 1;
            overflow-y: auto;
        }

        .chat-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.3s;
        }

        .chat-item:hover, .chat-item.active {
            background: var(--bg-secondary);
        }

        .chat-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
        }

        .chat-info {
            flex: 1;
        }

        .chat-name {
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .chat-preview {
            color: var(--text-secondary);
            font-size: 0.875rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-meta {
            text-align: right;
        }

        .chat-time {
            color: var(--text-secondary);
            font-size: 0.75rem;
            margin-bottom: 0.25rem;
        }

        .chat-unread {
            background: var(--accent);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
        }

        .chat-window {
            background: var(--bg-card);
            border-radius: 0.75rem;
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .chat-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .chat-messages {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            max-width: 70%;
            padding: 1rem;
            border-radius: 1rem;
            position: relative;
        }

        .message.incoming {
            background: var(--bg-secondary);
            align-self: flex-start;
            border-bottom-left-radius: 0.25rem;
        }

        .message.outgoing {
            background: var(--accent);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 0.25rem;
        }

        .message-time {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-top: 0.5rem;
            text-align: right;
        }

        .chat-input {
            padding: 1.5rem;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 1rem;
        }

        .message-input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 2rem;
            background: var(--bg-secondary);
            color: var(--text-primary);
            resize: none;
        }

        .send-btn {
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        /* ==================== NEWS DETAIL STYLES ==================== */
        .news-detail {
            background: var(--bg-card);
            border-radius: 0.75rem;
            padding: 2rem;
            border: 1px solid var(--border);
        }

        .news-detail-header {
            margin-bottom: 2rem;
        }

        .news-detail-title {
            font-size: 2rem;
            margin-bottom: 1rem;
            line-height: 1.3;
        }

        .news-detail-meta {
            display: flex;
            gap: 1rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .news-detail-image {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
            border-radius: 0.75rem;
            margin-bottom: 2rem;
        }

        .news-detail-content {
            line-height: 1.7;
            font-size: 1.125rem;
        }

        .news-detail-content p {
            margin-bottom: 1.5rem;
        }

        .news-detail-content h2, .news-detail-content h3 {
            margin: 2rem 0 1rem 0;
        }

        .news-detail-content ul, .news-detail-content ol {
            margin-bottom: 1.5rem;
            padding-left: 2rem;
        }

        .news-detail-content li {
            margin-bottom: 0.5rem;
        }

        /* ==================== MATERIAL DETAIL STYLES ==================== */
        .material-detail {
            background: var(--bg-card);
            border-radius: 0.75rem;
            padding: 2rem;
            border: 1px solid var(--border);
        }

        .material-viewer {
            width: 100%;
            height: 600px;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            background: var(--bg-primary);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .material-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        /* ==================== COURSE MODULE STYLES ==================== */
        .module-player {
            background: var(--bg-card);
            border-radius: 0.75rem;
            padding: 2rem;
            border: 1px solid var(--border);
        }

        .module-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .module-content {
            margin-bottom: 2rem;
        }

        .module-quiz {
            background: var(--bg-secondary);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-top: 2rem;
        }

        .quiz-question {
            font-size: 1.125rem;
            margin-bottom: 1.5rem;
            font-weight: bold;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .quiz-option {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quiz-option:hover {
            background: var(--bg-primary);
        }

        .quiz-option.selected {
            border-color: var(--accent);
            background: var(--accent);
            color: white;
        }

        .quiz-submit {
            background: var(--success);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: bold;
        }

        /* ==================== AUTH MODAL STYLES ==================== */
        .auth-modal {
            max-width: 400px;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .auth-tab {
            flex: 1;
            padding: 1rem;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }

        .auth-tab.active {
            color: var(--accent);
            border-bottom-color: var(--accent);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .form-footer {
            text-align: center;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border);
        }

        .form-link {
            color: var(--accent);
            cursor: pointer;
            text-decoration: underline;
        }

        .form-link:hover {
            color: var(--accent-hover);
        }
    </style>
</head>
<body>
    <!-- Загрузочный экран -->
    <div id="loadingScreen" class="loading-container">
        <div class="loading-spinner"></div>
        <div class="loading-text">Загрузка Академии АНБ...</div>
    </div>
    
    <!-- Экран ошибки -->
    <div id="errorScreen" class="error-container">
        <div class="error-icon">⚠️</div>
        <div class="error-title">Ошибка загрузки</div>
        <div class="error-description" id="errorMessage">Не удалось загрузить приложение</div>
        <button id="retryButton" class="btn btn-primary">Попробовать снова</button>
    </div>

    <!-- Основное приложение -->
    <div id="app">
        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <div class="nav-scroll-container">
                <button class="nav-btn active" data-page="home">
                    <span class="nav-icon">🏠</span>
                    <span class="nav-label">Главная</span>
                </button>
                <button class="nav-btn" data-page="courses">
                    <span class="nav-icon">📚</span>
                    <span class="nav-label">Курсы</span>
                </button>
                <button class="nav-btn" data-page="materials">
                    <span class="nav-icon">📋</span>
                    <span class="nav-label">Материалы</span>
                </button>
                <button class="nav-btn" data-page="streams">
                    <span class="nav-icon">📹</span>
                    <span class="nav-label">Эфиры</span>
                </button>
                <button class="nav-btn" data-page="events">
                    <span class="nav-icon">🗺️</span>
                    <span class="nav-label">Мероприятия</span>
                </button>
                <button class="nav-btn" data-page="community">
                    <span class="nav-icon">👥</span>
                    <span class="nav-label">Сообщество</span>
                </button>
                <button class="nav-btn" data-page="chats">
                    <span class="nav-icon">💬</span>
                    <span class="nav-label">Чаты</span>
                </button>
                <button class="nav-btn" data-page="profile">
                    <span class="nav-icon">👤</span>
                    <span class="nav-label">Профиль</span>
                </button>
            </div>
        </nav>

        <!-- Top Header -->
        <header class="top-header">
            <div class="header-container">
                <div class="header-brand">
                    <span class="brand-icon">🎓</span>
                    <span class="brand-text">Академия АНБ</span>
                </div>
                <div class="header-actions">
                    <div id="adminBadge" class="admin-badge">🔧 Админ</div>
                    <button id="authButton" class="btn btn-outline btn-small" onclick="app.showAuthModal()">Войти</button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main id="mainContent" class="main-content">
            <!-- Контент будет загружен через JavaScript -->
        </main>

        <!-- Footer -->
        <footer class="main-footer">
            <div class="footer-container">
                <div class="footer-section">
                    <h3>Академия АНБ</h3>
                    <p>Современное образование для врачей</p>
                </div>
                <div class="footer-section">
                    <h3>Ресурсы</h3>
                    <div class="footer-links">
                        <a href="javascript:void(0)" onclick="app.renderPage('courses')">Все курсы</a>
                        <a href="javascript:void(0)" onclick="app.renderPage('materials')">Материалы</a>
                        <a href="javascript:void(0)" onclick="app.renderPage('community')">О сообществе</a>
                    </div>
                </div>
                <div class="footer-section">
                    <h3>Помощь</h3>
                    <div class="footer-links">
                        <a href="javascript:void(0)" onclick="app.showNotification('Для поддержки напишите @anb_support', 'info')">Поддержка</a>
                        <a href="javascript:void(0)" onclick="app.renderPage('community')">Правила</a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Академия АНБ. Все права защищены.</p>
            </div>
        </footer>
    </div>

    <!-- Модальные окна -->
    <div id="mediaModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="mediaModalTitle">Медиа</div>
                <button class="modal-close" onclick="app.closeMediaModal()">×</button>
            </div>
            <div class="modal-body" id="mediaModalBody">
                <!-- Контент медиа будет загружен сюда -->
            </div>
        </div>
    </div>

    <div id="subscriptionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Выбор подписки</div>
                <button class="modal-close" onclick="app.closeSubscriptionModal()">×</button>
            </div>
            <div class="modal-body" id="subscriptionModalBody">
                <!-- Контент подписки будет загружен сюда -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="app.closeSubscriptionModal()">Отмена</button>
                <button class="btn btn-primary" onclick="app.processSubscription()">Оформить подписку</button>
            </div>
        </div>
    </div>

    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Настройки</div>
                <button class="modal-close" onclick="app.closeSettingsModal()">×</button>
            </div>
            <div class="modal-body" id="settingsModalBody">
                <!-- Настройки будут загружены сюда -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="app.closeSettingsModal()">Отмена</button>
                <button class="btn btn-primary" onclick="app.saveSettings()">Сохранить</button>
            </div>
        </div>
    </div>

    <div id="authModal" class="modal">
        <div class="modal-content auth-modal">
            <div class="modal-header">
                <div class="modal-title">Вход в Академию АНБ</div>
                <button class="modal-close" onclick="app.closeAuthModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="auth-tabs">
                    <button class="auth-tab active" onclick="app.switchAuthTab('login')">Вход</button>
                    <button class="auth-tab" onclick="app.switchAuthTab('register')">Регистрация</button>
                </div>
                
                <form id="loginForm" class="auth-form active">
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="loginEmail" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Пароль</label>
                        <input type="password" class="form-input" id="loginPassword" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-large" style="width: 100%;">Войти</button>
                    <div class="form-footer">
                        <span>Нет аккаунта? </span>
                        <span class="form-link" onclick="app.switchAuthTab('register')">Зарегистрироваться</span>
                    </div>
                </form>

                <form id="registerForm" class="auth-form">
                    <div class="form-group">
                        <label class="form-label">Имя</label>
                        <input type="text" class="form-input" id="registerFirstName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Фамилия</label>
                        <input type="text" class="form-input" id="registerLastName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="registerEmail" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Пароль</label>
                        <input type="password" class="form-input" id="registerPassword" required minlength="6">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Специализация</label>
                        <input type="text" class="form-input" id="registerSpecialization">
                    </div>
                    <button type="submit" class="btn btn-primary btn-large" style="width: 100%;">Зарегистрироваться</button>
                    <div class="form-footer">
                        <span>Уже есть аккаунт? </span>
                        <span class="form-link" onclick="app.switchAuthTab('login')">Войти</span>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // ==================== API SERVICE ====================

        class ApiService {
            constructor() {
                this.baseURL = window.location.origin;
                this.token = localStorage.getItem('authToken');
            }

            setToken(token) {
                this.token = token;
                localStorage.setItem('authToken', token);
            }

            getHeaders() {
                const headers = {
                    'Content-Type': 'application/json'
                };
                
                if (this.token) {
                    headers['Authorization'] = `Bearer ${this.token}`;
                }
                
                return headers;
            }

            async request(endpoint, options = {}) {
                const url = `${this.baseURL}${endpoint}`;
                const config = {
                    headers: this.getHeaders(),
                    ...options
                };

                try {
                    const response = await fetch(url, config);
                    const data = await response.json();

                    if (!response.ok) {
                        throw new Error(data.error || `HTTP error! status: ${response.status}`);
                    }

                    return data;
                } catch (error) {
                    console.error(`API Request failed: ${endpoint}`, error);
                    throw error;
                }
            }

            // Аутентификация
            async login(email, password) {
                return this.request('/api/auth/login', {
                    method: 'POST',
                    body: JSON.stringify({ email, password })
                });
            }

            async register(userData) {
                return this.request('/api/auth/register', {
                    method: 'POST',
                    body: JSON.stringify(userData)
                });
            }

            // Пользователи
            async getProfile() {
                return this.request('/api/user/profile');
            }

            async updateProfile(profileData) {
                return this.request('/api/user/profile', {
                    method: 'PUT',
                    body: JSON.stringify(profileData)
                });
            }

            // Контент
            async getContent(type, params = {}) {
                const queryParams = new URLSearchParams(params).toString();
                return this.request(`/api/content/${type}?${queryParams}`);
            }

            async getCourseDetail(id) {
                return this.request(`/api/courses/${id}/detailed`);
            }

            // Категории
            async getCategories(type) {
                return this.request(`/api/categories/${type}`);
            }

            // Избранное
            async toggleFavorite(contentId, contentType) {
                return this.request('/api/favorites/toggle', {
                    method: 'POST',
                    body: JSON.stringify({ contentId, contentType })
                });
            }

            async getFavorites() {
                return this.request('/api/favorites');
            }

            // Подписки
            async getSubscriptionPlans() {
                return this.request('/api/subscription/plans');
            }

            async createSubscription(planId, planType) {
                return this.request('/api/subscription/create', {
                    method: 'POST',
                    body: JSON.stringify({ planId, planType })
                });
            }

            // Навигация
            async getNavigation() {
                return this.request('/api/navigation');
            }

            // Админ
            async getAdminStats() {
                return this.request('/api/admin/stats');
            }

            async getAdminUsers(params = {}) {
                const queryParams = new URLSearchParams(params).toString();
                return this.request(`/api/admin/users?${queryParams}`);
            }
        }

        // ==================== MAIN APPLICATION ====================

        class AcademyApp {
            constructor() {
                console.log('🎓 Создание экземпляра AcademyApp...');
                
                // Инициализация API сервиса
                this.api = new ApiService();
                
                // Инициализация состояния
                this.currentPage = 'home';
                this.currentSubPage = '';
                this.isAuthenticated = false;
                this.isAdmin = false;
                this.isSuperAdmin = false;
                this.allContent = {};
                this.categories = {};
                this.navigationItems = [];
                
                this.state = {
                    favorites: {
                        courses: [],
                        materials: [],
                        streams: [],
                        events: []
                    },
                    progress: {},
                    settings: {
                        notifications: true,
                        autoPlay: false,
                        theme: 'dark',
                        language: 'ru'
                    }
                };
                
                this.filters = {
                    courses: { category: 'all', level: 'all', sort: 'newest', search: '' },
                    materials: { category: 'all', material_type: 'all', sort: 'newest', search: '' },
                    streams: { category: 'all', sort: 'newest', search: '' },
                    events: { category: 'all', sort: 'newest', search: '' }
                };
                
                this.subscriptionState = {
                    selectedPlan: null,
                    selectedPeriod: 'monthly'
                };
                
                this.mediaPlayers = {
                    video: null,
                    audio: null
                };
                
                this.currentNewsFilter = 'Все';
                this.subscriptionPlans = [];
                this.userSubscription = null;
                this.instructors = [];
                this.currentUser = null;
                this.searchTerm = '';
                this.notifications = [];
                this.currentAudioPlayer = null;
                this.currentVideoPlayer = null;
                this.currentChat = null;
                this.communityPosts = [];
                this.chats = [];
                this.currentModule = null;
                this.currentQuizAnswers = {};
                
                // Конфигурация
                this.config = {
                    API_BASE_URL: window.location.origin,
                    UPLOAD_LIMIT: 50 * 1024 * 1024 // 50MB
                };

                // Восстановление состояния
                this.restoreState();
            }

    // ==================== ДЕМО-ДАННЫЕ ====================

    createDemoContent() {
        this.allContent = this.getDemoContentData();
    }

    getDemoContentData() {
        return {
            courses: [
                {
                    id: 1,
                    title: 'Мануальные техники в практике невролога',
                    description: '6 модулей по современным мануальным методикам',
                    price: 25000,
                    discount: 16,
                    duration: '12 недель',
                    modules: 6,
                    category: 'Мануальные техники',
                    level: 'advanced',
                    students_count: 156,
                    rating: 4.8,
                    featured: true,
                    image_url: 'https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400&h=250&fit=crop',
                    video_url: '',
                    created_at: new Date().toISOString(),
                    instructors: [1, 2]
                },
                {
                    id: 2,
                    title: 'Неврологическая диагностика',
                    description: '5 модулей по современной диагностике',
                    price: 18000,
                    discount: 0,
                    duration: '8 недель',
                    modules: 5,
                    category: 'Неврология',
                    level: 'intermediate',
                    students_count: 234,
                    rating: 4.6,
                    featured: true,
                    image_url: 'https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400&h=250&fit=crop',
                    video_url: '',
                    created_at: new Date().toISOString(),
                    instructors: [1]
                }
            ],
            materials: [
                {
                    id: 1,
                    title: 'Чек-лист неврологического осмотра',
                    description: 'Полный чек-лист для стандартного осмотра',
                    category: 'Неврология',
                    material_type: 'checklist',
                    downloads: 234,
                    file_size: 1024 * 1024 * 2,
                    image_url: 'https://images.unsplash.com/photo-1589998059171-988d887df646?w=400&h=250&fit=crop',
                    file_url: '',
                    created_at: new Date().toISOString()
                }
            ],
            streams: [
                {
                    id: 1,
                    title: 'LIVE: Ответы на вопросы по мануальной терапии',
                    description: 'Прямой эфир с ответами на вопросы',
                    duration: '2:15:00',
                    category: 'Мануальные техники',
                    participants: 156,
                    is_live: true,
                    thumbnail_url: 'https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400&h=250&fit=crop',
                    video_url: '',
                    scheduled_start: new Date(Date.now() + 3600000).toISOString(),
                    created_at: new Date().toISOString()
                }
            ],
            events: [
                {
                    id: 1,
                    title: 'Конференция по современной неврологии',
                    description: 'Ежегодная конференция с ведущими специалистами',
                    event_type: 'offline',
                    event_date: '2024-12-15T10:00:00.000Z',
                    location: 'Москва, ул. Профессиональная, 15',
                    participants: 250,
                    image_url: 'https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400&h=250&fit=crop',
                    registration_url: '',
                    created_at: new Date().toISOString()
                }
            ],
            stats: {
                totalUsers: 1567,
                totalCourses: 4,
                totalMaterials: 3,
                totalEvents: 3
            }
        };
    }

    loadDemoNavigation() {
        this.navigationItems = [
            { 
                id: 1, 
                title: 'Курсы', 
                page: 'courses', 
                icon: '📚',
                description: 'Системное обучение с сертификатами',
                image_url: 'https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400&h=250&fit=crop'
            },
            { 
                id: 2, 
                title: 'Материалы', 
                page: 'materials', 
                icon: '📋',
                description: 'Презентации, статьи и методички',
                image_url: 'https://images.unsplash.com/photo-1589998059171-988d887df646?w=400&h=250&fit=crop'
            }
        ];
    }

    loadDemoCategories() {
        this.categories = {
            courses: [
                { id: 1, name: 'Неврология', type: 'courses', icon: '🧠', color: '#4CAF50' },
                { id: 2, name: 'Мануальные техники', type: 'courses', icon: '💆', color: '#FF9800' }
            ],
            materials: [
                { id: 1, name: 'Чек-листы', type: 'materials', icon: '✅', color: '#4CAF50' },
                { id: 2, name: 'Протоколы', type: 'materials', icon: '📋', color: '#FF9800' }
            ]
        };
    }

    loadSubscriptionData() {
        this.subscriptionPlans = [
            {
                id: 1,
                name: 'Базовый',
                description: 'Доступ к основным курсам',
                price_monthly: 2900,
                price_quarterly: 7500,
                price_yearly: 27000,
                features: JSON.stringify(['Доступ к 3 курсам', 'Базовые материалы', 'Поддержка по email'])
            },
            {
                id: 2,
                name: 'Профессиональный',
                description: 'Полный доступ ко всем материалам',
                price_monthly: 5900,
                price_quarterly: 15000,
                price_yearly: 54000,
                features: JSON.stringify(['Все курсы', 'Все материалы', 'Приоритетная поддержка', 'Закрытые эфиры'])
            }
        ];

        this.userSubscription = {
            plan_id: 2,
            plan_name: 'Профессиональный',
            plan_type: 'monthly',
            price: 5900,
            starts_at: new Date().toISOString(),
            ends_at: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString()
        };
    }

    loadInstructors() {
        this.instructors = [
            {
                id: 1,
                name: 'Доктор Иванов А.В.',
                specialization: 'Неврология, Мануальная терапия',
                role: 'Ведущий специалист',
                experience_years: 15,
                bio: 'Ведущий специалист по мануальной терапии, автор методик лечения болей в спине.',
                avatar_url: 'https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400&h=250&fit=crop',
                email: 'ivanov@anb.ru'
            }
        ];
    }

    loadUserProgress() {
        this.state.progress = {
            level: 'Понимаю',
            experience: 1250,
            completedCourses: 2,
            completedModules: 8,
            studyHours: 45,
            weeklyHours: 5,
            courses: {
                1: 75,
                2: 100
            },
            materials: {
                1: true
            },
            streams: {
                1: false
            },
            events: {
                1: { registered: true, attended: false }
            }
        };
    }

    loadCommunityData() {
        this.communityPosts = [
            {
                id: 1,
                author: 'Доктор Иванов',
                avatar: 'https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400&h=250&fit=crop',
                time: '2 часа назад',
                content: 'Интересный клинический случай: пациент с хроническими болями в спине...',
                likes: 15,
                comments: 3
            }
        ];
    }

    loadChatsData() {
        this.chats = [
            {
                id: 1,
                name: 'Общий чат Академии',
                avatar: 'https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400&h=250&fit=crop',
                lastMessage: 'Добро пожаловать в Академию!',
                time: '10:30',
                unread: 0
            }
        ];
    }
            
            // ==================== ИНИЦИАЛИЗАЦИЯ ====================

            async init() {
                console.log('🚀 Инициализация Академии АНБ...');
                
                try {
                    // Инициализация Telegram WebApp
                    if (window.Telegram && Telegram.WebApp) {
                        Telegram.WebApp.ready();
                        Telegram.WebApp.expand();
                        Telegram.WebApp.enableClosingConfirmation();
                        console.log('✅ Telegram WebApp инициализирован');
                    }
                    
                    // Проверка аутентификации
                    await this.checkAuthentication();
                    
                    // Загрузка начальных данных
                    await this.loadInitialData();
                    
                    // Инициализация интерфейса
                    this.setupEventListeners();
                    this.renderPage('home');
                    this.updateAllCounters();
                    
                    console.log('✅ Приложение инициализировано');
                    
                } catch (error) {
                    console.error('❌ Ошибка инициализации:', error);
                    this.showFatalError('Не удалось загрузить приложение. Пожалуйста, перезагрузите страницу.');
                }
            }

            async checkAuthentication() {
                try {
                    if (this.api.token) {
                        const profile = await this.api.getProfile();
                        this.handleSuccessfulAuth(profile);
                    } else {
                        this.handleUnauthenticated();
                    }
                } catch (error) {
                    console.log('Пользователь не аутентифицирован');
                    this.handleUnauthenticated();
                }
            }

            handleSuccessfulAuth(profile) {
                this.isAuthenticated = true;
                this.currentUser = profile.user;
                this.isAdmin = profile.user.isAdmin || false;
                this.isSuperAdmin = profile.user.isSuperAdmin || false;
                this.updateAuthUI();
                
                // Загружаем дополнительные данные для аутентифицированного пользователя
                this.loadUserData();
            }

            handleUnauthenticated() {
                this.isAuthenticated = false;
                this.currentUser = null;
                this.isAdmin = false;
                this.isSuperAdmin = false;
                this.updateAuthUI();
                
                // Показываем демо-данные для неаутентифицированных пользователей
                this.loadDemoData();
            }

            updateAuthUI() {
                const authButton = document.getElementById('authButton');
                if (authButton) {
                    if (this.isAuthenticated) {
                        authButton.textContent = 'Выйти';
                        authButton.onclick = () => this.logout();
                    } else {
                        authButton.textContent = 'Войти';
                        authButton.onclick = () => this.showAuthModal();
                    }
                }
            }

            async loadInitialData() {
                try {
                    // Загрузка навигации
                    this.navigationItems = await this.api.getNavigation();
                    
                    // Загрузка категорий
                    await this.loadCategories();
                    
                    // Загрузка планов подписки
                    this.subscriptionPlans = await this.api.getSubscriptionPlans();
                    
                } catch (error) {
                    console.error('Ошибка загрузки начальных данных:', error);
                    // Используем демо-данные в случае ошибки
                    this.loadDemoNavigation();
                    this.loadDemoCategories();
                    this.loadSubscriptionData();
                }
            }

            async loadCategories() {
                try {
                    const types = ['courses', 'podcasts', 'videos', 'materials', 'events', 'news'];
                    for (const type of types) {
                        this.categories[type] = await this.api.getCategories(type);
                    }
                } catch (error) {
                    console.error('Ошибка загрузки категорий:', error);
                }
            }

            async loadUserData() {
                if (!this.isAuthenticated) return;
                
                try {
                    // Загрузка избранного
                    const favorites = await this.api.getFavorites();
                    this.state.favorites = favorites.data;
                    
                    // Загрузка прогресса пользователя
                    // (прогресс уже загружен в профиле)
                    
                } catch (error) {
                    console.error('Ошибка загрузки данных пользователя:', error);
                }
            }

    // ==================== СИСТЕМА СОХРАНЕНИЯ СОСТОЯНИЯ ====================

    saveState() {
        const state = {
            favorites: this.state.favorites,
            progress: this.state.progress,
            settings: this.state.settings,
            filters: this.filters,
            currentPage: this.currentPage
        };
        localStorage.setItem('academyAppState', JSON.stringify(state));
    }

    restoreState() {
        try {
            const saved = localStorage.getItem('academyAppState');
            if (saved) {
                const state = JSON.parse(saved);
                this.state.favorites = state.favorites || this.state.favorites;
                this.state.progress = state.progress || this.state.progress;
                this.state.settings = state.settings || this.state.settings;
                this.filters = state.filters || this.filters;
                this.currentPage = state.currentPage || 'home';
                
                // Применяем настройки
                this.applySettings();
            }
        } catch (error) {
            console.error('Ошибка восстановления состояния:', error);
        }
    }

    applySettings() {
        // Применение темы
        document.documentElement.setAttribute('data-theme', this.state.settings.theme);
        
        // Применение языка
        document.documentElement.lang = this.state.settings.language;
    }
            
            // ==================== АУТЕНТИФИКАЦИЯ ====================

            async login(email, password) {
                try {
                    const result = await this.api.login(email, password);
                    this.api.setToken(result.token);
                    this.handleSuccessfulAuth(result);
                    this.closeAuthModal();
                    this.showNotification('Вход выполнен успешно!', 'success');
                    return true;
                } catch (error) {
                    this.showNotification(error.message || 'Ошибка входа', 'error');
                    return false;
                }
            }

            async register(userData) {
                try {
                    const result = await this.api.register(userData);
                    this.api.setToken(result.token);
                    this.handleSuccessfulAuth(result);
                    this.closeAuthModal();
                    this.showNotification('Регистрация выполнена успешно!', 'success');
                    return true;
                } catch (error) {
                    this.showNotification(error.message || 'Ошибка регистрации', 'error');
                    return false;
                }
            }

            logout() {
                this.api.setToken(null);
                localStorage.removeItem('authToken');
                this.handleUnauthenticated();
                this.showNotification('Вы вышли из системы', 'info');
                this.renderPage('home');
            }

            // ==================== UI МЕТОДЫ ====================

            showAuthModal() {
                const modal = document.getElementById('authModal');
                if (modal) {
                    modal.classList.add('active');
                }
            }

            closeAuthModal() {
                const modal = document.getElementById('authModal');
                if (modal) {
                    modal.classList.remove('active');
                }
            }

            switchAuthTab(tab) {
                document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
                
                document.querySelector(`.auth-tab[onclick="app.switchAuthTab('${tab}')"]`).classList.add('active');
                document.getElementById(`${tab}Form`).classList.add('active');
            }

            // ==================== ДЕМО-ДАННЫЕ (для fallback) ====================

            loadDemoData() {
                this.createDemoUser();
                this.createDemoContent();
                this.loadDemoNavigation();
                this.loadDemoCategories();
                this.loadSubscriptionData();
                this.loadInstructors();
                this.loadUserProgress();
                this.loadCommunityData();
                this.loadChatsData();
            }

            createDemoUser() {
                this.currentUser = {
                    id: 898508164,
                    firstName: 'Александр',
                    lastName: 'Петров',
                    email: 'alexander@example.com',
                    phone: '+7 (999) 123-45-67',
                    isAdmin: true,
                    isSuperAdmin: true,
                    isVerified: true,
                    isPremium: true,
                    subscriptionEnd: new Date('2025-12-31').toISOString(),
                    hasActiveSubscription: true,
                    avatarUrl: null,
                    joinDate: new Date('2024-01-15').toISOString(),
                    token: 'demo-token-12345'
                };
            }

            loadDemoNavigation() {
                this.navigationItems = [
                    { 
                        id: 1, 
                        title: 'Курсы', 
                        page: 'courses', 
                        icon: '📚',
                        description: 'Системное обучение с сертификатами',
                        image_url: 'https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400&h=250&fit=crop'
                    },
                    { 
                        id: 2, 
                        title: 'Материалы', 
                        page: 'materials', 
                        icon: '📋',
                        description: 'Презентации, статьи и методички',
                        image_url: 'https://images.unsplash.com/photo-1589998059171-988d887df646?w=400&h=250&fit=crop'
                    }
                    // ... остальные элементы навигации
                ];
            }

            loadDemoCategories() {
                this.categories = {
                    courses: [
                        { id: 1, name: 'Неврология', type: 'courses', icon: '🧠', color: '#4CAF50' },
                        { id: 2, name: 'Мануальные техники', type: 'courses', icon: '💆', color: '#FF9800' }
                    ],
                    materials: [
                        { id: 1, name: 'Чек-листы', type: 'materials', icon: '✅', color: '#4CAF50' },
                        { id: 2, name: 'Протоколы', type: 'materials', icon: '📋', color: '#FF9800' }
                    ]
                    // ... другие категории
                };
            }

    // ==================== ОСНОВНЫЕ СТРАНИЦЫ ====================

    createHomePage() {
        return `
            <div class="page home-page">
                <div class="hero-section">
                    <div class="hero-content">
                        <h1>Академия АНБ</h1>
                        <p class="hero-subtitle">Профессиональное сообщество неврологов и реабилитологов</p>
                        <div class="hero-search">
                            <input type="text" 
                                   class="search-input" 
                                   placeholder="Поиск курсов, материалов, видео..."
                                   value="${this.searchTerm}"
                                   oninput="app.handleSearchInput(this.value)"
                                   onkeypress="app.handleSearchKeypress(event)">
                            <button class="search-btn" onclick="app.performSearch()">
                                🔍 Поиск
                            </button>
                        </div>
                        <div class="hero-stats">
                            <div class="stat">
                                <div class="stat-number">${this.allContent.stats?.totalCourses || 0}</div>
                                <div class="stat-label">Курсов</div>
                            </div>
                            <div class="stat">
                                <div class="stat-number">${this.allContent.stats?.totalUsers || 0}</div>
                                <div class="stat-label">Студентов</div>
                            </div>
                            <div class="stat">
                                <div class="stat-number">25</div>
                                <div class="stat-label">Экспертов</div>
                            </div>
                            <div class="stat">
                                <div class="stat-number">${this.allContent.stats?.totalMaterials || 0}</div>
                                <div class="stat-label">Материалов</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="main-navigation-grid">
                    <div class="nav-card-large" onclick="app.renderPage('courses')">
                        <div class="nav-card-image">
                            <img src="https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400&h=250&fit=crop" alt="Курсы">
                            <div class="nav-card-overlay">
                                <div class="nav-card-icon">📚</div>
                                <h3>Курсы</h3>
                                <p>Системное обучение с сертификатами</p>
                            </div>
                        </div>
                        <div class="nav-count">${this.allContent.courses?.length || 0}</div>
                    </div>

                    <div class="nav-card-large" onclick="app.renderPage('materials')">
                        <div class="nav-card-image">
                            <img src="https://images.unsplash.com/photo-1589998059171-988d887df646?w=400&h=250&fit=crop" alt="Материалы">
                            <div class="nav-card-overlay">
                                <div class="nav-card-icon">📋</div>
                                <h3>Материалы</h3>
                                <p>Презентации, статьи и методички</p>
                            </div>
                        </div>
                        <div class="nav-count">${this.allContent.materials?.length || 0}</div>
                    </div>
                </div>

                <div class="featured-section">
                    <div class="section-header">
                        <h2 class="section-title">⭐ Рекомендуемые курсы</h2>
                        <button class="btn btn-outline" onclick="app.renderPage('courses')">
                            Все курсы →
                        </button>
                    </div>
                    <div class="content-grid">
                        ${(this.allContent.courses || []).slice(0, 3).map(course => this.createCourseCard(course)).join('')}
                    </div>
                </div>
            </div>
        `;
    }

    createCourseCard(course) {
        return `
            <div class="content-card course-card" onclick="app.openCourseDetail(${course.id})">
                <div class="card-image">
                    <img src="${course.image_url}" alt="${course.title}" 
                         onerror="this.src='https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400&h=250&fit=crop'">
                    <div class="card-overlay">
                        <button class="favorite-btn ${this.isFavorite(course.id, 'courses') ? 'active' : ''}" 
                                onclick="event.stopPropagation(); app.toggleFavorite(${course.id}, 'courses')">
                            ${this.isFavorite(course.id, 'courses') ? '❤️' : '🤍'}
                        </button>
                    </div>
                    ${course.featured ? '<div class="featured-badge">Рекомендуем</div>' : ''}
                </div>
                <div class="card-content">
                    <div class="card-category">${course.category || 'Общее'}</div>
                    <h3 class="card-title">${course.title}</h3>
                    <p class="card-description">${course.description}</p>
                    <div class="card-footer">
                        <div class="price-section">
                            <span class="price-current">${this.formatPrice(course.price)}</span>
                        </div>
                        <button class="btn btn-primary btn-small">
                            Подробнее
                        </button>
                    </div>
                </div>
            </div>
        `;
    }

    createCoursesPage() {
        return `
            <div class="page courses-page">
                <div class="page-header">
                    <h2>📚 Курсы</h2>
                    <p>Профессиональные курсы по неврологии и реабилитации</p>
                </div>
                <div class="content-grid">
                    ${(this.allContent.courses || []).map(course => this.createCourseCard(course)).join('')}
                </div>
            </div>
        `;
    }

    createMaterialsPage() {
        return `
            <div class="page materials-page">
                <div class="page-header">
                    <h2>📋 Материалы</h2>
                    <p>Презентации, статьи, чек-листы и методические материалы</p>
                </div>
                <div class="content-grid">
                    ${(this.allContent.materials || []).map(material => `
                        <div class="content-card material-card">
                            <div class="card-image">
                                <img src="${material.image_url}" alt="${material.title}">
                                <div class="card-overlay">
                                    <button class="download-btn" onclick="app.downloadMaterial(${material.id})">
                                        📥
                                    </button>
                                </div>
                            </div>
                            <div class="card-content">
                                <div class="card-category">${material.category}</div>
                                <h3 class="card-title">${material.title}</h3>
                                <p class="card-description">${material.description}</p>
                                <div class="card-meta">
                                    <div class="meta-item">📥 ${material.downloads} загрузок</div>
                                    <div class="meta-item">📊 ${this.formatFileSize(material.file_size)}</div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    }

    createStreamsPage() {
        return `
            <div class="page streams-page">
                <div class="page-header">
                    <h2>📹 Эфиры</h2>
                    <p>Прямые трансляции и записи вебинаров</p>
                </div>
                <div class="content-grid">
                    ${(this.allContent.streams || []).map(stream => `
                        <div class="content-card stream-card">
                            <div class="card-image">
                                <img src="${stream.thumbnail_url}" alt="${stream.title}">
                                <div class="card-overlay">
                                    <button class="play-btn" onclick="app.playStream(${stream.id})">
                                        ▶️
                                    </button>
                                </div>
                                ${stream.is_live ? '<div class="live-badge">LIVE</div>' : ''}
                            </div>
                            <div class="card-content">
                                <div class="card-category">${stream.category}</div>
                                <h3 class="card-title">${stream.title}</h3>
                                <p class="card-description">${stream.description}</p>
                                <div class="card-meta">
                                    <div class="meta-item">👥 ${stream.participants} участников</div>
                                    <div class="meta-item">⏱️ ${stream.duration}</div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    }

    createEventsPage() {
        return `
            <div class="page events-page">
                <div class="page-header">
                    <h2>🗺️ Мероприятия</h2>
                    <p>Конференции, семинары и встречи сообщества</p>
                </div>
                <div class="content-grid">
                    ${(this.allContent.events || []).map(event => `
                        <div class="content-card event-card">
                            <div class="card-image">
                                <img src="${event.image_url}" alt="${event.title}">
                            </div>
                            <div class="card-content">
                                <div class="card-category">${event.event_type === 'offline' ? '📍 Оффлайн' : '💻 Онлайн'}</div>
                                <h3 class="card-title">${event.title}</h3>
                                <p class="card-description">${event.description}</p>
                                <div class="card-meta">
                                    <div class="meta-item">📅 ${new Date(event.event_date).toLocaleDateString('ru-RU')}</div>
                                    <div class="meta-item">👥 ${event.participants} участников</div>
                                </div>
                                ${event.location ? `<div class="meta-item">📍 ${event.location}</div>` : ''}
                                <div class="card-footer">
                                    <button class="btn btn-primary" onclick="app.registerForEvent(${event.id})">
                                        Зарегистрироваться
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    }

    createCommunityPage() {
        return `
            <div class="page community-page">
                <div class="page-header">
                    <h2>👥 Сообщество</h2>
                    <p>Общайтесь с коллегами и экспертами</p>
                </div>
                <div class="community-container">
                    <div class="community-feed">
                        ${this.communityPosts.map(post => `
                            <div class="community-post">
                                <div class="post-header">
                                    <img src="${post.avatar}" alt="${post.author}" class="post-avatar">
                                    <div>
                                        <div class="post-author">${post.author}</div>
                                        <div class="post-time">${post.time}</div>
                                    </div>
                                </div>
                                <div class="post-content">${post.content}</div>
                                <div class="post-actions">
                                    <button class="post-action">👍 ${post.likes}</button>
                                    <button class="post-action">💬 ${post.comments}</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="community-sidebar">
                        <div class="sidebar-section">
                            <h3 class="sidebar-title">Онлайн эксперты</h3>
                            <div class="expert-list">
                                ${this.instructors.map(instructor => `
                                    <div class="expert-item">
                                        <img src="${instructor.avatar_url}" alt="${instructor.name}" class="expert-avatar">
                                        <div class="expert-info">
                                            <div class="expert-name">${instructor.name}</div>
                                            <div class="expert-specialty">${instructor.specialization}</div>
                                        </div>
                                        <div class="online-status"></div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    createChatsPage() {
        return `
            <div class="page chats-page">
                <div class="page-header">
                    <h2>💬 Чаты</h2>
                    <p>Общайтесь с коллегами в реальном времени</p>
                </div>
                <div class="chats-container">
                    <div class="chats-list">
                        <div class="chats-header">
                            <input type="text" class="chats-search" placeholder="Поиск чатов...">
                        </div>
                        <div class="chat-items">
                            ${this.chats.map(chat => `
                                <div class="chat-item" onclick="app.openChat(${chat.id})">
                                    <img src="${chat.avatar}" alt="${chat.name}" class="chat-avatar">
                                    <div class="chat-info">
                                        <div class="chat-name">${chat.name}</div>
                                        <div class="chat-preview">${chat.lastMessage}</div>
                                    </div>
                                    <div class="chat-meta">
                                        <div class="chat-time">${chat.time}</div>
                                        ${chat.unread > 0 ? `<div class="chat-unread">${chat.unread}</div>` : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div class="chat-window">
                        <div class="chat-header">
                            <img src="${this.chats[0]?.avatar}" alt="${this.chats[0]?.name}" class="chat-avatar">
                            <div class="chat-info">
                                <div class="chat-name">${this.chats[0]?.name}</div>
                            </div>
                        </div>
                        <div class="chat-messages">
                            <div class="message incoming">
                                <div class="message-text">Добро пожаловать в Академию АНБ!</div>
                                <div class="message-time">10:30</div>
                            </div>
                            <div class="message outgoing">
                                <div class="message-text">Спасибо! Рад присоединиться к сообществу</div>
                                <div class="message-time">10:32</div>
                            </div>
                        </div>
                        <div class="chat-input">
                            <textarea class="message-input" placeholder="Введите сообщение..."></textarea>
                            <button class="send-btn">➤</button>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    createProfilePage() {
        return `
            <div class="page profile-page">
                <div class="page-header">
                    <h2>👤 Профиль</h2>
                    <p>Управление вашим аккаунтом и настройками</p>
                </div>
                <div class="detail-content">
                    <div class="instructor-card">
                        <div class="instructor-avatar">👨‍⚕️</div>
                        <div class="instructor-info">
                            <div class="instructor-name">${this.currentUser?.firstName || 'Гость'} ${this.currentUser?.lastName || ''}</div>
                            <div class="instructor-specialization">${this.currentUser?.specialization || 'Невролог'}</div>
                            <div class="instructor-bio">
                                ${this.isAuthenticated ? 
                                    `Зарегистрирован с ${new Date(this.currentUser?.joinDate).toLocaleDateString('ru-RU')}` : 
                                    'Войдите в систему для доступа ко всем функциям'
                                }
                            </div>
                        </div>
                    </div>
                    
                    <div class="progress-section" style="margin-top: 2rem;">
                        <div class="progress-header">
                            <span>Прогресс обучения</span>
                            <span>${this.state.progress.experience || 0} XP</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${(this.state.progress.experience || 0) / 2000 * 100}%"></div>
                        </div>
                        <div class="progress-text">
                            Уровень: ${this.state.progress.level || 'Новичок'} | 
                            Завершено курсов: ${this.state.progress.completedCourses || 0}
                        </div>
                    </div>

                    <div class="detail-actions" style="margin-top: 2rem;">
                        <button class="btn btn-primary" onclick="app.showSettingsModal()">
                            ⚙️ Настройки
                        </button>
                        ${!this.isAuthenticated ? `
                            <button class="btn btn-outline" onclick="app.showAuthModal()">
                                🔐 Войти
                            </button>
                        ` : ''}
                        ${this.isAdmin ? `
                            <button class="btn btn-outline" onclick="app.renderPage('admin')">
                                🔧 Админ-панель
                            </button>
                        ` : ''}
                    </div>
                </div>
            </div>
        `;
    }

    createAdminPage() {
        if (!this.isAdmin) {
            return this.createNotFoundPage();
        }

        return `
            <div class="page admin-page">
                <div class="page-header">
                    <h2>🔧 Админ-панель</h2>
                    <p>Управление контентом и пользователями</p>
                </div>
                <div class="admin-panel">
                    <div class="admin-stats">
                        <div class="admin-stat">
                            <div class="admin-stat-value">${this.allContent.stats?.totalUsers || 0}</div>
                            <div class="admin-stat-label">Пользователей</div>
                        </div>
                        <div class="admin-stat">
                            <div class="admin-stat-value">${this.allContent.stats?.totalCourses || 0}</div>
                            <div class="admin-stat-label">Курсов</div>
                        </div>
                        <div class="admin-stat">
                            <div class="admin-stat-value">${this.allContent.stats?.totalMaterials || 0}</div>
                            <div class="admin-stat-label">Материалов</div>
                        </div>
                        <div class="admin-stat">
                            <div class="admin-stat-value">${this.allContent.stats?.totalEvents || 0}</div>
                            <div class="admin-stat-label">Мероприятий</div>
                        </div>
                    </div>

                    <div class="admin-tabs">
                        <button class="admin-tab active">Пользователи</button>
                        <button class="admin-tab">Курсы</button>
                        <button class="admin-tab">Материалы</button>
                    </div>

                    <div class="admin-content">
                        <h3>Последние пользователи</h3>
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Имя</th>
                                    <th>Email</th>
                                    <th>Статус</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>${this.currentUser?.id || '1'}</td>
                                    <td>${this.currentUser?.firstName || 'Админ'} ${this.currentUser?.lastName || ''}</td>
                                    <td>${this.currentUser?.email || 'admin@anb.ru'}</td>
                                    <td><span style="color: var(--success)">Активен</span></td>
                                    <td>
                                        <div class="admin-actions">
                                            <button class="btn btn-small btn-outline">Редактировать</button>
                                            <button class="btn btn-small btn-outline">Статистика</button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        `;
    }

    createNotFoundPage() {
        return `
            <div class="page">
                <div class="empty-state">
                    <div class="empty-icon">🔍</div>
                    <div class="empty-title">Страница не найдена</div>
                    <div class="empty-description">Запрашиваемая страница не существует</div>
                    <button class="btn btn-primary" onclick="app.renderPage('home')">
                        На главную
                    </button>
                </div>
            </div>
        `;
    }

    createErrorPage(message) {
        return `
            <div class="page">
                <div class="empty-state">
                    <div class="empty-icon">⚠️</div>
                    <div class="empty-title">Ошибка</div>
                    <div class="empty-description">${message}</div>
                    <button class="btn btn-primary" onclick="window.location.reload()">
                        Перезагрузить
                    </button>
                </div>
            </div>
        `;
    }

            // ==================== СИСТЕМА СОХРАНЕНИЯ СОСТОЯНИЯ ====================

            saveState() {
                const state = {
                    favorites: this.state.favorites,
                    progress: this.state.progress,
                    settings: this.state.settings,
                    filters: this.filters,
                    currentPage: this.currentPage
                };
                localStorage.setItem('academyAppState', JSON.stringify(state));
            }

            restoreState() {
                try {
                    const saved = localStorage.getItem('academyAppState');
                    if (saved) {
                        const state = JSON.parse(saved);
                        this.state.favorites = state.favorites || this.state.favorites;
                        this.state.progress = state.progress || this.state.progress;
                        this.state.settings = state.settings || this.state.settings;
                        this.filters = state.filters || this.filters;
                        this.currentPage = state.currentPage || 'home';
                        
                        // Применяем настройки
                        this.applySettings();
                    }
                } catch (error) {
                    console.error('Ошибка восстановления состояния:', error);
                }
            }

            applySettings() {
                // Применение темы
                document.documentElement.setAttribute('data-theme', this.state.settings.theme);
                
                // Применение языка
                document.documentElement.lang = this.state.settings.language;
            }

            // ==================== СИСТЕМА РЕНДЕРИНГА ====================

            renderPage(page, subPage = '') {
                console.log(`🔄 Рендеринг страницы: ${page}${subPage ? ` (${subPage})` : ''}`);
                
                this.currentPage = page;
                this.currentSubPage = subPage;
                
                const appElement = document.getElementById('mainContent');
                if (!appElement) {
                    console.error('❌ Элемент #mainContent не найден');
                    return;
                }

                try {
                    let pageContent = '';
                    
                    if (subPage) {
                        pageContent = this.renderSubPage(subPage);
                    } else {
                        const pageMethods = {
                            'home': () => this.createHomePage(),
                            'courses': () => this.createCoursesPage(),
                            'materials': () => this.createMaterialsPage(),
                            'streams': () => this.createStreamsPage(),
                            'events': () => this.createEventsPage(),
                            'community': () => this.createCommunityPage(),
                            'chats': () => this.createChatsPage(),
                            'profile': () => this.createProfilePage(),
                            'admin': () => this.createAdminPage()
                        };

                        pageContent = pageMethods[page] ? pageMethods[page]() : this.createNotFoundPage();
                    }
                    
                    appElement.innerHTML = pageContent;
                    this.initializePageComponents();
                    this.updateActiveNav();
                    this.saveState();
                    
                } catch (error) {
                    console.error('❌ Ошибка рендеринга страницы:', error);
                    appElement.innerHTML = this.createErrorPage('Ошибка загрузки страницы');
                }
            }

            // ==================== ОСНОВНЫЕ СТРАНИЦЫ ====================

    createHomePage() {
        return `
            <div class="page home-page">
                <div class="hero-section">
                    <div class="hero-content">
                        <h1>Академия АНБ</h1>
                        <p class="hero-subtitle">Профессиональное сообщество неврологов и реабилитологов</p>
                        <div class="hero-search">
                            <input type="text" 
                                   class="search-input" 
                                   placeholder="Поиск курсов, материалов, видео..."
                                   value="${this.searchTerm}"
                                   oninput="app.handleSearchInput(this.value)"
                                   onkeypress="app.handleSearchKeypress(event)">
                            <button class="search-btn" onclick="app.performSearch()">
                                🔍 Поиск
                            </button>
                        </div>
                        <div class="hero-stats">
                            <div class="stat">
                                <div class="stat-number">${this.allContent.stats?.totalCourses || 0}</div>
                                <div class="stat-label">Курсов</div>
                            </div>
                            <div class="stat">
                                <div class="stat-number">${this.allContent.stats?.totalUsers || 0}</div>
                                <div class="stat-label">Студентов</div>
                            </div>
                            <div class="stat">
                                <div class="stat-number">25</div>
                                <div class="stat-label">Экспертов</div>
                            </div>
                            <div class="stat">
                                <div class="stat-number">${this.allContent.stats?.totalMaterials || 0}</div>
                                <div class="stat-label">Материалов</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="main-navigation-grid">
                    <div class="nav-card-large" onclick="app.renderPage('courses')">
                        <div class="nav-card-image">
                            <img src="https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400&h=250&fit=crop" alt="Курсы">
                            <div class="nav-card-overlay">
                                <div class="nav-card-icon">📚</div>
                                <h3>Курсы</h3>
                                <p>Системное обучение с сертификатами</p>
                            </div>
                        </div>
                        <div class="nav-count">${this.allContent.courses?.length || 0}</div>
                    </div>

                    <div class="nav-card-large" onclick="app.renderPage('materials')">
                        <div class="nav-card-image">
                            <img src="https://images.unsplash.com/photo-1589998059171-988d887df646?w=400&h=250&fit=crop" alt="Материалы">
                            <div class="nav-card-overlay">
                                <div class="nav-card-icon">📋</div>
                                <h3>Материалы</h3>
                                <p>Презентации, статьи и методички</p>
                            </div>
                        </div>
                        <div class="nav-count">${this.allContent.materials?.length || 0}</div>
                    </div>
                </div>

                <div class="featured-section">
                    <div class="section-header">
                        <h2 class="section-title">⭐ Рекомендуемые курсы</h2>
                        <button class="btn btn-outline" onclick="app.renderPage('courses')">
                            Все курсы →
                        </button>
                    </div>
                    <div class="content-grid">
                        ${(this.allContent.courses || []).slice(0, 3).map(course => this.createCourseCard(course)).join('')}
                    </div>
                </div>
            </div>
        `;
    }

    createCourseCard(course) {
        return `
            <div class="content-card course-card" onclick="app.openCourseDetail(${course.id})">
                <div class="card-image">
                    <img src="${course.image_url}" alt="${course.title}" 
                         onerror="this.src='https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400&h=250&fit=crop'">
                    <div class="card-overlay">
                        <button class="favorite-btn ${this.isFavorite(course.id, 'courses') ? 'active' : ''}" 
                                onclick="event.stopPropagation(); app.toggleFavorite(${course.id}, 'courses')">
                            ${this.isFavorite(course.id, 'courses') ? '❤️' : '🤍'}
                        </button>
                    </div>
                    ${course.featured ? '<div class="featured-badge">Рекомендуем</div>' : ''}
                </div>
                <div class="card-content">
                    <div class="card-category">${course.category || 'Общее'}</div>
                    <h3 class="card-title">${course.title}</h3>
                    <p class="card-description">${course.description}</p>
                    <div class="card-footer">
                        <div class="price-section">
                            <span class="price-current">${this.formatPrice(course.price)}</span>
                        </div>
                        <button class="btn btn-primary btn-small">
                            Подробнее
                        </button>
                    </div>
                </div>
            </div>
        `;
    }

    createCoursesPage() {
        return `
            <div class="page courses-page">
                <div class="page-header">
                    <h2>📚 Курсы</h2>
                    <p>Профессиональные курсы по неврологии и реабилитации</p>
                </div>
                <div class="content-grid">
                    ${(this.allContent.courses || []).map(course => this.createCourseCard(course)).join('')}
                </div>
            </div>
        `;
    }

    createMaterialsPage() {
        return `
            <div class="page materials-page">
                <div class="page-header">
                    <h2>📋 Материалы</h2>
                    <p>Презентации, статьи, чек-листы и методические материалы</p>
                </div>
                <div class="content-grid">
                    ${(this.allContent.materials || []).map(material => `
                        <div class="content-card material-card">
                            <div class="card-image">
                                <img src="${material.image_url}" alt="${material.title}">
                                <div class="card-overlay">
                                    <button class="download-btn" onclick="app.downloadMaterial(${material.id})">
                                        📥
                                    </button>
                                </div>
                            </div>
                            <div class="card-content">
                                <div class="card-category">${material.category}</div>
                                <h3 class="card-title">${material.title}</h3>
                                <p class="card-description">${material.description}</p>
                                <div class="card-meta">
                                    <div class="meta-item">📥 ${material.downloads} загрузок</div>
                                    <div class="meta-item">📊 ${this.formatFileSize(material.file_size)}</div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    }

    createStreamsPage() {
        return `
            <div class="page streams-page">
                <div class="page-header">
                    <h2>📹 Эфиры</h2>
                    <p>Прямые трансляции и записи вебинаров</p>
                </div>
                <div class="content-grid">
                    ${(this.allContent.streams || []).map(stream => `
                        <div class="content-card stream-card">
                            <div class="card-image">
                                <img src="${stream.thumbnail_url}" alt="${stream.title}">
                                <div class="card-overlay">
                                    <button class="play-btn" onclick="app.playStream(${stream.id})">
                                        ▶️
                                    </button>
                                </div>
                                ${stream.is_live ? '<div class="live-badge">LIVE</div>' : ''}
                            </div>
                            <div class="card-content">
                                <div class="card-category">${stream.category}</div>
                                <h3 class="card-title">${stream.title}</h3>
                                <p class="card-description">${stream.description}</p>
                                <div class="card-meta">
                                    <div class="meta-item">👥 ${stream.participants} участников</div>
                                    <div class="meta-item">⏱️ ${stream.duration}</div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    }

    createEventsPage() {
        return `
            <div class="page events-page">
                <div class="page-header">
                    <h2>🗺️ Мероприятия</h2>
                    <p>Конференции, семинары и встречи сообщества</p>
                </div>
                <div class="content-grid">
                    ${(this.allContent.events || []).map(event => `
                        <div class="content-card event-card">
                            <div class="card-image">
                                <img src="${event.image_url}" alt="${event.title}">
                            </div>
                            <div class="card-content">
                                <div class="card-category">${event.event_type === 'offline' ? '📍 Оффлайн' : '💻 Онлайн'}</div>
                                <h3 class="card-title">${event.title}</h3>
                                <p class="card-description">${event.description}</p>
                                <div class="card-meta">
                                    <div class="meta-item">📅 ${new Date(event.event_date).toLocaleDateString('ru-RU')}</div>
                                    <div class="meta-item">👥 ${event.participants} участников</div>
                                </div>
                                ${event.location ? `<div class="meta-item">📍 ${event.location}</div>` : ''}
                                <div class="card-footer">
                                    <button class="btn btn-primary" onclick="app.registerForEvent(${event.id})">
                                        Зарегистрироваться
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    }

    createCommunityPage() {
        return `
            <div class="page community-page">
                <div class="page-header">
                    <h2>👥 Сообщество</h2>
                    <p>Общайтесь с коллегами и экспертами</p>
                </div>
                <div class="community-container">
                    <div class="community-feed">
                        ${this.communityPosts.map(post => `
                            <div class="community-post">
                                <div class="post-header">
                                    <img src="${post.avatar}" alt="${post.author}" class="post-avatar">
                                    <div>
                                        <div class="post-author">${post.author}</div>
                                        <div class="post-time">${post.time}</div>
                                    </div>
                                </div>
                                <div class="post-content">${post.content}</div>
                                <div class="post-actions">
                                    <button class="post-action">👍 ${post.likes}</button>
                                    <button class="post-action">💬 ${post.comments}</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="community-sidebar">
                        <div class="sidebar-section">
                            <h3 class="sidebar-title">Онлайн эксперты</h3>
                            <div class="expert-list">
                                ${this.instructors.map(instructor => `
                                    <div class="expert-item">
                                        <img src="${instructor.avatar_url}" alt="${instructor.name}" class="expert-avatar">
                                        <div class="expert-info">
                                            <div class="expert-name">${instructor.name}</div>
                                            <div class="expert-specialty">${instructor.specialization}</div>
                                        </div>
                                        <div class="online-status"></div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    createChatsPage() {
        return `
            <div class="page chats-page">
                <div class="page-header">
                    <h2>💬 Чаты</h2>
                    <p>Общайтесь с коллегами в реальном времени</p>
                </div>
                <div class="chats-container">
                    <div class="chats-list">
                        <div class="chats-header">
                            <input type="text" class="chats-search" placeholder="Поиск чатов...">
                        </div>
                        <div class="chat-items">
                            ${this.chats.map(chat => `
                                <div class="chat-item" onclick="app.openChat(${chat.id})">
                                    <img src="${chat.avatar}" alt="${chat.name}" class="chat-avatar">
                                    <div class="chat-info">
                                        <div class="chat-name">${chat.name}</div>
                                        <div class="chat-preview">${chat.lastMessage}</div>
                                    </div>
                                    <div class="chat-meta">
                                        <div class="chat-time">${chat.time}</div>
                                        ${chat.unread > 0 ? `<div class="chat-unread">${chat.unread}</div>` : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div class="chat-window">
                        <div class="chat-header">
                            <img src="${this.chats[0]?.avatar}" alt="${this.chats[0]?.name}" class="chat-avatar">
                            <div class="chat-info">
                                <div class="chat-name">${this.chats[0]?.name}</div>
                            </div>
                        </div>
                        <div class="chat-messages">
                            <div class="message incoming">
                                <div class="message-text">Добро пожаловать в Академию АНБ!</div>
                                <div class="message-time">10:30</div>
                            </div>
                            <div class="message outgoing">
                                <div class="message-text">Спасибо! Рад присоединиться к сообществу</div>
                                <div class="message-time">10:32</div>
                            </div>
                        </div>
                        <div class="chat-input">
                            <textarea class="message-input" placeholder="Введите сообщение..."></textarea>
                            <button class="send-btn">➤</button>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    createProfilePage() {
        return `
            <div class="page profile-page">
                <div class="page-header">
                    <h2>👤 Профиль</h2>
                    <p>Управление вашим аккаунтом и настройками</p>
                </div>
                <div class="detail-content">
                    <div class="instructor-card">
                        <div class="instructor-avatar">👨‍⚕️</div>
                        <div class="instructor-info">
                            <div class="instructor-name">${this.currentUser?.firstName || 'Гость'} ${this.currentUser?.lastName || ''}</div>
                            <div class="instructor-specialization">${this.currentUser?.specialization || 'Невролог'}</div>
                            <div class="instructor-bio">
                                ${this.isAuthenticated ? 
                                    `Зарегистрирован с ${new Date(this.currentUser?.joinDate).toLocaleDateString('ru-RU')}` : 
                                    'Войдите в систему для доступа ко всем функциям'
                                }
                            </div>
                        </div>
                    </div>
                    
                    <div class="progress-section" style="margin-top: 2rem;">
                        <div class="progress-header">
                            <span>Прогресс обучения</span>
                            <span>${this.state.progress.experience || 0} XP</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${(this.state.progress.experience || 0) / 2000 * 100}%"></div>
                        </div>
                        <div class="progress-text">
                            Уровень: ${this.state.progress.level || 'Новичок'} | 
                            Завершено курсов: ${this.state.progress.completedCourses || 0}
                        </div>
                    </div>

                    <div class="detail-actions" style="margin-top: 2rem;">
                        <button class="btn btn-primary" onclick="app.showSettingsModal()">
                            ⚙️ Настройки
                        </button>
                        ${!this.isAuthenticated ? `
                            <button class="btn btn-outline" onclick="app.showAuthModal()">
                                🔐 Войти
                            </button>
                        ` : ''}
                        ${this.isAdmin ? `
                            <button class="btn btn-outline" onclick="app.renderPage('admin')">
                                🔧 Админ-панель
                            </button>
                        ` : ''}
                    </div>
                </div>
            </div>
        `;
    }

    createAdminPage() {
        if (!this.isAdmin) {
            return this.createNotFoundPage();
        }

        return `
            <div class="page admin-page">
                <div class="page-header">
                    <h2>🔧 Админ-панель</h2>
                    <p>Управление контентом и пользователями</p>
                </div>
                <div class="admin-panel">
                    <div class="admin-stats">
                        <div class="admin-stat">
                            <div class="admin-stat-value">${this.allContent.stats?.totalUsers || 0}</div>
                            <div class="admin-stat-label">Пользователей</div>
                        </div>
                        <div class="admin-stat">
                            <div class="admin-stat-value">${this.allContent.stats?.totalCourses || 0}</div>
                            <div class="admin-stat-label">Курсов</div>
                        </div>
                        <div class="admin-stat">
                            <div class="admin-stat-value">${this.allContent.stats?.totalMaterials || 0}</div>
                            <div class="admin-stat-label">Материалов</div>
                        </div>
                        <div class="admin-stat">
                            <div class="admin-stat-value">${this.allContent.stats?.totalEvents || 0}</div>
                            <div class="admin-stat-label">Мероприятий</div>
                        </div>
                    </div>

                    <div class="admin-tabs">
                        <button class="admin-tab active">Пользователи</button>
                        <button class="admin-tab">Курсы</button>
                        <button class="admin-tab">Материалы</button>
                    </div>

                    <div class="admin-content">
                        <h3>Последние пользователи</h3>
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Имя</th>
                                    <th>Email</th>
                                    <th>Статус</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>${this.currentUser?.id || '1'}</td>
                                    <td>${this.currentUser?.firstName || 'Админ'} ${this.currentUser?.lastName || ''}</td>
                                    <td>${this.currentUser?.email || 'admin@anb.ru'}</td>
                                    <td><span style="color: var(--success)">Активен</span></td>
                                    <td>
                                        <div class="admin-actions">
                                            <button class="btn btn-small btn-outline">Редактировать</button>
                                            <button class="btn btn-small btn-outline">Статистика</button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        `;
    }

    createNotFoundPage() {
        return `
            <div class="page">
                <div class="empty-state">
                    <div class="empty-icon">🔍</div>
                    <div class="empty-title">Страница не найдена</div>
                    <div class="empty-description">Запрашиваемая страница не существует</div>
                    <button class="btn btn-primary" onclick="app.renderPage('home')">
                        На главную
                    </button>
                </div>
            </div>
        `;
    }

    createErrorPage(message) {
        return `
            <div class="page">
                <div class="empty-state">
                    <div class="empty-icon">⚠️</div>
                    <div class="empty-title">Ошибка</div>
                    <div class="empty-description">${message}</div>
                    <button class="btn btn-primary" onclick="window.location.reload()">
                        Перезагрузить
                    </button>
                </div>
            </div>
        `;
    }

            // ==================== РАБОТА С API ====================

            async loadContent(type, filters = {}) {
                try {
                    if (!this.isAuthenticated && type !== 'courses') {
                        // Для неаутентифицированных пользователей показываем только курсы
                        return this.getDemoContentData()[type] || [];
                    }

                    const result = await this.api.getContent(type, filters);
                    return result.data;
                } catch (error) {
                    console.error(`Ошибка загрузки контента ${type}:`, error);
                    // Возвращаем демо-данные в случае ошибки
                    return this.getDemoContentData()[type] || [];
                }
            }

            async toggleFavorite(contentId, contentType) {
                if (!this.isAuthenticated) {
                    this.showNotification('Для добавления в избранное необходимо войти в систему', 'warning');
                    this.showAuthModal();
                    return;
                }

                try {
                    const result = await this.api.toggleFavorite(contentId, contentType);
                    this.showNotification(result.message, 'success');
                    
                    // Обновляем локальное состояние
                    if (result.action === 'added') {
                        if (!this.state.favorites[contentType]) {
                            this.state.favorites[contentType] = [];
                        }
                        this.state.favorites[contentType].push(contentId);
                    } else {
                        this.state.favorites[contentType] = this.state.favorites[contentType].filter(id => id !== contentId);
                    }
                    
                    this.saveState();
                } catch (error) {
                    this.showNotification('Ошибка обновления избранного', 'error');
                }
            }

            // ==================== УВЕДОМЛЕНИЯ ====================

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = 'notification';
                notification.style.background = type === 'error' ? 'var(--error)' : 
                                              type === 'success' ? 'var(--success)' : 
                                              type === 'warning' ? 'var(--warning)' : 'var(--info)';
                
                notification.innerHTML = `
                    <div class="notification-content">
                        <span>${type === 'success' ? '✅' : type === 'error' ? '❌' : type === 'warning' ? '⚠️' : 'ℹ️'}</span>
                        <span>${message}</span>
                        <button class="notification-close" onclick="this.parentElement.parentElement.remove()">×</button>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                // Автоматическое удаление через 3 секунды
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, 3000);
            }

            showFatalError(message) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-container';
                errorDiv.style.display = 'flex';
                errorDiv.innerHTML = `
                    <div class="error-icon">⚠️</div>
                    <div class="error-title">Ошибка загрузки</div>
                    <div class="error-description">${message}</div>
                    <div class="error-actions">
                        <button class="btn btn-primary" onclick="window.location.reload()">
                            Перезагрузить
                        </button>
                    </div>
                `;
                
                  document.body.innerHTML = '';
    document.body.appendChild(errorDiv);
}

// ==================== ВСПОМОГАТЕЛЬНЫЕ МЕТОДЫ ====================

formatPrice(price) {
    return new Intl.NumberFormat('ru-RU').format(Math.round(price)) + ' ₽';
}

formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

isFavorite(contentId, contentType) {
    return this.state.favorites[contentType]?.includes(contentId) || false;
}

handleSearchInput(value) {
    this.searchTerm = value;
}

handleSearchKeypress(event) {
    if (event.key === 'Enter') {
        this.performSearch();
    }
}

performSearch() {
    this.showNotification('Функция поиска в разработке', 'info');
}

openCourseDetail(courseId) {
    this.showNotification(`Открытие курса ${courseId}`, 'info');
}

downloadMaterial(materialId) {
    this.showNotification(`Скачивание материала ${materialId}`, 'info');
}

playStream(streamId) {
    this.showNotification(`Воспроизведение эфира ${streamId}`, 'info');
}

registerForEvent(eventId) {
    this.showNotification(`Регистрация на мероприятие ${eventId}`, 'info');
}

openChat(chatId) {
    this.showNotification(`Открытие чата ${chatId}`, 'info');
}

showSettingsModal() {
    this.showNotification('Открытие настроек', 'info');
}

renderSubPage(subPage) {
    return `<div class="page"><h2>Подстраница: ${subPage}</h2></div>`;
}
}
// конец класса AcademyApp

// ==================== ИНИЦИАЛИЗАЦИЯ ПРИЛОЖЕНИЯ ====================

document.addEventListener('DOMContentLoaded', function() {
    console.log('🚀 DOM загружен, запуск приложения...');
    
    const loadingScreen = document.getElementById('loadingScreen');
    const errorScreen = document.getElementById('errorScreen');
    const appContainer = document.getElementById('app');
    const retryButton = document.getElementById('retryButton');
    
    // Обработчики форм аутентификации
    document.getElementById('loginForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        await window.app.login(email, password);
    });

    document.getElementById('registerForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const userData = {
            firstName: document.getElementById('registerFirstName').value,
            lastName: document.getElementById('registerLastName').value,
            email: document.getElementById('registerEmail').value,
            password: document.getElementById('registerPassword').value,
            specialization: document.getElementById('registerSpecialization').value
        };
        await window.app.register(userData);
    });

    async function initializeApp() {
        try {
            // Имитация загрузки
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            if (typeof AcademyApp === 'undefined') {
                throw new Error('AcademyApp class not found');
            }
            
            window.app = new AcademyApp();
            await window.app.init();
            
            if (loadingScreen) loadingScreen.style.display = 'none';
            if (errorScreen) errorScreen.style.display = 'none';
            if (appContainer) appContainer.style.display = 'block';
            
            console.log('✅ Приложение успешно инициализировано');
            
        } catch (error) {
            console.error('❌ Ошибка инициализации:', error);
            
            if (loadingScreen) loadingScreen.style.display = 'none';
            if (errorScreen) {
                errorScreen.style.display = 'flex';
                const errorMessage = document.getElementById('errorMessage');
                if (errorMessage) {
                    errorMessage.textContent = error.message || 'Не удалось загрузить приложение';
                }
            }
        }
    }
    
    if (retryButton) {
        retryButton.addEventListener('click', function() {
            if (errorScreen) errorScreen.style.display = 'none';
            if (loadingScreen) loadingScreen.style.display = 'flex';
            setTimeout(initializeApp, 500);
        });
    }
    
    initializeApp();
});
</script>
</body>
</html>
