<!DOCTYPE html>
<html lang="ru" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Академия АНБ - Современное образование для врачей</title>
    <meta name="description" content="Академия АНБ - платформа для непрерывного медицинского образования">
    
    <!-- Telegram WebApp -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <style>
        /* ==================== БАЗОВЫЕ СТИЛИ ==================== */
        :root {
            /* Цветовая палитра для темной темы */
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --bg-card: #1e293b;
            --bg-overlay: rgba(15, 23, 42, 0.8);
            --bg-backdrop: rgba(15, 23, 42, 0.95);
            
            /* Текст */
            --text-primary: #ffffff;
            --text-secondary: #94a3b8;
            --text-tertiary: #64748b;
            --text-muted: #475569;
            --text-inverse: #0f172a;
            
            /* Акцентные цвета */
            --accent-primary: #3b82f6;
            --accent-secondary: #2563eb;
            --accent-hover: #1d4ed8;
            --accent-active: #1e40af;
            --accent-light: #dbeafe;
            
            /* Системные цвета */
            --success: #10b981;
            --success-light: #d1fae5;
            --error: #ef4444;
            --error-light: #fee2e2;
            --warning: #f59e0b;
            --warning-light: #fef3c7;
            --info: #06b6d4;
            --info-light: #cffafe;
            
            /* Градиенты */
            --gradient-primary: linear-gradient(135deg, #3b82f6, #1e40af);
            --gradient-secondary: linear-gradient(135deg, #8b5cf6, #7c3aed);
            --gradient-success: linear-gradient(135deg, #10b981, #059669);
            --gradient-warning: linear-gradient(135deg, #f59e0b, #d97706);
            
            /* Тени */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            
            /* Границы */
            --border-primary: #334155;
            --border-secondary: #475569;
            --border-light: #e2e8f0;
            --border-radius-sm: 0.375rem;
            --border-radius: 0.5rem;
            --border-radius-md: 0.75rem;
            --border-radius-lg: 1rem;
            --border-radius-xl: 1.5rem;
            
            /* Отступы */
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --spacing-2xl: 3rem;
            
            /* Шрифты */
            --font-size-xs: 0.75rem;
            --font-size-sm: 0.875rem;
            --font-size-base: 1rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            --font-size-3xl: 1.875rem;
            --font-size-4xl: 2.25rem;
            
            /* Анимации */
            --transition-fast: 0.15s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
        }

        /* Светлая тема */
        [data-theme="light"] {
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #e2e8f0;
            --bg-card: #ffffff;
            --bg-overlay: rgba(255, 255, 255, 0.8);
            --bg-backdrop: rgba(255, 255, 255, 0.95);
            
            --text-primary: #0f172a;
            --text-secondary: #334155;
            --text-tertiary: #64748b;
            --text-muted: #94a3b8;
            --text-inverse: #ffffff;
            
            --border-primary: #e2e8f0;
            --border-secondary: #cbd5e1;
            --border-light: #334155;
            
            --accent-light: #1e40af;
        }

        /* Сброс стилей */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Базовые стили документа */
        html {
            scroll-behavior: smooth;
            font-size: 16px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: var(--bg-primary);
            overflow-x: hidden;
            min-height: 100vh;
            transition: background-color var(--transition-normal), color var(--transition-normal);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Типографика */
        h1, h2, h3, h4, h5, h6 {
            font-weight: 600;
            line-height: 1.25;
            margin-bottom: var(--spacing-md);
            color: var(--text-primary);
        }

        h1 { font-size: var(--font-size-4xl); }
        h2 { font-size: var(--font-size-3xl); }
        h3 { font-size: var(--font-size-2xl); }
        h4 { font-size: var(--font-size-xl); }
        h5 { font-size: var(--font-size-lg); }
        h6 { font-size: var(--font-size-base); }

        p {
            margin-bottom: var(--spacing-md);
            color: var(--text-secondary);
        }

        a {
            color: var(--accent-primary);
            text-decoration: none;
            transition: color var(--transition-fast);
        }

        a:hover {
            color: var(--accent-secondary);
        }

        /* ==================== КОМПОНЕНТЫ ЗАГРУЗКИ И ОШИБОК ==================== */
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: var(--bg-primary);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 9999;
            backdrop-filter: blur(10px);
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--border-primary);
            border-top: 4px solid var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: var(--spacing-lg);
            position: relative;
        }

        .loading-spinner::before {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            right: -4px;
            bottom: -4px;
            border: 4px solid transparent;
            border-top: 4px solid var(--accent-secondary);
            border-radius: 50%;
            animation: spin 1.5s linear infinite reverse;
        }

        .loading-text {
            color: var(--text-secondary);
            font-size: var(--font-size-lg);
            font-weight: 500;
            text-align: center;
        }

        .loading-dots {
            display: inline-block;
            animation: dots 1.5s infinite;
        }

        .error-container {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: var(--bg-primary);
            text-align: center;
            padding: var(--spacing-2xl);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 9999;
            backdrop-filter: blur(10px);
        }

        .error-icon {
            font-size: 4rem;
            margin-bottom: var(--spacing-lg);
            animation: bounce 2s infinite;
        }

        .error-title {
            font-size: var(--font-size-3xl);
            font-weight: 700;
            margin-bottom: var(--spacing-md);
            color: var(--text-primary);
        }

        .error-description {
            font-size: var(--font-size-lg);
            color: var(--text-secondary);
            margin-bottom: var(--spacing-2xl);
            max-width: 500px;
            line-height: 1.6;
        }

        .error-actions {
            display: flex;
            gap: var(--spacing-md);
            flex-wrap: wrap;
            justify-content: center;
        }

        /* ==================== ОСНОВНАЯ СТРУКТУРА ==================== */
        #app {
            display: none;
            min-height: 100vh;
            background: var(--bg-primary);
            position: relative;
        }

        /* Верхний хедер */
        .top-header {
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-primary);
            padding: var(--spacing-md);
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .header-brand {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            font-weight: 700;
            font-size: var(--font-size-xl);
            color: var(--text-primary);
        }

        .brand-icon {
            font-size: 1.75rem;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .brand-text {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .header-search {
            position: relative;
            display: none;
        }

        .header-search.active {
            display: block;
        }

        .search-input-header {
            width: 300px;
            padding: var(--spacing-sm) var(--spacing-lg);
            padding-left: 2.5rem;
            border: 1px solid var(--border-primary);
            border-radius: var(--border-radius-lg);
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: var(--font-size-sm);
            transition: all var(--transition-fast);
        }

        .search-input-header:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .search-icon-header {
            position: absolute;
            left: var(--spacing-md);
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-tertiary);
            pointer-events: none;
        }

        .admin-badge {
            background: var(--gradient-warning);
            color: white;
            padding: var(--spacing-xs) var(--spacing-md);
            border-radius: var(--border-radius-lg);
            font-size: var(--font-size-xs);
            font-weight: 600;
            display: none;
            align-items: center;
            gap: var(--spacing-xs);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Основной контент */
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--spacing-lg);
            padding-bottom: 100px;
            min-height: calc(100vh - 140px);
        }

        /* Нижняя навигация */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-primary);
            z-index: 1000;
            padding: var(--spacing-sm) 0;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        .nav-scroll-container {
            display: flex;
            overflow-x: auto;
            gap: var(--spacing-sm);
            padding: 0 var(--spacing-md);
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .nav-scroll-container::-webkit-scrollbar {
            display: none;
        }

        .nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: none;
            border: none;
            color: var(--text-secondary);
            padding: var(--spacing-sm);
            border-radius: var(--border-radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            min-width: 70px;
            position: relative;
            flex-shrink: 0;
            font-family: inherit;
        }

        .nav-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: var(--accent-primary);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .nav-btn.active:hover {
            background: var(--accent-secondary);
            transform: translateY(-2px);
        }

        .nav-icon {
            font-size: 1.5rem;
            margin-bottom: var(--spacing-xs);
            transition: transform var(--transition-fast);
        }

        .nav-btn:hover .nav-icon {
            transform: scale(1.1);
        }

        .nav-label {
            font-size: var(--font-size-xs);
            font-weight: 500;
            white-space: nowrap;
            transition: font-weight var(--transition-fast);
        }

        .nav-btn.active .nav-label {
            font-weight: 600;
        }

        .nav-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--error);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: var(--font-size-xs);
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s infinite;
            border: 2px solid var(--bg-secondary);
        }

        /* ==================== СТРАНИЦЫ И КОМПОНЕНТЫ ==================== */
        .page {
            animation: fadeInUp 0.5s ease;
            padding-bottom: var(--spacing-xl);
        }

        .page-title {
            font-size: var(--font-size-3xl);
            font-weight: 700;
            margin-bottom: var(--spacing-xl);
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .page-subtitle {
            font-size: var(--font-size-lg);
            color: var(--text-secondary);
            margin-bottom: var(--spacing-2xl);
            line-height: 1.6;
        }

        /* Hero Section */
        .hero-section {
            background: var(--gradient-primary);
            border-radius: var(--border-radius-xl);
            padding: var(--spacing-2xl);
            margin-bottom: var(--spacing-2xl);
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-xl);
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=1200&h=600&fit=crop') center/cover;
            opacity: 0.1;
            z-index: 1;
        }

        .hero-content {
            position: relative;
            z-index: 2;
            max-width: 800px;
            margin: 0 auto;
        }

        .hero-title {
            font-size: var(--font-size-4xl);
            font-weight: 800;
            margin-bottom: var(--spacing-md);
            color: white;
            line-height: 1.2;
        }

        .hero-subtitle {
            font-size: var(--font-size-xl);
            margin-bottom: var(--spacing-2xl);
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.5;
        }

        .hero-search {
            display: flex;
            gap: var(--spacing-md);
            max-width: 600px;
            margin: 0 auto var(--spacing-2xl) auto;
            position: relative;
        }

        .search-input {
            flex: 1;
            padding: var(--spacing-lg);
            border: none;
            border-radius: var(--border-radius-lg);
            background: rgba(255, 255, 255, 0.95);
            font-size: var(--font-size-base);
            color: var(--text-inverse);
            box-shadow: var(--shadow-lg);
            transition: all var(--transition-fast);
        }

        .search-input:focus {
            outline: none;
            background: white;
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .search-input::placeholder {
            color: var(--text-muted);
        }

        .hero-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--spacing-md);
            max-width: 800px;
            margin: 0 auto;
        }

        .stat {
            text-align: center;
            padding: var(--spacing-lg);
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius-lg);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform var(--transition-fast);
        }

        .stat:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: var(--font-size-3xl);
            font-weight: 800;
            margin-bottom: var(--spacing-xs);
            color: white;
        }

        .stat-label {
            font-size: var(--font-size-sm);
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
        }

        /* Основная навигационная сетка */
        .main-navigation-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-2xl);
        }

        .nav-card-large {
            background: var(--bg-card);
            border: 1px solid var(--border-primary);
            border-radius: var(--border-radius-xl);
            overflow: hidden;
            cursor: pointer;
            transition: all var(--transition-normal);
            position: relative;
            aspect-ratio: 1.6;
            box-shadow: var(--shadow-md);
        }

        .nav-card-large:hover {
            transform: translateY(-8px);
            border-color: var(--accent-primary);
            box-shadow: var(--shadow-2xl);
        }

        .nav-card-image {
            position: relative;
            height: 100%;
            overflow: hidden;
        }

        .nav-card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform var(--transition-normal);
        }

        .nav-card-large:hover .nav-card-image img {
            transform: scale(1.1);
        }

        .nav-card-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.9), rgba(30, 64, 175, 0.8));
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            padding: var(--spacing-xl);
            z-index: 2;
        }

        .nav-card-icon {
            font-size: 3rem;
            margin-bottom: var(--spacing-md);
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
        }

        .nav-card-overlay h3 {
            font-size: var(--font-size-xl);
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
            color: white;
        }

        .nav-card-overlay p {
            font-size: var(--font-size-sm);
            opacity: 0.9;
            color: white;
            line-height: 1.4;
        }

        .nav-count {
            position: absolute;
            top: var(--spacing-md);
            right: var(--spacing-md);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius-lg);
            font-size: var(--font-size-xs);
            font-weight: 600;
            z-index: 3;
            backdrop-filter: blur(10px);
        }

        /* Секции контента */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-xl);
            padding-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--border-primary);
        }

        .section-title {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            color: var(--text-primary);
        }

        .section-actions {
            display: flex;
            gap: var(--spacing-sm);
            align-items: center;
        }

        /* Сетка контента */
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-2xl);
        }

        .content-grid.compact {
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--spacing-md);
        }

        .content-grid.large {
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
        }

        /* Карточки контента */
        .content-card {
            background: var(--bg-card);
            border: 1px solid var(--border-primary);
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            transition: all var(--transition-normal);
            position: relative;
            box-shadow: var(--shadow-md);
        }

        .content-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-primary);
            box-shadow: var(--shadow-xl);
        }

        .card-image {
            position: relative;
            height: 200px;
            overflow: hidden;
        }

        .card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform var(--transition-normal);
        }

        .content-card:hover .card-image img {
            transform: scale(1.05);
        }

        .card-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: flex-start;
            justify-content: flex-end;
            padding: var(--spacing-md);
            opacity: 0;
            transition: opacity var(--transition-fast);
            z-index: 2;
        }

        .content-card:hover .card-overlay {
            opacity: 1;
        }

        .card-actions {
            display: flex;
            gap: var(--spacing-xs);
        }

        .card-action-btn {
            background: rgba(0, 0, 0, 0.7);
            border: none;
            color: white;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--transition-fast);
            backdrop-filter: blur(10px);
        }

        .card-action-btn:hover {
            transform: scale(1.1);
            background: rgba(0, 0, 0, 0.9);
        }

        .card-action-btn.favorite.active {
            background: var(--error);
        }

        .card-action-btn.favorite.active:hover {
            background: #dc2626;
        }

        .card-badges {
            position: absolute;
            top: var(--spacing-md);
            left: var(--spacing-md);
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
            z-index: 1;
        }

        .card-badge {
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius);
            font-size: var(--font-size-xs);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .card-badge.featured {
            background: var(--gradient-warning);
            color: white;
        }

        .card-badge.discount {
            background: var(--gradient-success);
            color: white;
        }

        .card-badge.live {
            background: var(--error);
            color: white;
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            animation: pulse 2s infinite;
        }

        .card-badge.progress {
            background: var(--gradient-primary);
            color: white;
        }

        .card-badge.new {
            background: var(--gradient-secondary);
            color: white;
        }

        .live-pulse {
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }

        .card-content {
            padding: var(--spacing-lg);
        }

        .card-category {
            color: var(--accent-primary);
            font-size: var(--font-size-sm);
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .card-title {
            font-size: var(--font-size-lg);
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
            line-height: 1.4;
            color: var(--text-primary);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .card-description {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
            margin-bottom: var(--spacing-lg);
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .card-meta {
            display: flex;
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            flex-wrap: wrap;
        }

        .meta-item {
            color: var(--text-tertiary);
            font-size: var(--font-size-sm);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .meta-item .icon {
            font-size: 1rem;
            opacity: 0.7;
        }

        .progress-section {
            margin: var(--spacing-lg) 0;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--spacing-xs);
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
        }

        .progress-bar {
            background: var(--bg-secondary);
            height: 8px;
            border-radius: var(--border-radius);
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            background: var(--gradient-primary);
            height: 100%;
            transition: width var(--transition-slow) ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: shimmer 2s infinite;
        }

        .progress-text {
            font-size: var(--font-size-xs);
            color: var(--text-tertiary);
            margin-top: var(--spacing-xs);
            text-align: right;
        }

        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: var(--spacing-md);
            border-top: 1px solid var(--border-primary);
        }

        .price-section {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .price-original {
            color: var(--text-tertiary);
            text-decoration: line-through;
            font-size: var(--font-size-sm);
        }

        .price-current {
            font-weight: 700;
            color: var(--accent-primary);
            font-size: var(--font-size-lg);
        }

        .price-free {
            font-weight: 700;
            color: var(--success);
            font-size: var(--font-size-lg);
        }

        .action-buttons {
            display: flex;
            gap: var(--spacing-sm);
        }

        /* ==================== КНОПКИ ==================== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm) var(--spacing-lg);
            border: none;
            border-radius: var(--border-radius-md);
            cursor: pointer;
            font-size: var(--font-size-sm);
            font-weight: 600;
            text-decoration: none;
            transition: all var(--transition-fast);
            font-family: inherit;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left var(--transition-slow);
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:active {
            transform: translateY(1px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .btn-primary:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--gradient-secondary);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .btn-secondary:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--gradient-success);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .btn-success:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--border-primary);
            color: var(--text-primary);
        }

        .btn-outline:hover {
            border-color: var(--accent-primary);
            color: var(--accent-primary);
            transform: translateY(-2px);
        }

        .btn-ghost {
            background: transparent;
            border: none;
            color: var(--text-primary);
        }

        .btn-ghost:hover {
            background: var(--bg-tertiary);
            transform: translateY(-2px);
        }

        .btn-danger {
            background: var(--error);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .btn-danger:hover {
            background: #dc2626;
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .btn-warning {
            background: var(--warning);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .btn-warning:hover {
            background: #d97706;
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .btn-small {
            padding: var(--spacing-xs) var(--spacing-md);
            font-size: var(--font-size-xs);
        }

        .btn-large {
            padding: var(--spacing-md) var(--spacing-xl);
            font-size: var(--font-size-base);
        }

        .btn-full {
            width: 100%;
        }

        .btn-loading {
            pointer-events: none;
            opacity: 0.8;
        }

        .btn-loading .btn-text {
            visibility: hidden;
        }

        .btn-loading::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* ==================== БЕЙДЖИ И ИНДИКАТОРЫ ==================== */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-xs);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius);
            font-size: var(--font-size-xs);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-primary {
            background: var(--accent-primary);
            color: white;
        }

        .badge-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .badge-success {
            background: var(--success);
            color: white;
        }

        .badge-error {
            background: var(--error);
            color: white;
        }

        .badge-warning {
            background: var(--warning);
            color: white;
        }

        .badge-info {
            background: var(--info);
            color: white;
        }

        .badge-outline {
            background: transparent;
            border: 1px solid var(--border-primary);
            color: var(--text-primary);
        }

        /* ==================== ФОРМЫ И ИНПУТЫ ==================== */
        .form-group {
            margin-bottom: var(--spacing-lg);
        }

        .form-label {
            display: block;
            margin-bottom: var(--spacing-sm);
            font-weight: 600;
            color: var(--text-primary);
            font-size: var(--font-size-sm);
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: var(--spacing-md);
            border: 2px solid var(--border-primary);
            border-radius: var(--border-radius-md);
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: var(--font-size-base);
            transition: all var(--transition-fast);
            font-family: inherit;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-input:disabled,
        .form-select:disabled,
        .form-textarea:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
            line-height: 1.5;
        }

        .form-hint {
            font-size: var(--font-size-sm);
            color: var(--text-tertiary);
            margin-top: var(--spacing-xs);
        }

        .form-error {
            font-size: var(--font-size-sm);
            color: var(--error);
            margin-top: var(--spacing-xs);
        }

        .form-success {
            font-size: var(--font-size-sm);
            color: var(--success);
            margin-top: var(--spacing-xs);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-md);
        }

        .checkbox-group,
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .checkbox-item,
        .radio-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            cursor: pointer;
        }

        .checkbox-input,
        .radio-input {
            width: 18px;
            height: 18px;
            accent-color: var(--accent-primary);
        }

        /* ==================== МОДАЛЬНЫЕ ОКНА ==================== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-overlay);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-md);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            animation: fadeIn var(--transition-fast);
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: var(--border-radius-xl);
            max-width: 90vw;
            max-height: 90vh;
            width: 100%;
            overflow: hidden;
            position: relative;
            box-shadow: var(--shadow-2xl);
            animation: slideInUp var(--transition-normal);
            border: 1px solid var(--border-primary);
        }

        .modal-small {
            max-width: 400px;
        }

        .modal-medium {
            max-width: 600px;
        }

        .modal-large {
            max-width: 800px;
        }

        .modal-fullscreen {
            max-width: 95vw;
            max-height: 95vh;
            border-radius: var(--border-radius-lg);
        }

        .modal-header {
            padding: var(--spacing-xl);
            border-bottom: 1px solid var(--border-primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-secondary);
        }

        .modal-title {
            font-size: var(--font-size-xl);
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-tertiary);
            font-size: 1.5rem;
            cursor: pointer;
            width: 2.5rem;
            height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--border-radius);
            transition: all var(--transition-fast);
        }

        .modal-close:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .modal-body {
            padding: var(--spacing-xl);
            max-height: 60vh;
            overflow-y: auto;
        }

        .modal-footer {
            padding: var(--spacing-xl);
            border-top: 1px solid var(--border-primary);
            display: flex;
            gap: var(--spacing-md);
            justify-content: flex-end;
            background: var(--bg-secondary);
        }

        .modal-footer.center {
            justify-content: center;
        }

        .modal-footer.start {
            justify-content: flex-start;
        }

        /* ==================== МЕДИА ПЛЕЕР ==================== */
        .media-player {
            width: 100%;
            background: #000;
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            position: relative;
        }

        .media-player video {
            width: 100%;
            height: auto;
            display: block;
        }

        .audio-player {
            padding: var(--spacing-xl);
            background: var(--bg-secondary);
            border-radius: var(--border-radius-lg);
            border: 1px solid var(--border-primary);
        }

        .audio-info {
            display: flex;
            align-items: center;
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .audio-cover {
            width: 100px;
            height: 100px;
            border-radius: var(--border-radius-lg);
            object-fit: cover;
            box-shadow: var(--shadow-md);
        }

        .audio-details {
            flex: 1;
        }

        .audio-title {
            font-size: var(--font-size-lg);
            font-weight: 700;
            margin-bottom: var(--spacing-xs);
            color: var(--text-primary);
        }

        .audio-author {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
        }

        .audio-controls {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
        }

        .control-btn {
            background: none;
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            padding: var(--spacing-sm);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
        }

        .control-btn:hover {
            background: var(--bg-tertiary);
            transform: scale(1.1);
        }

        .control-btn.primary {
            background: var(--accent-primary);
            color: white;
        }

        .control-btn.primary:hover {
            background: var(--accent-secondary);
        }

        .control-btn.large {
            font-size: 2rem;
            width: 4rem;
            height: 4rem;
        }

        .audio-progress {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .progress-bar-container {
            background: var(--bg-tertiary);
            height: 6px;
            border-radius: var(--border-radius);
            overflow: hidden;
            cursor: pointer;
            position: relative;
        }

        .progress-bar-fill {
            background: var(--gradient-primary);
            height: 100%;
            width: 0%;
            transition: width var(--transition-fast);
            position: relative;
        }

        .progress-bar-fill::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 12px;
            height: 12px;
            background: var(--accent-primary);
            border-radius: 50%;
            transform: translate(50%, -3px);
            box-shadow: var(--shadow-sm);
        }

        .time-display {
            display: flex;
            justify-content: space-between;
            font-size: var(--font-size-sm);
            color: var(--text-tertiary);
        }

        .audio-volume {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .volume-slider {
            width: 80px;
            height: 4px;
            background: var(--bg-tertiary);
            border-radius: var(--border-radius);
            overflow: hidden;
            cursor: pointer;
        }

        .volume-fill {
            background: var(--accent-primary);
            height: 100%;
            width: 75%;
        }

        /* ==================== УВЕДОМЛЕНИЯ ==================== */
        .notification {
            position: fixed;
            top: var(--spacing-lg);
            right: var(--spacing-lg);
            background: var(--bg-card);
            border: 1px solid var(--border-primary);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-lg);
            max-width: 400px;
            z-index: 3000;
            animation: slideInRight var(--transition-normal);
            box-shadow: var(--shadow-2xl);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .notification.success {
            border-left: 4px solid var(--success);
        }

        .notification.error {
            border-left: 4px solid var(--error);
        }

        .notification.warning {
            border-left: 4px solid var(--warning);
        }

        .notification.info {
            border-left: 4px solid var(--info);
        }

        .notification-content {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-md);
        }

        .notification-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .notification.success .notification-icon {
            color: var(--success);
        }

        .notification.error .notification-icon {
            color: var(--error);
        }

        .notification.warning .notification-icon {
            color: var(--warning);
        }

        .notification.info .notification-icon {
            color: var(--info);
        }

        .notification-text {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
            color: var(--text-primary);
        }

        .notification-message {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
            line-height: 1.4;
        }

        .notification-close {
            background: none;
            border: none;
            color: var(--text-tertiary);
            cursor: pointer;
            padding: var(--spacing-xs);
            border-radius: var(--border-radius);
            transition: all var(--transition-fast);
            flex-shrink: 0;
        }

        .notification-close:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        /* ==================== ПУСТЫЕ СОСТОЯНИЯ ==================== */
        .empty-state {
            text-align: center;
            padding: var(--spacing-2xl);
            color: var(--text-secondary);
            max-width: 500px;
            margin: 0 auto;
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: var(--spacing-lg);
            opacity: 0.5;
        }

        .empty-title {
            font-size: var(--font-size-xl);
            font-weight: 600;
            margin-bottom: var(--spacing-md);
            color: var(--text-primary);
        }

        .empty-description {
            font-size: var(--font-size-base);
            margin-bottom: var(--spacing-xl);
            line-height: 1.6;
        }

        .empty-actions {
            display: flex;
            gap: var(--spacing-md);
            justify-content: center;
            flex-wrap: wrap;
        }

        /* ==================== АДМИН ПАНЕЛЬ ==================== */
        .admin-panel {
            padding: var(--spacing-lg);
        }

        .admin-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: var(--spacing-2xl);
            padding-bottom: var(--spacing-lg);
            border-bottom: 2px solid var(--border-primary);
        }

        .admin-tabs {
            display: flex;
            gap: var(--spacing-xs);
            margin-bottom: var(--spacing-2xl);
            border-bottom: 1px solid var(--border-primary);
            padding-bottom: var(--spacing-xs);
            flex-wrap: wrap;
        }

        .admin-tab {
            padding: var(--spacing-md) var(--spacing-lg);
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: var(--border-radius-md) var(--border-radius-md) 0 0;
            transition: all var(--transition-fast);
            font-weight: 500;
            position: relative;
        }

        .admin-tab:hover {
            color: var(--text-primary);
            background: var(--bg-tertiary);
        }

        .admin-tab.active {
            background: var(--accent-primary);
            color: white;
        }

        .admin-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--accent-primary);
        }

        .admin-content {
            background: var(--bg-card);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-xl);
            border: 1px solid var(--border-primary);
            box-shadow: var(--shadow-md);
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-2xl);
        }

        .admin-stat {
            background: var(--bg-secondary);
            padding: var(--spacing-xl);
            border-radius: var(--border-radius-lg);
            text-align: center;
            border: 1px solid var(--border-primary);
            transition: transform var(--transition-fast);
        }

        .admin-stat:hover {
            transform: translateY(-5px);
        }

        .admin-stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: var(--spacing-sm);
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .admin-stat-label {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-card);
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-md);
        }

        .admin-table th,
        .admin-table td {
            padding: var(--spacing-md);
            text-align: left;
            border-bottom: 1px solid var(--border-primary);
        }

        .admin-table th {
            background: var(--bg-secondary);
            font-weight: 600;
            color: var(--text-primary);
            font-size: var(--font-size-sm);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .admin-table tr:hover {
            background: var(--bg-secondary);
        }

        .admin-actions {
            display: flex;
            gap: var(--spacing-xs);
        }

        /* ==================== АНИМАЦИИ ==================== */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% {
                transform: translate3d(0,0,0);
            }
            40%, 43% {
                transform: translate3d(0,-30px,0);
            }
            70% {
                transform: translate3d(0,-15px,0);
            }
            90% {
                transform: translate3d(0,-4px,0);
            }
        }

        @keyframes pulse {
            0% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            }
            70% {
                transform: scale(1);
                box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
            }
            100% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
            }
        }

        @keyframes dots {
            0%, 20% {
                color: rgba(0,0,0,0);
                text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0);
            }
            40% {
                color: var(--text-secondary);
                text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0);
            }
            60% {
                text-shadow: .25em 0 0 var(--text-secondary), .5em 0 0 rgba(0,0,0,0);
            }
            80%, 100% {
                text-shadow: .25em 0 0 var(--text-secondary), .5em 0 0 var(--text-secondary);
            }
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100%);
            }
        }

        /* ==================== АДАПТИВНОСТЬ ==================== */
        @media (max-width: 1024px) {
            .hero-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .main-navigation-grid {
                grid-template-columns: 1fr;
            }
            
            .content-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .header-brand .brand-text {
                display: none;
            }
            
            .hero-title {
                font-size: var(--font-size-3xl);
            }
            
            .hero-subtitle {
                font-size: var(--font-size-lg);
            }
            
            .hero-search {
                flex-direction: column;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--spacing-md);
            }
            
            .content-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .modal-footer {
                flex-direction: column;
            }
            
            .admin-tabs {
                flex-direction: column;
            }
            
            .admin-tab {
                border-radius: var(--border-radius-md);
            }
            
            .admin-tab.active::after {
                display: none;
            }
        }

        @media (max-width: 480px) {
            .main-content {
                padding: var(--spacing-md);
            }
            
            .hero-section {
                padding: var(--spacing-xl) var(--spacing-lg);
            }
            
            .hero-title {
                font-size: var(--font-size-2xl);
            }
            
            .nav-scroll-container {
                padding: 0 var(--spacing-sm);
            }
            
            .nav-btn {
                min-width: 60px;
                padding: var(--spacing-xs);
            }
            
            .nav-icon {
                font-size: 1.25rem;
            }
            
            .nav-label {
                font-size: 0.6rem;
            }
            
            .modal-content {
                max-width: 95vw;
                max-height: 95vh;
            }
            
            .modal-body {
                padding: var(--spacing-lg);
            }
            
            .empty-actions {
                flex-direction: column;
            }
        }

        /* ==================== УТИЛИТЫ ==================== */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .text-center {
            text-align: center;
        }

        .text-left {
            text-align: left;
        }

        .text-right {
            text-align: right;
        }

        .mt-1 { margin-top: var(--spacing-xs); }
        .mt-2 { margin-top: var(--spacing-sm); }
        .mt-3 { margin-top: var(--spacing-md); }
        .mt-4 { margin-top: var(--spacing-lg); }
        .mt-5 { margin-top: var(--spacing-xl); }

        .mb-1 { margin-bottom: var(--spacing-xs); }
        .mb-2 { margin-bottom: var(--spacing-sm); }
        .mb-3 { margin-bottom: var(--spacing-md); }
        .mb-4 { margin-bottom: var(--spacing-lg); }
        .mb-5 { margin-bottom: var(--spacing-xl); }

        .p-1 { padding: var(--spacing-xs); }
        .p-2 { padding: var(--spacing-sm); }
        .p-3 { padding: var(--spacing-md); }
        .p-4 { padding: var(--spacing-lg); }
        .p-5 { padding: var(--spacing-xl); }

        .d-flex { display: flex; }
        .d-grid { display: grid; }
        .d-none { display: none; }
        .d-block { display: block; }
        .d-inline { display: inline; }
        .d-inline-block { display: inline-block; }

        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .justify-around { justify-content: space-around; }
        .justify-end { justify-content: flex-end; }

        .items-center { align-items: center; }
        .items-start { align-items: flex-start; }
        .items-end { align-items: flex-end; }
        .items-stretch { align-items: stretch; }

        .flex-1 { flex: 1; }
        .flex-auto { flex: auto; }
        .flex-none { flex: none; }

        .w-full { width: 100%; }
        .w-auto { width: auto; }
        .h-full { height: 100%; }
        .h-auto { height: auto; }

        .overflow-hidden { overflow: hidden; }
        .overflow-auto { overflow: auto; }
        .overflow-visible { overflow: visible; }

        .relative { position: relative; }
        .absolute { position: absolute; }
        .fixed { position: fixed; }
        .sticky { position: sticky; }

        .cursor-pointer { cursor: pointer; }
        .cursor-not-allowed { cursor: not-allowed; }
        .cursor-default { cursor: default; }

        .select-none { user-select: none; }
        .select-text { user-select: text; }
        .select-all { user-select: all; }

        .pointer-events-none { pointer-events: none; }
        .pointer-events-auto { pointer-events: auto; }

        .opacity-0 { opacity: 0; }
        .opacity-25 { opacity: 0.25; }
        .opacity-50 { opacity: 0.5; }
        .opacity-75 { opacity: 0.75; }
        .opacity-100 { opacity: 1; }

        .transition { transition: all var(--transition-normal); }
        .transition-fast { transition: all var(--transition-fast); }
        .transition-slow { transition: all var(--transition-slow); }

        .rounded { border-radius: var(--border-radius); }
        .rounded-lg { border-radius: var(--border-radius-lg); }
        .rounded-full { border-radius: 50%; }

        .shadow { box-shadow: var(--shadow-md); }
        .shadow-lg { box-shadow: var(--shadow-lg); }
        .shadow-xl { box-shadow: var(--shadow-xl); }
        .shadow-none { box-shadow: none; }

        .bg-primary { background: var(--bg-primary); }
        .bg-secondary { background: var(--bg-secondary); }
        .bg-tertiary { background: var(--bg-tertiary); }
        .bg-card { background: var(--bg-card); }

        .text-primary { color: var(--text-primary); }
        .text-secondary { color: var(--text-secondary); }
        .text-tertiary { color: var(--text-tertiary); }
        .text-muted { color: var(--text-muted); }
        .text-inverse { color: var(--text-inverse); }

        .border { border: 1px solid var(--border-primary); }
        .border-2 { border: 2px solid var(--border-primary); }
        .border-none { border: none; }

        .z-0 { z-index: 0; }
        .z-10 { z-index: 10; }
        .z-20 { z-index: 20; }
        .z-30 { z-index: 30; }
        .z-40 { z-index: 40; }
        .z-50 { z-index: 50; }
    </style>
</head>
<body>
    <!-- Загрузочный экран -->
    <div id="loadingScreen" class="loading-container">
        <div class="loading-spinner"></div>
        <div class="loading-text">Загрузка Академии АНБ<span class="loading-dots">...</span></div>
    </div>
    
    <!-- Экран ошибки -->
    <div id="errorScreen" class="error-container">
        <div class="error-icon">⚠️</div>
        <div class="error-title">Ошибка загрузки</div>
        <div class="error-description" id="errorMessage">Не удалось загрузить приложение. Пожалуйста, проверьте подключение к интернету и попробуйте снова.</div>
        <div class="error-actions">
            <button id="retryButton" class="btn btn-primary">🔄 Попробовать снова</button>
            <button onclick="window.location.reload()" class="btn btn-outline">🔄 Перезагрузить страницу</button>
        </div>
    </div>

    <!-- Основное приложение -->
    <div id="app">
        <!-- Верхний хедер -->
        <header class="top-header">
            <div class="header-container">
                <div class="header-brand">
                    <span class="brand-icon">🎓</span>
                    <span class="brand-text">Академия АНБ</span>
                </div>
                <div class="header-actions">
                    <div class="header-search" id="headerSearch">
                        <input type="text" class="search-input-header" placeholder="Поиск курсов, материалов...">
                        <span class="search-icon-header">🔍</span>
                    </div>
                    <div id="adminBadge" class="admin-badge">
                        <span>🔧</span>
                        <span>Админ</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Основной контент -->
        <main id="mainContent" class="main-content">
            <!-- Контент будет загружен через JavaScript -->
        </main>

        <!-- Нижняя навигация -->
        <nav class="bottom-nav">
            <div class="nav-scroll-container">
                <button class="nav-btn active" data-page="home">
                    <span class="nav-icon">🏠</span>
                    <span class="nav-label">Главная</span>
                </button>
                <button class="nav-btn" data-page="courses">
                    <span class="nav-icon">📚</span>
                    <span class="nav-label">Курсы</span>
                </button>
                <button class="nav-btn" data-page="podcasts">
                    <span class="nav-icon">🎧</span>
                    <span class="nav-label">Подкасты</span>
                </button>
                <button class="nav-btn" data-page="streams">
                    <span class="nav-icon">📹</span>
                    <span class="nav-label">Эфиры</span>
                </button>
                <button class="nav-btn" data-page="videos">
                    <span class="nav-icon">🎯</span>
                    <span class="nav-label">Видео</span>
                </button>
                <button class="nav-btn" data-page="materials">
                    <span class="nav-icon">📋</span>
                    <span class="nav-label">Материалы</span>
                </button>
                <button class="nav-btn" data-page="events">
                    <span class="nav-icon">🗺️</span>
                    <span class="nav-label">Мероприятия</span>
                </button>
                <button class="nav-btn" data-page="favorites">
                    <span class="nav-icon">❤️</span>
                    <span class="nav-label">Избранное</span>
                    <span class="nav-badge" id="favoritesCount">0</span>
                </button>
                <button class="nav-btn" data-page="profile">
                    <span class="nav-icon">👤</span>
                    <span class="nav-label">Профиль</span>
                </button>
            </div>
        </nav>
    </div>

    <!-- Модальные окна -->
    <div id="mediaModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <div class="modal-title" id="mediaModalTitle">Медиа контент</div>
                <button class="modal-close" onclick="app.closeMediaModal()">×</button>
            </div>
            <div class="modal-body" id="mediaModalBody">
                <!-- Контент медиа будет загружен сюда -->
            </div>
        </div>
    </div>

    <div id="subscriptionModal" class="modal">
        <div class="modal-content modal-medium">
            <div class="modal-header">
                <div class="modal-title">Выбор подписки</div>
                <button class="modal-close" onclick="app.closeSubscriptionModal()">×</button>
            </div>
            <div class="modal-body" id="subscriptionModalBody">
                <!-- Контент подписки будет загружен сюда -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="app.closeSubscriptionModal()">Отмена</button>
                <button class="btn btn-primary" onclick="app.processSubscription()">Оформить подписку</button>
            </div>
        </div>
    </div>

    <div id="settingsModal" class="modal">
        <div class="modal-content modal-medium">
            <div class="modal-header">
                <div class="modal-title">Настройки приложения</div>
                <button class="modal-close" onclick="app.closeSettingsModal()">×</button>
            </div>
            <div class="modal-body" id="settingsModalBody">
                <!-- Настройки будут загружены сюда -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="app.closeSettingsModal()">Отмена</button>
                <button class="btn btn-primary" onclick="app.saveSettings()">Сохранить настройки</button>
            </div>
        </div>
    </div>

    <div id="searchModal" class="modal">
        <div class="modal-content modal-fullscreen">
            <div class="modal-header">
                <div class="modal-title">Поиск по платформе</div>
                <button class="modal-close" onclick="app.closeSearchModal()">×</button>
            </div>
            <div class="modal-body" id="searchModalBody">
                <!-- Результаты поиска будут загружены сюда -->
            </div>
        </div>
    </div>

    <div id="playerModal" class="modal">
        <div class="modal-content modal-fullscreen">
            <div class="modal-header">
                <div class="modal-title" id="playerModalTitle">Воспроизведение</div>
                <button class="modal-close" onclick="app.closePlayerModal()">×</button>
            </div>
            <div class="modal-body" id="playerModalBody">
                <!-- Плеер будет загружен сюда -->
            </div>
        </div>
    </div>

    <script>
        // ==================== ОСНОВНОЙ КЛАСС ПРИЛОЖЕНИЯ ====================
        class AcademyApp {
            constructor() {
                console.log('🎓 Инициализация Академии АНБ...');
                
                // Основное состояние приложения
                this.currentPage = 'home';
                this.currentSubPage = '';
                this.previousPage = '';
                this.isAdmin = false;
                this.isSuperAdmin = false;
                this.isLoading = false;
                this.isOnline = navigator.onLine;
                
                // Система контента
                this.allContent = {};
                this.filteredContent = {};
                this.contentCache = new Map();
                
                // Состояние пользователя
                this.state = {
                    user: null,
                    favorites: {
                        courses: new Set(),
                        podcasts: new Set(),
                        streams: new Set(),
                        videos: new Set(),
                        materials: new Set(),
                        events: new Set()
                    },
                    progress: {
                        courses: {},
                        podcasts: {},
                        streams: {},
                        videos: {},
                        materials: {},
                        events: {},
                        overall: {
                            level: 'Новичок',
                            experience: 0,
                            completedCourses: 0,
                            completedModules: 0,
                            studyHours: 0,
                            streak: 0,
                            lastActivity: null
                        }
                    },
                    settings: {
                        theme: 'dark',
                        language: 'ru',
                        notifications: true,
                        autoPlay: false,
                        downloadQuality: 'high',
                        offlineMode: false,
                        dataSaving: false,
                        playbackSpeed: 1.0
                    },
                    cart: new Set(),
                    recentlyViewed: [],
                    searchHistory: [],
                    subscriptions: [],
                    achievements: new Set()
                };
                
                // Система фильтрации
                this.filters = {
                    courses: {
                        category: 'all',
                        level: 'all',
                        price: 'all',
                        duration: 'all',
                        rating: 'all',
                        sort: 'newest',
                        search: '',
                        instructor: 'all',
                        tags: []
                    },
                    podcasts: {
                        category: 'all',
                        duration: 'all',
                        sort: 'newest',
                        search: '',
                        speaker: 'all'
                    },
                    streams: {
                        category: 'all',
                        status: 'all',
                        sort: 'newest',
                        search: '',
                        date: 'all'
                    },
                    videos: {
                        category: 'all',
                        duration: 'all',
                        sort: 'popular',
                        search: '',
                        quality: 'all'
                    },
                    materials: {
                        category: 'all',
                        type: 'all',
                        sort: 'newest',
                        search: '',
                        format: 'all'
                    },
                    events: {
                        category: 'all',
                        type: 'all',
                        status: 'upcoming',
                        sort: 'date',
                        search: '',
                        location: 'all'
                    }
                };
                
                // Система подписок
                this.subscriptionState = {
                    selectedPlan: null,
                    selectedPeriod: 'monthly',
                    paymentMethod: null,
                    billingInfo: {},
                    couponCode: ''
                };
                
                // Медиа система
                this.mediaPlayers = {
                    video: null,
                    audio: null,
                    current: null
                };
                
                this.currentAudioPlayer = null;
                this.currentVideoPlayer = null;
                this.mediaPlaybackState = {
                    isPlaying: false,
                    currentTime: 0,
                    duration: 0,
                    volume: 1,
                    playbackRate: 1.0
                };
                
                // Навигация и UI
                this.navigationItems = [];
                this.subscriptionPlans = [];
                this.instructors = [];
                this.categories = {};
                this.tags = {};
                
                // Поиск и данные
                this.searchTerm = '';
                this.searchResults = {};
                this.currentNewsFilter = 'Все';
                this.notifications = [];
                this.pendingActions = [];
                
                // Конфигурация
                this.config = {
                    API_BASE_URL: 'https://api.anb-academy.ru',
                    UPLOAD_LIMIT: 100 * 1024 * 1024, // 100MB
                    CACHE_TTL: 5 * 60 * 1000, // 5 минут
                    OFFLINE_STORAGE: 'academyApp_offline',
                    ANALYTICS_ENABLED: true,
                    DEBUG_MODE: false
                };
                
                // Инициализация систем
                this.initializeData();
                this.setupErrorHandling();
                this.setupOnlineStatus();
            }

            // ==================== ИНИЦИАЛИЗАЦИЯ ДАННЫХ ====================
            initializeData() {
                console.log('📦 Инициализация данных приложения...');
                
                // Создание демо пользователя
                this.createDemoUser();
                
                // Загрузка демо контента
                this.createDemoContent();
                
                // Загрузка дополнительных данных
                this.loadNavigationData();
                this.loadSubscriptionData();
                this.loadInstructorData();
                this.loadCategoryData();
                this.loadAchievementData();
                
                // Восстановление состояния
                this.restoreAppState();
                
                console.log('✅ Данные инициализированы');
            }

            createDemoUser() {
                this.state.user = {
                    id: 898508164,
                    firstName: 'Александр',
                    lastName: 'Петров',
                    email: 'alexander.petrov@anb-academy.ru',
                    phone: '+7 (999) 123-45-67',
                    avatar: null,
                    role: 'doctor',
                    specialization: 'Неврология',
                    experience: 8,
                    location: 'Москва',
                    bio: 'Врач-невролог с 8-летним опытом работы. Специализируюсь на мануальной терапии и реабилитации пациентов с неврологическими нарушениями.',
                    isAdmin: true,
                    isSuperAdmin: true,
                    isVerified: true,
                    isPremium: true,
                    hasActiveSubscription: true,
                    subscription: {
                        plan: 'professional',
                        period: 'yearly',
                        startsAt: new Date('2024-01-01'),
                        endsAt: new Date('2025-01-01'),
                        autoRenew: true,
                        price: 59000
                    },
                    stats: {
                        coursesCompleted: 12,
                        hoursStudied: 156,
                        certificates: 8,
                        communityPoints: 2450
                    },
                    preferences: {
                        emailNotifications: true,
                        pushNotifications: true,
                        weeklyDigest: true,
                        courseRecommendations: true
                    },
                    social: {
                        telegram: '@alexander_neurolog',
                        whatsapp: '+79991234567',
                        email: 'alexander.petrov@anb-academy.ru'
                    },
                    joinDate: new Date('2023-03-15'),
                    lastActive: new Date(),
                    timezone: 'Europe/Moscow'
                };
                
                this.isAdmin = true;
                this.isSuperAdmin = true;
            }

            createDemoContent() {
                console.log('🎨 Создание демо контента...');
                
                // Курсы
                this.allContent.courses = [
                    {
                        id: 1,
                        title: 'Мануальные техники в практике невролога',
                        description: 'Комплексный курс по современным мануальным методикам диагностики и лечения заболеваний позвоночника. Изучите передовые техники работы с пациентами.',
                        fullDescription: `Этот курс предоставляет глубокое понимание мануальных техник, используемых в современной неврологии. Вы изучите:
                        
• Анатомию и биомеханику позвоночника
• Диагностические методики
• Мануальные техники коррекции
• Реабилитационные протоколы
• Работу с осложненными случаями

Курс включает практические занятия и разбор реальных клинических случаев.`,
                        price: 25000,
                        discount: 16,
                        finalPrice: 21000,
                        duration: '12 недель',
                        modules: 6,
                        lessons: 24,
                        category: 'manual_therapy',
                        subcategory: 'neurology',
                        level: 'advanced',
                        difficulty: 4,
                        studentsCount: 156,
                        rating: 4.8,
                        reviews: 47,
                        featured: true,
                        new: false,
                        popular: true,
                        certificate: true,
                        imageUrl: 'https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=600&h=400&fit=crop',
                        videoUrl: 'https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4',
                        trailerUrl: 'https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4',
                        instructors: [1, 2],
                        tags: ['мануальная терапия', 'неврология', 'позвоночник', 'реабилитация'],
                        learningObjectives: [
                            'Освоить основные мануальные техники',
                            'Научиться диагностировать нарушения',
                            'Разрабатывать планы лечения',
                            'Работать с осложненными случаями'
                        ],
                        requirements: [
                            'Высшее медицинское образование',
                            'Базовые знания неврологии',
                            'Опыт работы от 1 года'
                        ],
                        created: new Date('2024-01-15'),
                        updated: new Date('2024-03-20'),
                        language: 'ru',
                        subtitles: ['ru', 'en'],
                        access: 'subscription',
                        status: 'published'
                    },
                    {
                        id: 2,
                        title: 'Неврологическая диагностика: современные подходы',
                        description: '5 модулей по современной диагностике неврологических заболеваний с использованием новейшего оборудования и методик.',
                        fullDescription: `Углубленный курс по современным методам диагностики в неврологии.`,
                        price: 18000,
                        discount: 0,
                        finalPrice: 18000,
                        duration: '8 недель',
                        modules: 5,
                        lessons: 18,
                        category: 'neurology',
                        subcategory: 'diagnostics',
                        level: 'intermediate',
                        difficulty: 3,
                        studentsCount: 234,
                        rating: 4.6,
                        reviews: 89,
                        featured: true,
                        new: true,
                        popular: true,
                        certificate: true,
                        imageUrl: 'https://images.unsplash.com/photo-1551601651-2a8555f1a136?w=600&h=400&fit=crop',
                        videoUrl: 'https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4',
                        instructors: [1, 3],
                        tags: ['диагностика', 'неврология', 'обследование', 'анализы'],
                        created: new Date('2024-02-01'),
                        updated: new Date('2024-03-15'),
                        language: 'ru',
                        access: 'subscription',
                        status: 'published'
                    }
                ];

                // Подкасты
                this.allContent.podcasts = [
                    {
                        id: 1,
                        title: 'АНБ FM: Современная неврология и вызовы времени',
                        description: 'Еженедельные обсуждения новых тенденций, исследований и клинических случаев в неврологии с ведущими специалистами.',
                        fullDescription: 'Подкаст для врачей-неврологов, где мы обсуждаем актуальные вопросы современной неврологии.',
                        duration: '45:20',
                        fileSize: '42.5 MB',
                        category: 'neurology',
                        speaker: 'Доктор Иванов А.В.',
                        guests: ['Проф. Сидоров П.К.'],
                        listens: 2345,
                        likes: 156,
                        episode: 24,
                        season: 2,
                        explicit: false,
                        featured: true,
                        imageUrl: 'https://images.unsplash.com/photo-1478737270239-2f02b77fc618?w=600&h=400&fit=crop',
                        audioUrl: 'https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4',
                        transcriptUrl: null,
                        tags: ['обсуждение', 'новости', 'клинические случаи'],
                        created: new Date('2024-03-10'),
                        published: true
                    }
                ];

                // Прямые эфиры
                this.allContent.streams = [
                    {
                        id: 1,
                        title: 'LIVE: Ответы на вопросы по мануальной терапии - специальный выпуск',
                        description: 'Прямой эфир с ответами на ваши вопросы по мануальным техникам. Разбор сложных случаев и демонстрация методик.',
                        fullDescription: 'Специальный extended выпуск с углубленным разбором вопросов.',
                        duration: '2:15:00',
                        category: 'manual_therapy',
                        type: 'qna',
                        isLive: true,
                        wasLive: false,
                        scheduledStart: new Date(Date.now() + 2 * 60 * 60 * 1000), // Через 2 часа
                        actualStart: null,
                        actualEnd: null,
                        viewers: 89,
                        maxViewers: 156,
                        likes: 23,
                        comments: 47,
                        recordingUrl: null,
                        chatEnabled: true,
                        questionsEnabled: true,
                        pollEnabled: true,
                        featured: true,
                        imageUrl: 'https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=600&h=400&fit=crop',
                        instructors: [1],
                        tags: ['мануальная терапия', 'вопрос-ответ', 'демонстрация'],
                        created: new Date('2024-03-18'),
                        status: 'scheduled'
                    }
                ];

                // Видео уроки
                this.allContent.videos = [
                    {
                        id: 1,
                        title: 'Техника мобилизации шейного отдела позвоночника',
                        description: 'Подробный разбор техники мобилизации с анатомическим обоснованием и показаниями к применению.',
                        duration: '18:35',
                        category: 'manual_therapy',
                        quality: '1080p',
                        views: 1247,
                        likes: 89,
                        dislikes: 2,
                        featured: true,
                        free: true,
                        imageUrl: 'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=600&h=400&fit=crop',
                        videoUrl: 'https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4',
                        instructors: [1],
                        tags: ['шейный отдел', 'мобилизация', 'техника'],
                        created: new Date('2024-02-15'),
                        difficulty: 'intermediate'
                    }
                ];

                // Материалы
                this.allContent.materials = [
                    {
                        id: 1,
                        title: 'Протоколы диагностики болей в спине',
                        description: 'Подробные клинические протоколы и алгоритмы диагностики различных типов болей в спине.',
                        type: 'pdf',
                        category: 'neurology',
                        fileSize: '2.4 MB',
                        pages: 24,
                        downloads: 567,
                        featured: true,
                        free: false,
                        imageUrl: 'https://images.unsplash.com/photo-1589998059171-988d887df646?w=600&h=400&fit=crop',
                        fileUrl: '#',
                        instructors: [2],
                        tags: ['диагностика', 'протоколы', 'боль в спине'],
                        created: new Date('2024-01-20'),
                        language: 'ru'
                    }
                ];

                // Мероприятия
                this.allContent.events = [
                    {
                        id: 1,
                        title: 'Ежегодная конференция "Современная неврология 2024"',
                        description: 'Крупнейшее событие года для неврологов с участием международных экспертов.',
                        fullDescription: 'Конференция с участием ведущих специалистов со всего мира.',
                        type: 'offline',
                        category: 'conference',
                        date: new Date('2024-12-15T10:00:00'),
                        endDate: new Date('2024-12-17T18:00:00'),
                        location: 'Москва, ул. Профессиональная, 15',
                        online: false,
                        capacity: 300,
                        registered: 234,
                        price: 15000,
                        earlyBirdPrice: 12000,
                        earlyBirdUntil: new Date('2024-06-01'),
                        featured: true,
                        imageUrl: 'https://images.unsplash.com/photo-1540575467063-178a50c2df87?w=600&h=400&fit=crop',
                        registrationUrl: '#',
                        agenda: [],
                        speakers: [1, 2, 3],
                        tags: ['конференция', 'международная', 'эксперты'],
                        created: new Date('2024-01-10'),
                        status: 'upcoming'
                    }
                ];

                // Новости
                this.allContent.news = [
                    {
                        id: 1,
                        title: 'Новые методики в реабилитации пациентов с инсультом',
                        description: 'Обзор современных подходов и инновационных методик в реабилитации постинсультных пациентов.',
                        content: 'Полный текст статьи с исследованиями и клиническими рекомендациями...',
                        category: 'rehabilitation',
                        type: 'article',
                        author: 'Редакция АНБ',
                        date: '15 декабря 2024',
                        views: 1245,
                        likes: 89,
                        featured: true,
                        imageUrl: 'https://images.unsplash.com/photo-1576091160399-112ba8d25d1f?w=600&h=400&fit=crop',
                        tags: ['реабилитация', 'инсульт', 'инновации'],
                        created: new Date('2024-03-15')
                    }
                ];

                console.log('✅ Демо контент создан');
            }

            loadNavigationData() {
                this.navigationItems = [
                    { 
                        id: 1, 
                        title: 'Курсы', 
                        page: 'courses', 
                        icon: '📚',
                        description: 'Системное обучение с сертификатами',
                        color: 'primary',
                        imageUrl: 'https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400&h=250&fit=crop'
                    },
                    { 
                        id: 2, 
                        title: 'Подкасты', 
                        page: 'podcasts', 
                        icon: '🎧',
                        description: 'Аудиоуроки для обучения в дороге',
                        color: 'secondary',
                        imageUrl: 'https://images.unsplash.com/photo-1478737270239-2f02b77fc618?w=400&h=250&fit=crop'
                    },
                    { 
                        id: 3, 
                        title: 'Эфиры', 
                        page: 'streams', 
                        icon: '📹',
                        description: 'Прямые трансляции с экспертами',
                        color: 'error',
                        imageUrl: 'https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400&h=250&fit=crop'
                    },
                    { 
                        id: 4, 
                        title: 'Видео', 
                        page: 'videos', 
                        icon: '🎯',
                        description: 'Короткие обучающие видео',
                        color: 'success',
                        imageUrl: 'https://images.unsplash.com/photo-1551601651-2a8555f1a136?w=400&h=250&fit=crop'
                    },
                    { 
                        id: 5, 
                        title: 'Материалы', 
                        page: 'materials', 
                        icon: '📋',
                        description: 'Презентации, статьи и методички',
                        color: 'warning',
                        imageUrl: 'https://images.unsplash.com/photo-1589998059171-988d887df646?w=400&h=250&fit=crop'
                    },
                    { 
                        id: 6, 
                        title: 'Мероприятия', 
                        page: 'events', 
                        icon: '🗺️',
                        description: 'Конференции и семинары',
                        color: 'info',
                        imageUrl: 'https://images.unsplash.com/photo-1540575467063-178a50c2df87?w=400&h=250&fit=crop'
                    }
                ];
            }

            loadSubscriptionData() {
                this.subscriptionPlans = [
                    {
                        id: 1,
                        name: 'Базовый',
                        description: 'Идеально для начинающих специалистов',
                        price_monthly: 2900,
                        price_quarterly: 7500,
                        price_yearly: 27000,
                        currency: 'RUB',
                        features: [
                            'Доступ к 3 курсам в месяц',
                            'Базовые материалы и статьи',
                            'Участие в 1 вебинаре в месяц',
                            'Поддержка по email',
                            'Сертификаты о прохождении'
                        ],
                        limitations: [
                            'Нет доступа к премиум курсам',
                            'Ограниченная техподдержка',
                            'Нет офлайн доступа'
                        ],
                        popular: false,
                        recommended: false
                    },
                    {
                        id: 2,
                        name: 'Профессиональный',
                        description: 'Для практикующих врачей',
                        price_monthly: 5900,
                        price_quarterly: 15000,
                        price_yearly: 54000,
                        currency: 'RUB',
                        features: [
                            'Неограниченный доступ ко всем курсам',
                            'Все материалы и библиотека',
                            'Участие во всех вебинарах',
                            'Приоритетная поддержка 24/7',
                            'Офлайн доступ к контенту',
                            'Персональный сертификат',
                            'Ранний доступ к новым курсам'
                        ],
                        limitations: [
                            'Нет менторской поддержки',
                            'Ограниченное количество консультаций'
                        ],
                        popular: true,
                        recommended: true
                    },
                    {
                        id: 3,
                        name: 'Премиум',
                        description: 'Для экспертов и руководителей',
                        price_monthly: 9900,
                        price_quarterly: 25000,
                        price_yearly: 89000,
                        currency: 'RUB',
                        features: [
                            'Все возможности Профессионального тарифа',
                            'Персональный менеджер',
                            'Индивидуальные консультации',
                            'Участие в закрытых мероприятиях',
                            'Доступ к эксклюзивному контенту',
                            'Возможность стать спикером',
                            'Сертификат эксперта'
                        ],
                        limitations: [],
                        popular: false,
                        recommended: false
                    }
                ];
            }

            loadInstructorData() {
                this.instructors = [
                    {
                        id: 1,
                        name: 'Доктор Иванов Александр Викторович',
                        specialization: 'Неврология, Мануальная терапия, Реабилитация',
                        role: 'Ведущий специалист, к.м.н.',
                        experience: 15,
                        bio: 'Кандидат медицинских наук, ведущий специалист по мануальной терапии. Автор 3-х монографий и 47 научных статей. Специализируется на лечении болей в спине и реабилитации неврологических пациентов.',
                        shortBio: 'Ведущий специалист по мануальной терапии, автор методик лечения болей в спине.',
                        avatarUrl: 'https://images.unsplash.com/photo-1612349317150-e413f6a5b16d?w=300&h=300&fit=crop&crop=face',
                        coverUrl: 'https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=800&h=400&fit=crop',
                        email: 'ivanov@anb-academy.ru',
                        phone: '+7 (495) 123-45-67',
                        social: {
                            telegram: '@dr_ivanov',
                            instagram: '@dr_ivanov_neurology',
                            youtube: 'Доктор Иванов'
                        },
                        stats: {
                            courses: 12,
                            students: 2456,
                            rating: 4.9,
                            reviews: 347
                        },
                        achievements: [
                            'Лучший преподаватель года 2023',
                            'Эксперт в мануальной терапии',
                            'Автор инновационных методик'
                        ],
                        verified: true,
                        featured: true,
                        joinDate: new Date('2020-05-15')
                    },
                    {
                        id: 2,
                        name: 'Профессор Сидоров Петр Константинович',
                        specialization: 'Неврология, Диагностика, Исследования',
                        role: 'Профессор, д.м.н.',
                        experience: 25,
                        bio: 'Доктор медицинских наук, профессор кафедры неврологии. Автор более 200 научных работ. Специалист в области диагностики и лечения сложных неврологических заболеваний.',
                        avatarUrl: 'https://images.unsplash.com/photo-1582750433449-648ed127bb54?w=300&h=300&fit=crop&crop=face',
                        verified: true,
                        featured: true
                    }
                ];
            }

            loadCategoryData() {
                this.categories = {
                    courses: {
                        manual_therapy: 'Мануальная терапия',
                        neurology: 'Неврология',
                        rehabilitation: 'Реабилитация',
                        diagnostics: 'Диагностика',
                        pediatric: 'Педиатрическая неврология',
                        geriatric: 'Гериатрическая неврология'
                    },
                    levels: {
                        beginner: 'Начинающий',
                        intermediate: 'Средний',
                        advanced: 'Продвинутый',
                        expert: 'Экспертный'
                    }
                };
            }

            loadAchievementData() {
                this.achievements = {
                    course_completions: [
                        { id: 1, name: 'Первый шаг', description: 'Завершить первый курс', icon: '🎯' },
                        { id: 2, name: 'Усердный студент', description: 'Завершить 5 курсов', icon: '📚' },
                        { id: 3, name: 'Профессионал', description: 'Завершить 15 курсов', icon: '🏆' }
                    ],
                    community: [
                        { id: 4, name: 'Активный участник', description: 'Задать 10 вопросов', icon: '💬' },
                        { id: 5, name: 'Помощник', description: 'Ответить на 20 вопросов', icon: '🤝' }
                    ],
                    special: [
                        { id: 6, name: 'Ранняя пташка', description: 'Присоединиться в течение первого месяца', icon: '🐦' },
                        { id: 7, name: 'Премиум член', description: 'Активировать премиум подписку', icon: '⭐' }
                    ]
                };
            }

            // ==================== СИСТЕМА СОХРАНЕНИЯ СОСТОЯНИЯ ====================
            saveAppState() {
                try {
                    const state = {
                        user: this.state.user,
                        favorites: {
                            courses: Array.from(this.state.favorites.courses),
                            podcasts: Array.from(this.state.favorites.podcasts),
                            streams: Array.from(this.state.favorites.streams),
                            videos: Array.from(this.state.favorites.videos),
                            materials: Array.from(this.state.favorites.materials),
                            events: Array.from(this.state.favorites.events)
                        },
                        progress: this.state.progress,
                        settings: this.state.settings,
                        cart: Array.from(this.state.cart),
                        recentlyViewed: this.state.recentlyViewed,
                        searchHistory: this.state.searchHistory,
                        subscriptions: this.state.subscriptions,
                        achievements: Array.from(this.state.achievements),
                        filters: this.filters,
                        currentPage: this.currentPage,
                        currentSubPage: this.currentSubPage
                    };
                    
                    localStorage.setItem('academyAppState', JSON.stringify(state));
                    console.log('💾 Состояние приложения сохранено');
                } catch (error) {
                    console.error('❌ Ошибка сохранения состояния:', error);
                }
            }

            restoreAppState() {
                try {
                    const saved = localStorage.getItem('academyAppState');
                    if (saved) {
                        const state = JSON.parse(saved);
                        
                        // Восстановление сложных структур
                        this.state.favorites = {
                            courses: new Set(state.favorites?.courses || []),
                            podcasts: new Set(state.favorites?.podcasts || []),
                            streams: new Set(state.favorites?.streams || []),
                            videos: new Set(state.favorites?.videos || []),
                            materials: new Set(state.favorites?.materials || []),
                            events: new Set(state.favorites?.events || [])
                        };
                        
                        this.state.cart = new Set(state.cart || []);
                        this.state.achievements = new Set(state.achievements || []);
                        
                        // Восстановление простых свойств
                        this.state.progress = state.progress || this.state.progress;
                        this.state.settings = state.settings || this.state.settings;
                        this.state.recentlyViewed = state.recentlyViewed || [];
                        this.state.searchHistory = state.searchHistory || [];
                        this.state.subscriptions = state.subscriptions || [];
                        
                        this.filters = state.filters || this.filters;
                        this.currentPage = state.currentPage || 'home';
                        this.currentSubPage = state.currentSubPage || '';
                        
                        this.applySettings();
                        console.log('💾 Состояние приложения восстановлено');
                    }
                } catch (error) {
                    console.error('❌ Ошибка восстановления состояния:', error);
                }
            }

            applySettings() {
                // Применение темы
                document.documentElement.setAttribute('data-theme', this.state.settings.theme);
                
                // Применение языка
                document.documentElement.lang = this.state.settings.language;
                
                // Применение других настроек
                if (this.state.settings.autoPlay) {
                    // Настройка автовоспроизведения
                }
                
                console.log('⚙️ Настройки применены');
            }

            // ==================== ОСНОВНЫЕ МЕТОДЫ ПРИЛОЖЕНИЯ ====================
            async init() {
                console.log('🚀 Запуск инициализации приложения...');
                
                try {
                    // Инициализация Telegram WebApp
                    await this.initTelegramWebApp();
                    
                    // Настройка обработчиков событий
                    this.setupEventListeners();
                    
                    // Загрузка начального контента
                    await this.loadInitialContent();
                    
                    // Рендеринг начальной страницы
                    this.renderPage(this.currentPage);
                    
                    // Обновление счетчиков и состояния
                    this.updateAllCounters();
                    this.updateAppState();
                    
                    // Скрытие загрузочного экрана
                    this.hideLoadingScreen();
                    
                    console.log('✅ Приложение успешно инициализировано');
                    
                } catch (error) {
                    console.error('❌ Критическая ошибка инициализации:', error);
                    this.showFatalError(`Ошибка запуска приложения: ${error.message}`);
                }
            }

            async initTelegramWebApp() {
                if (window.Telegram && Telegram.WebApp) {
                    try {
                        Telegram.WebApp.ready();
                        Telegram.WebApp.expand();
                        Telegram.WebApp.enableClosingConfirmation();
                        
                        // Настройка темы Telegram
                        if (Telegram.WebApp.themeParams) {
                            this.applyTelegramTheme(Telegram.WebApp.themeParams);
                        }
                        
                        // Обработчик изменения темы
                        Telegram.WebApp.onEvent('themeChanged', () => {
                            this.applyTelegramTheme(Telegram.WebApp.themeParams);
                        });
                        
                        console.log('✅ Telegram WebApp инициализирован');
                    } catch (error) {
                        console.warn('⚠️ Ошибка инициализации Telegram WebApp:', error);
                    }
                } else {
                    console.log('ℹ️ Telegram WebApp не обнаружен, работаем в standalone режиме');
                }
            }

            applyTelegramTheme(themeParams) {
                if (themeParams.bg_color) {
                    document.documentElement.style.setProperty('--bg-primary', themeParams.bg_color);
                }
                if (themeParams.text_color) {
                    document.documentElement.style.setProperty('--text-primary', themeParams.text_color);
                }
                if (themeParams.button_color) {
                    document.documentElement.style.setProperty('--accent-primary', themeParams.button_color);
                }
            }

            setupEventListeners() {
                console.log('🔧 Настройка обработчиков событий...');
                
                // Глобальные обработчики клавиатуры
                document.addEventListener('keydown', this.handleGlobalKeydown.bind(this));
                
                // Обработчики навигации
                document.addEventListener('click', this.handleNavigationClick.bind(this));
                
                // Обработчики модальных окон
                document.addEventListener('click', this.handleModalClick.bind(this));
                
                // Обработчики жестов (для мобильных устройств)
                this.setupTouchHandlers();
                
                // Обработчики изменения размера окна
                window.addEventListener('resize', this.handleResize.bind(this));
                
                console.log('✅ Обработчики событий настроены');
            }

            handleGlobalKeydown(event) {
                // ESC - закрытие модальных окон/возврат назад
                if (event.key === 'Escape') {
                    this.handleBackButton();
                }
                
                // Ctrl+K / Cmd+K - поиск
                if ((event.ctrlKey || event.metaKey) && event.key === 'k') {
                    event.preventDefault();
                    this.showSearchModal();
                }
                
                // Цифры для быстрой навигации
                if (event.altKey && event.key >= '1' && event.key <= '9') {
                    const index = parseInt(event.key) - 1;
                    this.handleQuickNavigation(index);
                }
            }

            handleNavigationClick(event) {
                const navBtn = event.target.closest('.nav-btn');
                if (navBtn) {
                    const page = navBtn.dataset.page;
                    this.renderPage(page);
                    return;
                }
                
                const backBtn = event.target.closest('.back-btn');
                if (backBtn) {
                    this.handleBackButton();
                    return;
                }
                
                const card = event.target.closest('.content-card, .nav-card-large');
                if (card && card.onclick) {
                    // Обработчик уже установлен напрямую
                    return;
                }
            }

            handleModalClick(event) {
                if (event.target.matches('.modal')) {
                    this.closeAllModals();
                }
                
                if (event.target.matches('.modal-close') || event.target.closest('.modal-close')) {
                    this.closeAllModals();
                }
            }

            setupTouchHandlers() {
                let startX = 0;
                let startY = 0;
                
                document.addEventListener('touchstart', (e) => {
                    startX = e.touches[0].clientX;
                    startY = e.touches[0].clientY;
                });
                
                document.addEventListener('touchend', (e) => {
                    if (!startX || !startY) return;
                    
                    const endX = e.changedTouches[0].clientX;
                    const endY = e.changedTouches[0].clientY;
                    
                    const diffX = startX - endX;
                    const diffY = startY - endY;
                    
                    // Горизонтальный свайп для навигации
                    if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
                        if (diffX > 0) {
                            // Свайп влево - вперед
                            this.handleSwipe('left');
                        } else {
                            // Свайп вправо - назад
                            this.handleSwipe('right');
                        }
                    }
                    
                    startX = 0;
                    startY = 0;
                });
            }

            handleSwipe(direction) {
                if (direction === 'right') {
                    this.handleBackButton();
                } else if (direction === 'left') {
                    // Можно реализовать навигацию вперед
                }
            }

            handleResize() {
                // Адаптация интерфейса к размеру экрана
                this.updateLayoutForScreenSize();
            }

            updateLayoutForScreenSize() {
                const width = window.innerWidth;
                
                if (width < 768) {
                    document.body.classList.add('mobile-layout');
                    document.body.classList.remove('tablet-layout', 'desktop-layout');
                } else if (width < 1024) {
                    document.body.classList.add('tablet-layout');
                    document.body.classList.remove('mobile-layout', 'desktop-layout');
                } else {
                    document.body.classList.add('desktop-layout');
                    document.body.classList.remove('mobile-layout', 'tablet-layout');
                }
            }

            async loadInitialContent() {
                console.log('📥 Загрузка начального контента...');
                
                try {
                    // Имитация загрузки данных
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    // Здесь в реальном приложении были бы API запросы
                    console.log('✅ Начальный контент загружен');
                    
                } catch (error) {
                    console.error('❌ Ошибка загрузки контента:', error);
                    throw error;
                }
            }

            // ==================== СИСТЕМА РЕНДЕРИНГА СТРАНИЦ ====================
            renderPage(page, subPage = '') {
                console.log(`🔄 Рендеринг страницы: ${page}${subPage ? ` (${subPage})` : ''}`);
                
                // Сохранение предыдущей страницы
                this.previousPage = this.currentPage;
                this.currentPage = page;
                this.currentSubPage = subPage;
                
                const appElement = document.getElementById('mainContent');
                if (!appElement) {
                    console.error('❌ Элемент #mainContent не найден');
                    return;
                }

                try {
                    let pageContent = '';
                    
                    if (subPage) {
                        pageContent = this.renderSubPage(subPage);
                    } else {
                        pageContent = this.renderMainPage(page);
                    }
                    
                    appElement.innerHTML = pageContent;
                    
                    // Инициализация компонентов страницы
                    this.initializePageComponents();
                    
                    // Обновление состояния
                    this.updateActiveNav();
                    this.updateAppState();
                    
                    // Прокрутка к верху
                    window.scrollTo(0, 0);
                    
                    console.log(`✅ Страница ${page} отрендерена`);
                    
                } catch (error) {
                    console.error('❌ Ошибка рендеринга страницы:', error);
                    appElement.innerHTML = this.createErrorPage('Ошибка загрузки страницы. Пожалуйста, попробуйте перезагрузить приложение.');
                }
            }

            renderMainPage(page) {
                const pageTemplates = {
                    'home': () => this.createHomePage(),
                    'courses': () => this.createCoursesPage(),
                    'podcasts': () => this.createPodcastsPage(),
                    'streams': () => this.createStreamsPage(),
                    'videos': () => this.createVideosPage(),
                    'materials': () => this.createMaterialsPage(),
                    'events': () => this.createEventsPage(),
                    'favorites': () => this.createFavoritesPage(),
                    'profile': () => this.createProfilePage(),
                    'admin': () => this.createAdminPage(),
                    'search': () => this.createSearchPage(),
                    'settings': () => this.createSettingsPage(),
                    'community': () => this.createCommunityPage(),
                    'cart': () => this.createCartPage()
                };

                return pageTemplates[page] ? pageTemplates[page]() : this.createNotFoundPage();
            }

            renderSubPage(subPage) {
                const subPageHandlers = {
                    'course': (id) => this.createCourseDetailPage(id),
                    'podcast': (id) => this.createPodcastDetailPage(id),
                    'stream': (id) => this.createStreamDetailPage(id),
                    'video': (id) => this.createVideoDetailPage(id),
                    'material': (id) => this.createMaterialDetailPage(id),
                    'event': (id) => this.createEventDetailPage(id),
                    'instructor': (id) => this.createInstructorDetailPage(id),
                    'lesson': (id) => this.createLessonPage(id),
                    'module': (id) => this.createModulePage(id)
                };

                for (const [type, handler] of Object.entries(subPageHandlers)) {
                    if (subPage.startsWith(`${type}-`)) {
                        const id = parseInt(subPage.replace(`${type}-`, ''));
                        return handler(id);
                    }
                }

                return this.createNotFoundPage();
            }

            // ==================== ГЛАВНАЯ СТРАНИЦА ====================
            createHomePage() {
                const stats = this.calculateHomeStats();
                const recommendedCourses = this.getRecommendedCourses();
                const liveStreams = this.getLiveStreams();
                const upcomingEvents = this.getUpcomingEvents();
                const recentNews = this.getRecentNews();
                
                return `
                    <div class="page home-page">
                        <!-- Hero Section -->
                        <div class="hero-section">
                            <div class="hero-content">
                                <h1 class="hero-title">Академия АНБ</h1>
                                <p class="hero-subtitle">Профессиональное сообщество неврологов и реабилитологов. Современное образование для врачей.</p>
                                
                                <div class="hero-search">
                                    <input type="text" 
                                           class="search-input" 
                                           placeholder="Поиск курсов, материалов, видео..."
                                           value="${this.searchTerm}"
                                           oninput="app.handleSearchInput(this.value)"
                                           onkeypress="app.handleSearchKeypress(event)">
                                    <button class="btn btn-primary btn-large" onclick="app.performSearch()">
                                        <span>🔍</span>
                                        <span>Поиск</span>
                                    </button>
                                </div>
                                
                                <div class="hero-stats">
                                    <div class="stat">
                                        <div class="stat-number">${stats.courses}</div>
                                        <div class="stat-label">Курсов</div>
                                    </div>
                                    <div class="stat">
                                        <div class="stat-number">${stats.students}</div>
                                        <div class="stat-label">Студентов</div>
                                    </div>
                                    <div class="stat">
                                        <div class="stat-number">${stats.experts}</div>
                                        <div class="stat-label">Экспертов</div>
                                    </div>
                                    <div class="stat">
                                        <div class="stat-number">${stats.materials}</div>
                                        <div class="stat-label">Материалов</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Быстрая навигация -->
                        <div class="quick-nav-section">
                            <h2 class="section-title">
                                <span>🚀</span>
                                Быстрый доступ
                            </h2>
                            <div class="main-navigation-grid">
                                ${this.navigationItems.map(item => `
                                    <div class="nav-card-large" onclick="app.renderPage('${item.page}')">
                                        <div class="nav-card-image">
                                            <img src="${item.imageUrl}" alt="${item.title}" 
                                                 onerror="this.src='https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400&h=250&fit=crop'">
                                            <div class="nav-card-overlay">
                                                <div class="nav-card-icon">${item.icon}</div>
                                                <h3>${item.title}</h3>
                                                <p>${item.description}</p>
                                            </div>
                                            <div class="nav-count">${this.getContentCount(item.page)}</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <!-- Рекомендуемые курсы -->
                        ${recommendedCourses.length > 0 ? `
                        <div class="featured-section">
                            <div class="section-header">
                                <h2 class="section-title">
                                    <span>⭐</span>
                                    Рекомендуемые курсы
                                </h2>
                                <div class="section-actions">
                                    <button class="btn btn-outline" onclick="app.renderPage('courses')">
                                        <span>Все курсы</span>
                                        <span>→</span>
                                    </button>
                                </div>
                            </div>
                            <div class="content-grid">
                                ${recommendedCourses.slice(0, 4).map(course => this.createCourseCard(course)).join('')}
                            </div>
                        </div>
                        ` : ''}

                        <!-- Прямые эфиры -->
                        ${liveStreams.length > 0 ? `
                        <div class="live-section">
                            <div class="section-header">
                                <h2 class="section-title">
                                    <span>🔴</span>
                                    Прямые эфиры
                                    <span class="live-pulse"></span>
                                </h2>
                                <div class="section-actions">
                                    <button class="btn btn-outline" onclick="app.renderPage('streams')">
                                        <span>Все эфиры</span>
                                        <span>→</span>
                                    </button>
                                </div>
                            </div>
                            <div class="content-grid">
                                ${liveStreams.slice(0, 2).map(stream => this.createStreamCard(stream)).join('')}
                            </div>
                        </div>
                        ` : ''}

                        <!-- Предстоящие мероприятия -->
                        ${upcomingEvents.length > 0 ? `
                        <div class="events-section">
                            <div class="section-header">
                                <h2 class="section-title">
                                    <span>🗓️</span>
                                    Ближайшие мероприятия
                                </h2>
                                <div class="section-actions">
                                    <button class="btn btn-outline" onclick="app.renderPage('events')">
                                        <span>Все мероприятия</span>
                                        <span>→</span>
                                    </button>
                                </div>
                            </div>
                            <div class="content-grid">
                                ${upcomingEvents.slice(0, 3).map(event => this.createEventCard(event)).join('')}
                            </div>
                        </div>
                        ` : ''}

                        <!-- Статистика обучения -->
                        <div class="learning-stats-section">
                            <h2 class="section-title">
                                <span>📊</span>
                                Ваш прогресс
                            </h2>
                            <div class="stats-cards">
                                <div class="stat-card large">
                                    <div class="stat-icon">🎯</div>
                                    <div class="stat-content">
                                        <div class="stat-value">${this.state.progress.overall.completedCourses || 0}</div>
                                        <div class="stat-label">Завершено курсов</div>
                                        <div class="progress-section">
                                            <div class="progress-bar">
                                                <div class="progress-fill" style="width: ${((this.state.progress.overall.completedCourses || 0) / Math.max(this.allContent.courses?.length || 1, 1)) * 100}%"></div>
                                            </div>
                                            <div class="progress-text">
                                                ${this.state.progress.overall.completedCourses || 0} из ${this.allContent.courses?.length || 0} курсов
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="stat-card large">
                                    <div class="stat-icon">⏱️</div>
                                    <div class="stat-content">
                                        <div class="stat-value">${this.state.progress.overall.studyHours || 0}</div>
                                        <div class="stat-label">Часов обучения</div>
                                        <div class="progress-section">
                                            <div class="progress-bar">
                                                <div class="progress-fill" style="width: ${Math.min(((this.state.progress.overall.studyHours || 0) / 100) * 100, 100)}%"></div>
                                            </div>
                                            <div class="progress-text">
                                                ${this.state.progress.overall.studyHours || 0} из 100 часов в этом месяце
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="stat-card large">
                                    <div class="stat-icon">📈</div>
                                    <div class="stat-content">
                                        <div class="stat-value">${this.state.progress.overall.level}</div>
                                        <div class="stat-label">Текущий уровень</div>
                                        <div class="progress-section">
                                            <div class="progress-bar">
                                                <div class="progress-fill" style="width: ${((this.state.progress.overall.experience || 0) / 500) * 100}%"></div>
                                            </div>
                                            <div class="progress-text">
                                                ${this.state.progress.overall.experience || 0} из 500 XP до следующего уровня
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Достижения -->
                        <div class="achievements-section">
                            <div class="section-header">
                                <h2 class="section-title">
                                    <span>🏆</span>
                                    Ваши достижения
                                </h2>
                            </div>
                            <div class="achievements-grid">
                                ${this.createAchievementsPreview()}
                            </div>
                        </div>
                    </div>
                `;
            }

            // ==================== КАРТОЧКИ КОНТЕНТА ====================
            createCourseCard(course) {
                const progress = this.state.progress.courses?.[course.id] || 0;
                const isEnrolled = progress > 0;
                const isCompleted = progress === 100;
                const isFavorite = this.isFavorite(course.id, 'courses');
                
                return `
                    <div class="content-card course-card" onclick="app.openCourseDetail(${course.id})">
                        <div class="card-image">
                            <img src="${course.imageUrl}" alt="${course.title}" 
                                 onerror="this.src='https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400&h=250&fit=crop'">
                            <div class="card-overlay">
                                <div class="card-actions">
                                    <button class="card-action-btn favorite ${isFavorite ? 'active' : ''}" 
                                            onclick="event.stopPropagation(); app.toggleFavorite(${course.id}, 'courses')">
                                        ${isFavorite ? '❤️' : '🤍'}
                                    </button>
                                    ${course.trailerUrl ? `
                                    <button class="card-action-btn play" 
                                            onclick="event.stopPropagation(); app.previewContent('video', '${course.trailerUrl}', {title: '${this.escapeHtml(course.title)}', id: ${course.id}})">
                                        ▶️
                                    </button>
                                    ` : ''}
                                </div>
                            </div>
                            <div class="card-badges">
                                ${course.featured ? '<div class="card-badge featured">Рекомендуем</div>' : ''}
                                ${course.new ? '<div class="card-badge new">Новый</div>' : ''}
                                ${course.discount > 0 ? `<div class="card-badge discount">-${course.discount}%</div>` : ''}
                                ${isEnrolled ? `
                                    <div class="card-badge progress">${isCompleted ? '✅ Завершен' : `🎯 ${progress}%`}</div>
                                ` : ''}
                            </div>
                        </div>
                        <div class="card-content">
                            <div class="card-category">${this.getCategoryName(course.category)} • ${this.getLevelName(course.level)}</div>
                            <h3 class="card-title">${course.title}</h3>
                            <p class="card-description">${course.description}</p>
                            
                            <div class="card-meta">
                                <div class="meta-item">
                                    <span class="icon">⏱️</span>
                                    <span>${course.duration}</span>
                                </div>
                                <div class="meta-item">
                                    <span class="icon">📚</span>
                                    <span>${course.modules} модулей</span>
                                </div>
                                <div class="meta-item">
                                    <span class="icon">👥</span>
                                    <span>${course.studentsCount} студентов</span>
                                </div>
                                <div class="meta-item">
                                    <span class="icon">⭐</span>
                                    <span>${course.rating}</span>
                                </div>
                            </div>
                            
                            ${isEnrolled ? `
                            <div class="progress-section">
                                <div class="progress-header">
                                    <span>Ваш прогресс</span>
                                    <span>${progress}%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${progress}%"></div>
                                </div>
                            </div>
                            ` : ''}
                            
                            <div class="card-footer">
                                <div class="price-section">
                                    ${course.discount > 0 ? `
                                        <span class="price-original">${this.formatPrice(course.price)}</span>
                                    ` : ''}
                                    <span class="price-current">
                                        ${course.finalPrice === 0 ? 
                                            '<span class="price-free">Бесплатно</span>' : 
                                            this.formatPrice(course.finalPrice)
                                        }
                                    </span>
                                </div>
                                <div class="action-buttons">
                                    ${isEnrolled ? `
                                        <button class="btn btn-success btn-small" onclick="event.stopPropagation(); app.continueCourse(${course.id})">
                                            ${isCompleted ? '👁️ Повторить' : '🎯 Продолжить'}
                                        </button>
                                    ` : this.state.user?.hasActiveSubscription || course.finalPrice === 0 ? `
                                        <button class="btn btn-primary btn-small" onclick="event.stopPropagation(); app.enrollCourse(${course.id})">
                                            Начать
                                        </button>
                                    ` : `
                                        <button class="btn btn-outline btn-small" onclick="event.stopPropagation(); app.openCourseDetail(${course.id})">
                                            Подробнее
                                        </button>
                                    `}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            createPodcastCard(podcast) {
                const isListened = this.state.progress.podcasts?.[podcast.id];
                const isFavorite = this.isFavorite(podcast.id, 'podcasts');
                
                return `
                    <div class="content-card podcast-card" onclick="app.openPodcastDetail(${podcast.id})">
                        <div class="card-image">
                            <img src="${podcast.imageUrl}" alt="${podcast.title}" 
                                 onerror="this.src='https://images.unsplash.com/photo-1478737270239-2f02b77fc618?w=400&h=250&fit=crop'">
                            <div class="card-overlay">
                                <div class="card-actions">
                                    <button class="card-action-btn favorite ${isFavorite ? 'active' : ''}" 
                                            onclick="event.stopPropagation(); app.toggleFavorite(${podcast.id}, 'podcasts')">
                                        ${isFavorite ? '❤️' : '🤍'}
                                    </button>
                                    <button class="card-action-btn play" 
                                            onclick="event.stopPropagation(); app.previewContent('audio', '${podcast.audioUrl}', {title: '${this.escapeHtml(podcast.title)}', cover: '${podcast.imageUrl}', id: ${podcast.id}})">
                                        ▶️
                                    </button>
                                </div>
                            </div>
                            ${isListened ? '<div class="card-badge progress">🎧 Прослушан</div>' : ''}
                            ${podcast.featured ? '<div class="card-badge featured">Выбор редакции</div>' : ''}
                        </div>
                        <div class="card-content">
                            <div class="card-category">Подкаст • ${this.getCategoryName(podcast.category)}</div>
                            <h3 class="card-title">${podcast.title}</h3>
                            <p class="card-description">${podcast.description}</p>
                            
                            <div class="card-meta">
                                <div class="meta-item">
                                    <span class="icon">⏱️</span>
                                    <span>${podcast.duration}</span>
                                </div>
                                <div class="meta-item">
                                    <span class="icon">🎧</span>
                                    <span>${podcast.listens} прослушиваний</span>
                                </div>
                                <div class="meta-item">
                                    <span class="icon">📅</span>
                                    <span>${this.formatDate(podcast.created)}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            createStreamCard(stream) {
                const isWatched = this.state.progress.streams?.[stream.id];
                const isFavorite = this.isFavorite(stream.id, 'streams');
                const isLive = stream.isLive && stream.status === 'live';
                const isUpcoming = stream.status === 'scheduled';
                
                return `
                    <div class="content-card stream-card" onclick="app.openStreamDetail(${stream.id})">
                        <div class="card-image">
                            <img src="${stream.imageUrl}" alt="${stream.title}" 
                                 onerror="this.src='https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400&h=250&fit=crop'">
                            <div class="card-overlay">
                                <div class="card-actions">
                                    <button class="card-action-btn favorite ${isFavorite ? 'active' : ''}" 
                                            onclick="event.stopPropagation(); app.toggleFavorite(${stream.id}, 'streams')">
                                        ${isFavorite ? '❤️' : '🤍'}
                                    </button>
                                    ${!isUpcoming ? `
                                    <button class="card-action-btn play" 
                                            onclick="event.stopPropagation(); app.previewContent('video', '${stream.recordingUrl || stream.videoUrl}', {title: '${this.escapeHtml(stream.title)}', id: ${stream.id}})">
                                        ▶️
                                    </button>
                                    ` : ''}
                                </div>
                            </div>
                            <div class="card-badges">
                                ${isLive ? `
                                    <div class="card-badge live">
                                        <span class="live-pulse"></span>
                                        <span>LIVE</span>
                                    </div>
                                ` : isUpcoming ? `
                                    <div class="card-badge new">Скоро</div>
                                ` : ''}
                                ${isWatched ? '<div class="card-badge progress">👁️ Просмотрено</div>' : ''}
                                ${stream.featured ? '<div class="card-badge featured">Эфир недели</div>' : ''}
                            </div>
                        </div>
                        <div class="card-content">
                            <div class="card-category">Эфир • ${this.getCategoryName(stream.category)}</div>
                            <h3 class="card-title">${stream.title}</h3>
                            <p class="card-description">${stream.description}</p>
                            
                            <div class="card-meta">
                                <div class="meta-item">
                                    <span class="icon">⏱️</span>
                                    <span>${stream.duration}</span>
                                </div>
                                <div class="meta-item">
                                    <span class="icon">👥</span>
                                    <span>${stream.viewers} зрителей</span>
                                </div>
                                ${stream.scheduledStart ? `
                                <div class="meta-item">
                                    <span class="icon">📅</span>
                                    <span>${this.formatDateTime(stream.scheduledStart)}</span>
                                </div>
                                ` : ''}
                            </div>
                            
                            ${isUpcoming ? `
                            <div class="card-footer">
                                <button class="btn btn-primary btn-small" onclick="event.stopPropagation(); app.setReminderForStream(${stream.id})">
                                    ⏰ Напомнить
                                </button>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }

            createEventCard(event) {
                const isRegistered = this.state.progress.events?.[event.id]?.registered;
                const eventDate = new Date(event.date);
                const isUpcoming = eventDate > new Date();
                const isFavorite = this.isFavorite(event.id, 'events');
                
                return `
                    <div class="content-card event-card" onclick="app.openEventDetail(${event.id})">
                        <div class="card-image">
                            <img src="${event.imageUrl}" alt="${event.title}" 
                                 onerror="this.src='https://images.unsplash.com/photo-1540575467063-178a50c2df87?w=400&h=250&fit=crop'">
                            <div class="card-overlay">
                                <div class="card-actions">
                                    <button class="card-action-btn favorite ${isFavorite ? 'active' : ''}" 
                                            onclick="event.stopPropagation(); app.toggleFavorite(${event.id}, 'events')">
                                        ${isFavorite ? '❤️' : '🤍'}
                                    </button>
                                </div>
                            </div>
                            <div class="card-badges">
                                ${event.featured ? '<div class="card-badge featured">Главное событие</div>' : ''}
                                ${isRegistered ? '<div class="card-badge progress">✅ Зарегистрирован</div>' : ''}
                                ${event.type === 'online' ? '<div class="card-badge new">🌐 Онлайн</div>' : ''}
                            </div>
                        </div>
                        <div class="card-content">
                            <div class="card-category">
                                ${event.type === 'online' ? '🌐 Онлайн' : event.type === 'offline' ? '🏛️ Офлайн' : '🔀 Гибрид'} • 
                                ${this.getCategoryName(event.category)}
                            </div>
                            <h3 class="card-title">${event.title}</h3>
                            <p class="card-description">${event.description}</p>
                            
                            <div class="card-meta">
                                <div class="meta-item">
                                    <span class="icon">📅</span>
                                    <span>${this.formatDate(event.date)}</span>
                                </div>
                                <div class="meta-item">
                                    <span class="icon">⏰</span>
                                    <span>${this.formatTime(event.date)}</span>
                                </div>
                                <div class="meta-item">
                                    <span class="icon">👥</span>
                                    <span>${event.registered}/${event.capacity} участников</span>
                                </div>
                                ${event.location && event.type !== 'online' ? `
                                <div class="meta-item">
                                    <span class="icon">📍</span>
                                    <span>${event.location}</span>
                                </div>
                                ` : ''}
                            </div>
                            
                            <div class="card-footer">
                                <div class="price-section">
                                    ${event.earlyBirdPrice && new Date() < new Date(event.earlyBirdUntil) ? `
                                        <span class="price-original">${this.formatPrice(event.price)}</span>
                                        <span class="price-current">${this.formatPrice(event.earlyBirdPrice)}</span>
                                    ` : `
                                        <span class="price-current">
                                            ${event.price === 0 ? 
                                                '<span class="price-free">Бесплатно</span>' : 
                                                this.formatPrice(event.price)
                                            }
                                        </span>
                                    `}
                                </div>
                                <div class="action-buttons">
                                    ${isUpcoming ? `
                                        ${!isRegistered ? `
                                        <button class="btn btn-primary btn-small" onclick="event.stopPropagation(); app.registerForEvent(${event.id})">
                                            Зарегистрироваться
                                        </button>
                                        ` : `
                                        <button class="btn btn-outline btn-small" onclick="event.stopPropagation(); app.cancelEventRegistration(${event.id})">
                                            Отменить
                                        </button>
                                        `}
                                    ` : `
                                        <button class="btn btn-outline btn-small" onclick="event.stopPropagation(); app.openEventDetail(${event.id})">
                                            Смотреть запись
                                        </button>
                                    `}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // ==================== ВСПОМОГАТЕЛЬНЫЕ МЕТОДЫ ====================
            escapeHtml(text) {
                if (!text) return '';
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            formatPrice(price) {
                if (price === 0) return 'Бесплатно';
                return new Intl.NumberFormat('ru-RU').format(Math.round(price)) + ' ₽';
            }

            formatDate(date) {
                return new Date(date).toLocaleDateString('ru-RU', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                });
            }

            formatDateTime(date) {
                return new Date(date).toLocaleString('ru-RU', {
                    day: 'numeric',
                    month: 'short',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }

            formatTime(date) {
                return new Date(date).toLocaleTimeString('ru-RU', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }

            getCategoryName(category) {
                return this.categories.courses?.[category] || category || 'Общее';
            }

            getLevelName(level) {
                return this.categories.levels?.[level] || level || 'Не указано';
            }

            isFavorite(contentId, contentType) {
                return this.state.favorites[contentType].has(contentId);
            }

            getTotalFavorites() {
                return Object.values(this.state.favorites).reduce((total, set) => total + set.size, 0);
            }

            getContentCount(page) {
                const counts = {
                    'courses': this.allContent.courses?.length || 0,
                    'podcasts': this.allContent.podcasts?.length || 0,
                    'videos': this.allContent.videos?.length || 0,
                    'materials': this.allContent.materials?.length || 0,
                    'streams': this.allContent.streams?.length || 0,
                    'events': this.allContent.events?.length || 0
                };
                return counts[page] || 0;
            }

            calculateHomeStats() {
                return {
                    courses: this.allContent.courses?.length || 0,
                    students: 1567,
                    experts: this.instructors?.length || 0,
                    materials: this.allContent.materials?.length || 0
                };
            }

            getRecommendedCourses() {
                return this.allContent.courses?.filter(course => course.featured) || [];
            }

            getLiveStreams() {
                return this.allContent.streams?.filter(stream => stream.isLive) || [];
            }

            getUpcomingEvents() {
                return this.allContent.events?.filter(event => new Date(event.date) > new Date()) || [];
            }

            getRecentNews() {
                return this.allContent.news || [];
            }

            createAchievementsPreview() {
                const userAchievements = Array.from(this.state.achievements);
                const previewAchievements = this.achievements.course_completions.slice(0, 3);
                
                return previewAchievements.map(achievement => `
                    <div class="achievement-item ${userAchievements.includes(achievement.id) ? 'unlocked' : 'locked'}">
                        <div class="achievement-icon">${achievement.icon}</div>
                        <div class="achievement-info">
                            <div class="achievement-name">${achievement.name}</div>
                            <div class="achievement-description">${achievement.description}</div>
                        </div>
                    </div>
                `).join('');
            }

            // ==================== СИСТЕМА УВЕДОМЛЕНИЙ ====================
            showNotification(message, type = 'info', duration = 5000) {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                
                const icons = {
                    'success': '✅',
                    'error': '❌',
                    'warning': '⚠️',
                    'info': 'ℹ️'
                };
                
                notification.innerHTML = `
                    <div class="notification-content">
                        <div class="notification-icon">${icons[type]}</div>
                        <div class="notification-text">
                            <div class="notification-title">${this.getNotificationTitle(type)}</div>
                            <div class="notification-message">${message}</div>
                        </div>
                        <button class="notification-close" onclick="this.parentElement.parentElement.remove()">×</button>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                // Автоматическое удаление
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, duration);
                
                // Звуковое уведомление (если разрешено)
                if (this.state.settings.notifications) {
                    this.playNotificationSound(type);
                }
            }

            getNotificationTitle(type) {
                const titles = {
                    'success': 'Успешно',
                    'error': 'Ошибка',
                    'warning': 'Внимание',
                    'info': 'Информация'
                };
                return titles[type] || 'Уведомление';
            }

            playNotificationSound(type) {
                // В реальном приложении здесь было бы воспроизведение звука
                console.log(`🔊 Воспроизведение звука уведомления: ${type}`);
            }

            // ==================== СИСТЕМА ОШИБОК ====================
            setupErrorHandling() {
                window.addEventListener('error', this.handleGlobalError.bind(this));
                window.addEventListener('unhandledrejection', this.handlePromiseRejection.bind(this));
            }

            handleGlobalError(event) {
                console.error('🚨 Глобальная ошибка:', event.error);
                this.showNotification('Произошла непредвиденная ошибка', 'error');
            }

            handlePromiseRejection(event) {
                console.error('🚨 Ошибка Promise:', event.reason);
                this.showNotification('Ошибка загрузки данных', 'error');
            }

            showFatalError(message) {
                const errorScreen = document.getElementById('errorScreen');
                const errorMessage = document.getElementById('errorMessage');
                const app = document.getElementById('app');
                const loading = document.getElementById('loadingScreen');
                
                if (errorMessage) errorMessage.textContent = message;
                if (errorScreen) errorScreen.style.display = 'flex';
                if (app) app.style.display = 'none';
                if (loading) loading.style.display = 'none';
            }

            setupOnlineStatus() {
                window.addEventListener('online', () => {
                    this.isOnline = true;
                    this.showNotification('Соединение восстановлено', 'success');
                    this.syncOfflineData();
                });
                
                window.addEventListener('offline', () => {
                    this.isOnline = false;
                    this.showNotification('Отсутствует подключение к интернету', 'warning');
                });
            }

            syncOfflineData() {
                // Синхронизация данных, накопленных в офлайн режиме
                console.log('🔄 Синхронизация офлайн данных...');
            }

            // ==================== ИНИЦИАЛИЗАЦИЯ КОМПОНЕНТОВ СТРАНИЦЫ ====================
            initializePageComponents() {
                this.initializeMediaPlayers();
                this.initializeInteractiveElements();
                this.initializeForms();
                this.initializeTooltips();
            }

            initializeMediaPlayers() {
                // Видео плееры
                document.querySelectorAll('video').forEach(video => {
                    video.addEventListener('play', () => {
                        if (this.mediaPlayers.video && this.mediaPlayers.video !== video) {
                            this.mediaPlayers.video.pause();
                        }
                        this.mediaPlayers.video = video;
                        this.mediaPlayers.current = 'video';
                    });
                    
                    video.addEventListener('ended', () => {
                        this.handleMediaEnded('video', video.dataset.id);
                    });
                });
                
                // Аудио плееры
                document.querySelectorAll('audio').forEach(audio => {
                    audio.addEventListener('play', () => {
                        if (this.mediaPlayers.audio && this.mediaPlayers.audio !== audio) {
                            this.mediaPlayers.audio.pause();
                        }
                        this.mediaPlayers.audio = audio;
                        this.mediaPlayers.current = 'audio';
                    });
                    
                    audio.addEventListener('ended', () => {
                        this.handleMediaEnded('audio', audio.dataset.id);
                    });
                });
            }

            initializeInteractiveElements() {
                // Инициализация всех интерактивных элементов на странице
                this.initializeAccordions();
                this.initializeTabs();
                this.initializeCarousels();
                this.initializeLazyLoading();
            }

            initializeForms() {
                // Инициализация форм и валидации
                document.querySelectorAll('form').forEach(form => {
                    form.addEventListener('submit', this.handleFormSubmit.bind(this));
                });
            }

            initializeTooltips() {
                // Инициализация всплывающих подсказок
                // Можно добавить библиотеку tooltips или реализовать кастомную логику
            }

            handleMediaEnded(type, mediaId) {
                if (type === 'video' || type === 'audio') {
                    this.markAsCompleted(mediaId, type + 's');
                }
            }

            // ==================== ОБРАБОТЧИКИ СОБЫТИЙ ИНТЕРФЕЙСА ====================
            handleSearchInput(value) {
                this.searchTerm = value;
            }

            handleSearchKeypress(event) {
                if (event.key === 'Enter') {
                    this.performSearch();
                }
            }

            performSearch() {
                if (this.searchTerm.trim()) {
                    this.addToSearchHistory(this.searchTerm);
                    this.renderPage('search');
                } else {
                    this.showNotification('Введите поисковый запрос', 'warning');
                }
            }

            addToSearchHistory(query) {
                this.state.searchHistory = this.state.searchHistory.filter(item => item !== query);
                this.state.searchHistory.unshift(query);
                this.state.searchHistory = this.state.searchHistory.slice(0, 10);
                this.saveAppState();
            }

            handleBackButton() {
                if (this.currentSubPage) {
                    this.currentSubPage = '';
                    this.renderPage(this.currentPage);
                } else if (this.currentPage !== 'home') {
                    this.renderPage('home');
                } else {
                    // Если на главной - показать подтверждение выхода
                    this.showExitConfirmation();
                }
            }

            showExitConfirmation() {
                if (confirm('Вы уверены, что хотите выйти из приложения?')) {
                    if (window.Telegram && Telegram.WebApp) {
                        Telegram.WebApp.close();
                    } else {
                        window.close();
                    }
                }
            }

            handleQuickNavigation(index) {
                const pages = ['home', 'courses', 'podcasts', 'streams', 'videos', 'materials', 'events', 'favorites', 'profile'];
                if (pages[index]) {
                    this.renderPage(pages[index]);
                }
            }

            handleFormSubmit(event) {
                event.preventDefault();
                const form = event.target;
                const formData = new FormData(form);
                
                this.processFormSubmission(form, formData);
            }

            async processFormSubmission(form, formData) {
                const submitBtn = form.querySelector('button[type="submit"]');
                const originalText = submitBtn?.textContent;
                
                try {
                    // Показать состояние загрузки
                    if (submitBtn) {
                        submitBtn.classList.add('btn-loading');
                        submitBtn.disabled = true;
                    }
                    
                    // Имитация API запроса
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    // Обработка успешной отправки
                    this.showNotification('Форма успешно отправлена', 'success');
                    form.reset();
                    
                } catch (error) {
                    this.showNotification('Ошибка отправки формы', 'error');
                } finally {
                    // Восстановить кнопку
                    if (submitBtn) {
                        submitBtn.classList.remove('btn-loading');
                        submitBtn.disabled = false;
                        if (originalText) {
                            submitBtn.textContent = originalText;
                        }
                    }
                }
            }

            // ==================== СИСТЕМА ИЗБРАННОГО ====================
            toggleFavorite(contentId, contentType, event = null) {
                if (event) {
                    event.stopPropagation();
                    event.preventDefault();
                }
                
                const wasFavorite = this.isFavorite(contentId, contentType);
                
                if (wasFavorite) {
                    this.state.favorites[contentType].delete(contentId);
                    this.showNotification('Удалено из избранного', 'info');
                } else {
                    this.state.favorites[contentType].add(contentId);
                    this.showNotification('Добавлено в избранное', 'success');
                }
                
                this.updateFavoritesCount();
                this.saveAppState();
                
                // Если находимся на странице избранного - перерендерить
                if (this.currentPage === 'favorites') {
                    this.renderPage('favorites');
                }
            }

            updateFavoritesCount() {
                const favoritesCount = document.getElementById('favoritesCount');
                if (favoritesCount) {
                    const totalFavorites = this.getTotalFavorites();
                    favoritesCount.textContent = totalFavorites;
                    favoritesCount.style.display = totalFavorites > 0 ? 'flex' : 'none';
                }
            }

            updateAllCounters() {
                this.updateFavoritesCount();
                this.updateCartCount();
                this.updateNotificationCount();
            }

            updateCartCount() {
                // Обновление счетчика корзины
                const cartCount = document.getElementById('cartCount');
                if (cartCount) {
                    const totalItems = this.state.cart.size;
                    cartCount.textContent = totalItems;
                    cartCount.style.display = totalItems > 0 ? 'flex' : 'none';
                }
            }

            updateNotificationCount() {
                // Обновление счетчика уведомлений
                const notificationCount = document.getElementById('notificationCount');
                if (notificationCount) {
                    const unreadCount = this.notifications.filter(n => !n.read).length;
                    notificationCount.textContent = unreadCount;
                    notificationCount.style.display = unreadCount > 0 ? 'flex' : 'none';
                }
            }

            updateActiveNav() {
                document.querySelectorAll('.bottom-nav .nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.dataset.page === this.currentPage) {
                        btn.classList.add('active');
                    }
                });

                // Показываем бейдж админа если нужно
                const adminBadge = document.getElementById('adminBadge');
                if (adminBadge) {
                    adminBadge.style.display = this.isAdmin ? 'flex' : 'none';
                }
            }

            updateAppState() {
                this.saveAppState();
            }

            // ==================== МЕДИА СИСТЕМА ====================
            previewContent(type, url, metadata) {
                const modal = document.getElementById('mediaModal');
                const modalTitle = document.getElementById('mediaModalTitle');
                const modalBody = document.getElementById('mediaModalBody');
                
                if (!modal || !modalTitle || !modalBody) return;
                
                modalTitle.textContent = metadata.title;
                
                if (type === 'video') {
                    modalBody.innerHTML = `
                        <div class="media-player">
                            <video controls autoplay style="width: 100%;" data-id="${metadata.id}">
                                <source src="${url}" type="video/mp4">
                                Ваш браузер не поддерживает видео.
                            </video>
                        </div>
                        <div class="media-info" style="padding: var(--spacing-md);">
                            <h4>${metadata.title}</h4>
                            <p>Для полноценного просмотра рекомендуем перейти на страницу курса.</p>
                        </div>
                    `;
                } else if (type === 'audio') {
                    modalBody.innerHTML = `
                        <div class="audio-player">
                            <div class="audio-info">
                                <img src="${metadata.cover}" alt="${metadata.title}" class="audio-cover">
                                <div class="audio-details">
                                    <div class="audio-title">${metadata.title}</div>
                                    <div class="audio-author">Академия АНБ</div>
                                </div>
                            </div>
                            <div class="audio-controls">
                                <button class="control-btn" onclick="app.audioControl('rewind')">⏮️</button>
                                <button class="control-btn primary large" onclick="app.audioControl('play')">▶️</button>
                                <button class="control-btn" onclick="app.audioControl('pause')">⏸️</button>
                                <button class="control-btn" onclick="app.audioControl('forward')">⏭️</button>
                            </div>
                            <div class="audio-progress">
                                <div class="progress-bar-container" onclick="app.setAudioPosition(event)">
                                    <div class="progress-bar-fill" id="audioProgress"></div>
                                </div>
                                <div class="time-display">
                                    <span id="currentTime">0:00</span>
                                    <span id="totalTime">0:00</span>
                                </div>
                            </div>
                            <div class="audio-volume">
                                <span>🔊</span>
                                <div class="volume-slider" onclick="app.setVolume(event)">
                                    <div class="volume-fill"></div>
                                </div>
                            </div>
                            <audio id="audioPlayer" style="display: none;" data-id="${metadata.id}">
                                <source src="${url}" type="audio/mpeg">
                                Ваш браузер не поддерживает аудио.
                            </audio>
                        </div>
                    `;
                    
                    this.initializeAudioPlayer(metadata.id);
                }
                
                modal.classList.add('active');
            }

            initializeAudioPlayer(audioId) {
                const audio = document.getElementById('audioPlayer');
                if (!audio) return;
                
                this.currentAudioPlayer = {
                    element: audio,
                    id: audioId,
                    isPlaying: false
                };
                
                audio.addEventListener('loadedmetadata', () => {
                    const totalTime = document.getElementById('totalTime');
                    if (totalTime) {
                        totalTime.textContent = this.formatTime(audio.duration);
                    }
                });
                
                audio.addEventListener('timeupdate', () => {
                    const progress = document.getElementById('audioProgress');
                    const currentTime = document.getElementById('currentTime');
                    
                    if (progress && currentTime) {
                        const percent = (audio.currentTime / audio.duration) * 100;
                        progress.style.width = `${percent}%`;
                        currentTime.textContent = this.formatTime(audio.currentTime);
                    }
                });
                
                audio.addEventListener('ended', () => {
                    this.markAsCompleted(audioId, 'podcasts');
                    this.showNotification('Подкаст завершен', 'success');
                });
            }

            audioControl(action) {
                if (!this.currentAudioPlayer) return;
                
                const audio = this.currentAudioPlayer.element;
                
                switch (action) {
                    case 'play':
                        audio.play();
                        this.currentAudioPlayer.isPlaying = true;
                        break;
                    case 'pause':
                        audio.pause();
                        this.currentAudioPlayer.isPlaying = false;
                        break;
                    case 'rewind':
                        audio.currentTime = Math.max(0, audio.currentTime - 10);
                        break;
                    case 'forward':
                        audio.currentTime = Math.min(audio.duration, audio.currentTime + 10);
                        break;
                }
            }

            setAudioPosition(event) {
                if (!this.currentAudioPlayer) return;
                
                const audio = this.currentAudioPlayer.element;
                const progressBar = event.currentTarget;
                const clickX = event.offsetX;
                const width = progressBar.offsetWidth;
                const duration = audio.duration;
                
                audio.currentTime = (clickX / width) * duration;
            }

            setVolume(event) {
                if (!this.currentAudioPlayer) return;
                
                const audio = this.currentAudioPlayer.element;
                const volumeSlider = event.currentTarget;
                const clickX = event.offsetX;
                const width = volumeSlider.offsetWidth;
                
                const volume = clickX / width;
                audio.volume = volume;
                
                // Обновление визуального отображения громкости
                const volumeFill = volumeSlider.querySelector('.volume-fill');
                if (volumeFill) {
                    volumeFill.style.width = `${volume * 100}%`;
                }
            }

            closeMediaModal() {
                const modal = document.getElementById('mediaModal');
                if (modal) {
                    modal.classList.remove('active');
                }
                
                if (this.currentAudioPlayer) {
                    this.currentAudioPlayer.element.pause();
                    this.currentAudioPlayer = null;
                }
                
                if (this.mediaPlayers.video) {
                    this.mediaPlayers.video.pause();
                    this.mediaPlayers.video = null;
                }
            }

            // ==================== СИСТЕМА ПРОГРЕССА ====================
            markAsCompleted(contentId, contentType) {
                if (!this.state.progress[contentType]) {
                    this.state.progress[contentType] = {};
                }
                
                this.state.progress[contentType][contentId] = true;
                
                // Начисляем опыт
                if (!this.state.progress.overall.experience) {
                    this.state.progress.overall.experience = 0;
                }
                
                const experienceGained = {
                    'courses': 100,
                    'podcasts': 10,
                    'videos': 5,
                    'streams': 15,
                    'materials': 3,
                    'events': 20
                };
                
                this.state.progress.overall.experience += experienceGained[contentType] || 0;
                
                // Обновляем статистику
                this.updateProgressStats(contentType);
                
                // Проверяем достижения
                this.checkAchievements();
                
                this.saveAppState();
                this.showNotification('Прогресс сохранен! +' + (experienceGained[contentType] || 0) + ' XP', 'success');
            }

            updateProgressStats(contentType) {
                // Обновление общей статистики прогресса
                const overall = this.state.progress.overall;
                
                switch (contentType) {
                    case 'courses':
                        overall.completedCourses = Object.keys(this.state.progress.courses).length;
                        break;
                    case 'podcasts':
                        // Обновление статистики подкастов
                        break;
                    // ... другие типы контента
                }
                
                // Обновление уровня
                this.updateUserLevel();
            }

            updateUserLevel() {
                const experience = this.state.progress.overall.experience || 0;
                let level = 'Новичок';
                
                if (experience >= 3000) {
                    level = 'Эксперт';
                } else if (experience >= 1500) {
                    level = 'Практик';
                } else if (experience >= 500) {
                    level = 'Понимаю';
                }
                
                this.state.progress.overall.level = level;
            }

            checkAchievements() {
                // Проверка и выдача достижений
                const overall = this.state.progress.overall;
                
                // Достижение за первый курс
                if (overall.completedCourses >= 1 && !this.state.achievements.has(1)) {
                    this.state.achievements.add(1);
                    this.showNotification('🎉 Получено достижение: Первый шаг!', 'success');
                }
                
                // Достижение за 5 курсов
                if (overall.completedCourses >= 5 && !this.state.achievements.has(2)) {
                    this.state.achievements.add(2);
                    this.showNotification('🎉 Получено достижение: Усердный студент!', 'success');
                }
            }

            // ==================== СИСТЕМА ПОДПИСОК ====================
            showSubscriptionModal() {
                const modal = document.getElementById('subscriptionModal');
                const modalBody = document.getElementById('subscriptionModalBody');
                
                if (!modal || !modalBody) return;
                
                modalBody.innerHTML = `
                    <div class="subscription-plans">
                        <h3 style="margin-bottom: var(--spacing-lg); text-align: center;">Выберите подписку</h3>
                        <p style="text-align: center; color: var(--text-secondary); margin-bottom: var(--spacing-xl);">
                            Получите доступ ко всем курсам, материалам и эксклюзивному контенту
                        </p>
                        
                        <div class="billing-period" style="margin-bottom: var(--spacing-xl); text-align: center;">
                            <div class="period-selector" style="display: inline-flex; background: var(--bg-secondary); padding: var(--spacing-xs); border-radius: var(--border-radius-lg);">
                                <button class="btn btn-small ${this.subscriptionState.selectedPeriod === 'monthly' ? 'btn-primary' : 'btn-ghost'}" 
                                        onclick="app.selectBillingPeriod('monthly')">
                                    Ежемесячно
                                </button>
                                <button class="btn btn-small ${this.subscriptionState.selectedPeriod === 'yearly' ? 'btn-primary' : 'btn-ghost'}" 
                                        onclick="app.selectBillingPeriod('yearly')">
                                    Ежегодно (-25%)
                                </button>
                            </div>
                        </div>
                        
                        <div class="content-grid">
                            ${this.subscriptionPlans.map(plan => `
                                <div class="content-card ${plan.recommended ? 'recommended' : ''}" 
                                     onclick="app.selectSubscriptionPlan(${plan.id})">
                                    ${plan.recommended ? `
                                    <div class="card-badges">
                                        <div class="card-badge featured">Рекомендуем</div>
                                    </div>
                                    ` : ''}
                                    
                                    <div class="card-content">
                                        <h3 class="card-title">${plan.name}</h3>
                                        <p class="card-description">${plan.description}</p>
                                        
                                        <div class="price-section" style="margin: var(--spacing-lg) 0;">
                                            <span class="price-current">
                                                ${this.formatPrice(this.subscriptionState.selectedPeriod === 'monthly' ? plan.price_monthly : plan.price_yearly)}
                                            </span>
                                            <span style="color: var(--text-tertiary); font-size: var(--font-size-sm);">
                                                /${this.subscriptionState.selectedPeriod === 'monthly' ? 'месяц' : 'год'}
                                            </span>
                                        </div>
                                        
                                        <ul style="color: var(--text-secondary); font-size: var(--font-size-sm); margin-bottom: var(--spacing-lg);">
                                            ${plan.features.map(feature => `
                                                <li style="margin-bottom: var(--spacing-xs); display: flex; align-items: center; gap: var(--spacing-sm);">
                                                    <span style="color: var(--success);">✓</span>
                                                    <span>${feature}</span>
                                                </li>
                                            `).join('')}
                                        </ul>
                                        
                                        ${plan.limitations && plan.limitations.length > 0 ? `
                                        <div style="border-top: 1px solid var(--border-primary); padding-top: var(--spacing-md); margin-bottom: var(--spacing-lg);">
                                            <p style="font-size: var(--font-size-sm); color: var(--text-tertiary); margin-bottom: var(--spacing-xs);">Ограничения:</p>
                                            <ul style="color: var(--text-tertiary); font-size: var(--font-size-sm);">
                                                ${plan.limitations.map(limitation => `
                                                    <li style="margin-bottom: var(--spacing-xs); display: flex; align-items: center; gap: var(--spacing-sm);">
                                                        <span style="color: var(--error);">✗</span>
                                                        <span>${limitation}</span>
                                                    </li>
                                                `).join('')}
                                            </ul>
                                        </div>
                                        ` : ''}
                                        
                                        <button class="btn ${plan.recommended ? 'btn-primary' : 'btn-outline'} btn-full">
                                            ${this.subscriptionState.selectedPlan?.id === plan.id ? '✓ Выбрано' : 'Выбрать план'}
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        ${this.subscriptionState.selectedPlan ? `
                        <div class="selected-plan-info" style="background: var(--bg-secondary); padding: var(--spacing-lg); border-radius: var(--border-radius-lg); margin-top: var(--spacing-xl);">
                            <h4>Выбранный план: ${this.subscriptionState.selectedPlan.name}</h4>
                            <p style="color: var(--text-secondary); margin: var(--spacing-sm) 0;">
                                ${this.formatPrice(this.subscriptionState.selectedPeriod === 'monthly' ? 
                                    this.subscriptionState.selectedPlan.price_monthly : 
                                    this.subscriptionState.selectedPlan.price_yearly)}
                                /${this.subscriptionState.selectedPeriod === 'monthly' ? 'месяц' : 'год'}
                            </p>
                        </div>
                        ` : ''}
                    </div>
                `;
                
                modal.classList.add('active');
            }

            selectBillingPeriod(period) {
                this.subscriptionState.selectedPeriod = period;
                this.showSubscriptionModal(); // Перерендерим модальное окно
            }

            selectSubscriptionPlan(planId) {
                this.subscriptionState.selectedPlan = this.subscriptionPlans.find(p => p.id === planId);
                this.showNotification(`Выбран план: ${this.subscriptionState.selectedPlan.name}`, 'success');
                this.showSubscriptionModal(); // Перерендерим для обновления UI
            }

            processSubscription() {
                if (!this.subscriptionState.selectedPlan) {
                    this.showNotification('Пожалуйста, выберите план подписки', 'error');
                    return;
                }
                
                // Имитация процесса оплаты
                this.showNotification('Обработка платежа...', 'info');
                
                setTimeout(() => {
                    this.showNotification('Подписка успешно оформлена!', 'success');
                    this.closeSubscriptionModal();
                    
                    // Обновляем статус пользователя
                    this.state.user.hasActiveSubscription = true;
                    this.state.user.subscription = {
                        plan: this.subscriptionState.selectedPlan.name.toLowerCase(),
                        period: this.subscriptionState.selectedPeriod,
                        startsAt: new Date(),
                        endsAt: new Date(Date.now() + (this.subscriptionState.selectedPeriod === 'monthly' ? 30 : 365) * 24 * 60 * 60 * 1000),
                        autoRenew: true,
                        price: this.subscriptionState.selectedPeriod === 'monthly' ? 
                            this.subscriptionState.selectedPlan.price_monthly : 
                            this.subscriptionState.selectedPlan.price_yearly
                    };
                    
                    this.saveAppState();
                }, 2000);
            }

            closeSubscriptionModal() {
                const modal = document.getElementById('subscriptionModal');
                if (modal) {
                    modal.classList.remove('active');
                }
            }

            // ==================== СИСТЕМА НАСТРОЕК ====================
            showSettingsModal() {
                const modal = document.getElementById('settingsModal');
                const modalBody = document.getElementById('settingsModalBody');
                
                if (!modal || !modalBody) return;
                
                modalBody.innerHTML = `
                    <div class="settings-content">
                        <h3 style="margin-bottom: var(--spacing-lg);">Настройки приложения</h3>
                        
                        <div class="settings-section">
                            <h4 style="margin-bottom: var(--spacing-md); color: var(--text-primary);">Внешний вид</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Тема оформления</label>
                                <select class="form-select" id="themeSelect">
                                    <option value="dark" ${this.state.settings.theme === 'dark' ? 'selected' : ''}>Тёмная</option>
                                    <option value="light" ${this.state.settings.theme === 'light' ? 'selected' : ''}>Светлая</option>
                                    <option value="auto" ${this.state.settings.theme === 'auto' ? 'selected' : ''}>Системная</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Язык</label>
                                <select class="form-select" id="languageSelect">
                                    <option value="ru" ${this.state.settings.language === 'ru' ? 'selected' : ''}>Русский</option>
                                    <option value="en" ${this.state.settings.language === 'en' ? 'selected' : ''}>English</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-section">
                            <h4 style="margin-bottom: var(--spacing-md); color: var(--text-primary);">Уведомления</h4>
                            
                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: var(--spacing-sm); cursor: pointer;">
                                    <input type="checkbox" id="notificationsToggle" ${this.state.settings.notifications ? 'checked' : ''}>
                                    <span>Push-уведомления</span>
                                </label>
                            </div>
                            
                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: var(--spacing-sm); cursor: pointer;">
                                    <input type="checkbox" id="emailNotificationsToggle" ${this.state.user?.preferences?.emailNotifications ? 'checked' : ''}>
                                    <span>Email-уведомления</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="settings-section">
                            <h4 style="margin-bottom: var(--spacing-md); color: var(--text-primary);">Воспроизведение</h4>
                            
                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: var(--spacing-sm); cursor: pointer;">
                                    <input type="checkbox" id="autoPlayToggle" ${this.state.settings.autoPlay ? 'checked' : ''}>
                                    <span>Автовоспроизведение</span>
                                </label>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Скорость воспроизведения</label>
                                <select class="form-select" id="playbackSpeedSelect">
                                    <option value="0.5" ${this.state.settings.playbackSpeed === 0.5 ? 'selected' : ''}>0.5x</option>
                                    <option value="0.75" ${this.state.settings.playbackSpeed === 0.75 ? 'selected' : ''}>0.75x</option>
                                    <option value="1.0" ${this.state.settings.playbackSpeed === 1.0 ? 'selected' : ''}>1.0x (нормальная)</option>
                                    <option value="1.25" ${this.state.settings.playbackSpeed === 1.25 ? 'selected' : ''}>1.25x</option>
                                    <option value="1.5" ${this.state.settings.playbackSpeed === 1.5 ? 'selected' : ''}>1.5x</option>
                                    <option value="2.0" ${this.state.settings.playbackSpeed === 2.0 ? 'selected' : ''}>2.0x</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-section">
                            <h4 style="margin-bottom: var(--spacing-md); color: var(--text-primary);">Данные</h4>
                            
                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: var(--spacing-sm); cursor: pointer;">
                                    <input type="checkbox" id="dataSavingToggle" ${this.state.settings.dataSaving ? 'checked' : ''}>
                                    <span>Режим экономии трафика</span>
                                </label>
                            </div>
                            
                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: var(--spacing-sm); cursor: pointer;">
                                    <input type="checkbox" id="offlineModeToggle" ${this.state.settings.offlineMode ? 'checked' : ''}>
                                    <span>Офлайн режим</span>
                                </label>
                            </div>
                        </div>
                    </div>
                `;
                
                modal.classList.add('active');
            }

            saveSettings() {
                const themeSelect = document.getElementById('themeSelect');
                const languageSelect = document.getElementById('languageSelect');
                const notificationsToggle = document.getElementById('notificationsToggle');
                const emailNotificationsToggle = document.getElementById('emailNotificationsToggle');
                const autoPlayToggle = document.getElementById('autoPlayToggle');
                const playbackSpeedSelect = document.getElementById('playbackSpeedSelect');
                const dataSavingToggle = document.getElementById('dataSavingToggle');
                const offlineModeToggle = document.getElementById('offlineModeToggle');
                
                // Сохранение настроек
                if (themeSelect) this.state.settings.theme = themeSelect.value;
                if (languageSelect) this.state.settings.language = languageSelect.value;
                if (notificationsToggle) this.state.settings.notifications = notificationsToggle.checked;
                if (emailNotificationsToggle && this.state.user) {
                    this.state.user.preferences.emailNotifications = emailNotificationsToggle.checked;
                }
                if (autoPlayToggle) this.state.settings.autoPlay = autoPlayToggle.checked;
                if (playbackSpeedSelect) this.state.settings.playbackSpeed = parseFloat(playbackSpeedSelect.value);
                if (dataSavingToggle) this.state.settings.dataSaving = dataSavingToggle.checked;
                if (offlineModeToggle) this.state.settings.offlineMode = offlineModeToggle.checked;
                
                this.applySettings();
                this.saveAppState();
                this.showNotification('Настройки сохранены', 'success');
                this.closeSettingsModal();
            }

            closeSettingsModal() {
                const modal = document.getElementById('settingsModal');
                if (modal) {
                    modal.classList.remove('active');
                }
            }

            closeAllModals() {
                this.closeMediaModal();
                this.closeSubscriptionModal();
                this.closeSettingsModal();
                this.closeSearchModal();
                this.closePlayerModal();
            }

            closeSearchModal() {
                const modal = document.getElementById('searchModal');
                if (modal) {
                    modal.classList.remove('active');
                }
            }

            closePlayerModal() {
                const modal = document.getElementById('playerModal');
                if (modal) {
                    modal.classList.remove('active');
                }
            }

            // ==================== СИСТЕМА ЗАГРУЗКИ ====================
            hideLoadingScreen() {
                const loadingScreen = document.getElementById('loadingScreen');
                const errorScreen = document.getElementById('errorScreen');
                const app = document.getElementById('app');
                
                if (loadingScreen) loadingScreen.style.display = 'none';
                if (errorScreen) errorScreen.style.display = 'none';
                if (app) app.style.display = 'block';
            }

            showLoadingScreen() {
                const loadingScreen = document.getElementById('loadingScreen');
                if (loadingScreen) loadingScreen.style.display = 'flex';
            }

            // ==================== ЗАГЛУШКИ ДЛЯ ОСТАЛЬНЫХ СТРАНИЦ ====================
            createCoursesPage() {
                const courses = this.allContent.courses || [];
                const currentFilters = this.filters.courses;
                
                return `
                    <div class="page">
                        <div class="page-header">
                            <button class="back-btn" onclick="app.renderPage('home')">← Назад</button>
                            <h1 class="page-title">
                                <span>📚</span>
                                Все курсы
                            </h1>
                        </div>

                        <div class="content-filters">
                            <div class="filter-group">
                                <label class="form-label">Категория</label>
                                <select class="form-select" onchange="app.applyFilter('courses', 'category', this.value)">
                                    <option value="all">Все категории</option>
                                    <option value="manual_therapy" ${currentFilters.category === 'manual_therapy' ? 'selected' : ''}>Мануальная терапия</option>
                                    <option value="neurology" ${currentFilters.category === 'neurology' ? 'selected' : ''}>Неврология</option>
                                    <option value="rehabilitation" ${currentFilters.category === 'rehabilitation' ? 'selected' : ''}>Реабилитация</option>
                                </select>
                            </div>
                            
                            <div class="filter-group">
                                <label class="form-label">Уровень</label>
                                <select class="form-select" onchange="app.applyFilter('courses', 'level', this.value)">
                                    <option value="all">Все уровни</option>
                                    <option value="beginner" ${currentFilters.level === 'beginner' ? 'selected' : ''}>Начинающий</option>
                                    <option value="intermediate" ${currentFilters.level === 'intermediate' ? 'selected' : ''}>Средний</option>
                                    <option value="advanced" ${currentFilters.level === 'advanced' ? 'selected' : ''}>Продвинутый</option>
                                </select>
                            </div>
                            
                            <div class="filter-group">
                                <label class="form-label">Сортировка</label>
                                <select class="form-select" onchange="app.applyFilter('courses', 'sort', this.value)">
                                    <option value="newest" ${currentFilters.sort === 'newest' ? 'selected' : ''}>Сначала новые</option>
                                    <option value="popular" ${currentFilters.sort === 'popular' ? 'selected' : ''}>Популярные</option>
                                    <option value="rating" ${currentFilters.sort === 'rating' ? 'selected' : ''}>По рейтингу</option>
                                    <option value="price" ${currentFilters.sort === 'price' ? 'selected' : ''}>По цене</option>
                                </select>
                            </div>
                        </div>

                        <div class="content-grid">
                            ${courses.length > 0 ? courses.map(course => this.createCourseCard(course)).join('') : `
                                <div class="empty-state">
                                    <div class="empty-icon">📚</div>
                                    <div class="empty-title">Курсы не найдены</div>
                                    <div class="empty-description">Попробуйте изменить параметры фильтрации или сбросить фильтры</div>
                                    <div class="empty-actions">
                                        <button class="btn btn-primary" onclick="app.resetFilters('courses')">
                                            Сбросить фильтры
                                        </button>
                                    </div>
                                </div>
                            `}
                        </div>
                    </div>
                `;
            }

            createPodcastsPage() {
                const podcasts = this.allContent.podcasts || [];
                
                return `
                    <div class="page">
                        <div class="page-header">
                            <button class="back-btn" onclick="app.renderPage('home')">← Назад</button>
                            <h1 class="page-title">
                                <span>🎧</span>
                                Подкасты
                            </h1>
                        </div>

                        <div class="content-grid">
                            ${podcasts.length > 0 ? podcasts.map(podcast => this.createPodcastCard(podcast)).join('') : `
                                <div class="empty-state">
                                    <div class="empty-icon">🎧</div>
                                    <div class="empty-title">Подкасты не найдены</div>
                                    <div class="empty-description">Скоро здесь появятся новые выпуски подкастов</div>
                                </div>
                            `}
                        </div>
                    </div>
                `;
            }

            createStreamsPage() {
                const streams = this.allContent.streams || [];
                const liveStreams = streams.filter(s => s.isLive);
                const recordedStreams = streams.filter(s => !s.isLive);
                
                return `
                    <div class="page">
                        <div class="page-header">
                            <button class="back-btn" onclick="app.renderPage('home')">← Назад</button>
                            <h1 class="page-title">
                                <span>📹</span>
                                Эфиры и разборы
                            </h1>
                        </div>

                        ${liveStreams.length > 0 ? `
                        <div class="live-section">
                            <h2 class="section-title">
                                <span>🔴</span>
                                Прямой эфир
                            </h2>
                            <div class="content-grid">
                                ${liveStreams.map(stream => this.createStreamCard(stream)).join('')}
                            </div>
                        </div>
                        ` : ''}
                        
                        <div class="recorded-section">
                            <h2 class="section-title">
                                <span>📹</span>
                                Записи эфиров
                            </h2>
                            <div class="content-grid">
                                ${recordedStreams.length > 0 ? recordedStreams.map(stream => this.createStreamCard(stream)).join('') : `
                                    <div class="empty-state">
                                        <div class="empty-icon">📹</div>
                                        <div class="empty-title">Записей пока нет</div>
                                        <div class="empty-description">Следите за анонсами новых эфиров</div>
                                    </div>
                                `}
                            </div>
                        </div>
                    </div>
                `;
            }

            createVideosPage() {
                return `
                    <div class="page">
                        <div class="page-header">
                            <button class="back-btn" onclick="app.renderPage('home')">← Назад</button>
                            <h1 class="page-title">
                                <span>🎯</span>
                                Видеоуроки
                            </h1>
                        </div>
                        <div class="empty-state">
                            <div class="empty-icon">🎯</div>
                            <div class="empty-title">Раздел в разработке</div>
                            <div class="empty-description">Мы активно работаем над наполнением этого раздела. Скоро здесь появятся полезные видеоуроки.</div>
                            <div class="empty-actions">
                                <button class="btn btn-primary" onclick="app.renderPage('courses')">
                                    Перейти к курсам
                                </button>
                                <button class="btn btn-outline" onclick="app.renderPage('streams')">
                                    Смотреть эфиры
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            createMaterialsPage() {
                return `
                    <div class="page">
                        <div class="page-header">
                            <button class="back-btn" onclick="app.renderPage('home')">← Назад</button>
                            <h1 class="page-title">
                                <span>📋</span>
                                Материалы
                            </h1>
                        </div>
                        <div class="empty-state">
                            <div class="empty-icon">📋</div>
                            <div class="empty-title">Раздел в разработке</div>
                            <div class="empty-description">В этом разделе скоро появятся полезные материалы, презентации, статьи и методические пособия.</div>
                        </div>
                    </div>
                `;
            }

            createEventsPage() {
                const events = this.allContent.events || [];
                const upcomingEvents = events.filter(e => new Date(e.date) > new Date());
                const pastEvents = events.filter(e => new Date(e.date) <= new Date());
                
                return `
                    <div class="page">
                        <div class="page-header">
                            <button class="back-btn" onclick="app.renderPage('home')">← Назад</button>
                            <h1 class="page-title">
                                <span>🗺️</span>
                                Мероприятия
                            </h1>
                        </div>

                        ${upcomingEvents.length > 0 ? `
                        <div class="upcoming-events-section">
                            <h2 class="section-title">
                                <span>📅</span>
                                Предстоящие мероприятия
                            </h2>
                            <div class="content-grid">
                                ${upcomingEvents.map(event => this.createEventCard(event)).join('')}
                            </div>
                        </div>
                        ` : ''}
                        
                        <div class="past-events-section">
                            <h2 class="section-title">
                                <span>📚</span>
                                Прошедшие мероприятия
                            </h2>
                            <div class="content-grid">
                                ${pastEvents.length > 0 ? pastEvents.map(event => this.createEventCard(event)).join('') : `
                                    <div class="empty-state">
                                        <div class="empty-icon">🗺️</div>
                                        <div class="empty-title">Мероприятий пока нет</div>
                                        <div class="empty-description">Следите за анонсами новых событий и конференций</div>
                                    </div>
                                `}
                            </div>
                        </div>
                    </div>
                `;
            }

            createFavoritesPage() {
                const favoriteCourses = this.allContent.courses?.filter(course => this.isFavorite(course.id, 'courses')) || [];
                const favoritePodcasts = this.allContent.podcasts?.filter(podcast => this.isFavorite(podcast.id, 'podcasts')) || [];
                const favoriteStreams = this.allContent.streams?.filter(stream => this.isFavorite(stream.id, 'streams')) || [];
                const favoriteEvents = this.allContent.events?.filter(event => this.isFavorite(event.id, 'events')) || [];
                
                const totalFavorites = this.getTotalFavorites();
                
                if (totalFavorites === 0) {
                    return `
                        <div class="page">
                            <div class="page-header">
                                <button class="back-btn" onclick="app.renderPage('home')">← Назад</button>
                                <h1 class="page-title">
                                    <span>❤️</span>
                                    Избранное
                                </h1>
                            </div>
                            <div class="empty-state">
                                <div class="empty-icon">❤️</div>
                                <div class="empty-title">Пока ничего нет</div>
                                <div class="empty-description">Добавляйте курсы, подкасты и материалы в избранное, чтобы вернуться к ним позже</div>
                                <div class="empty-actions">
                                    <button class="btn btn-primary" onclick="app.renderPage('courses')">
                                        📚 Найти курсы
                                    </button>
                                    <button class="btn btn-outline" onclick="app.renderPage('materials')">
                                        📋 Посмотреть материалы
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                return `
                    <div class="page">
                        <div class="page-header">
                            <button class="back-btn" onclick="app.renderPage('home')">← Назад</button>
                            <h1 class="page-title">
                                <span>❤️</span>
                                Избранное (${totalFavorites})
                            </h1>
                        </div>

                        ${favoriteCourses.length > 0 ? `
                        <div class="favorites-section">
                            <h2 class="section-title">
                                <span>📚</span>
                                Курсы (${favoriteCourses.length})
                            </h2>
                            <div class="content-grid">
                                ${favoriteCourses.map(course => this.createCourseCard(course)).join('')}
                            </div>
                        </div>
                        ` : ''}

                        ${favoritePodcasts.length > 0 ? `
                        <div class="favorites-section">
                            <h2 class="section-title">
                                <span>🎧</span>
                                Подкасты (${favoritePodcasts.length})
                            </h2>
                            <div class="content-grid">
                                ${favoritePodcasts.map(podcast => this.createPodcastCard(podcast)).join('')}
                            </div>
                        </div>
                        ` : ''}

                        ${favoriteStreams.length > 0 ? `
                        <div class="favorites-section">
                            <h2 class="section-title">
                                <span>📹</span>
                                Эфиры (${favoriteStreams.length})
                            </h2>
                            <div class="content-grid">
                                ${favoriteStreams.map(stream => this.createStreamCard(stream)).join('')}
                            </div>
                        </div>
                        ` : ''}

                        ${favoriteEvents.length > 0 ? `
                        <div class="favorites-section">
                            <h2 class="section-title">
                                <span>🗺️</span>
                                Мероприятия (${favoriteEvents.length})
                            </h2>
                            <div class="content-grid">
                                ${favoriteEvents.map(event => this.createEventCard(event)).join('')}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                `;
            }

            createProfilePage() {
                const user = this.state.user;
                const progress = this.state.progress.overall;
                
                return `
                    <div class="page">
                        <div class="page-header">
                            <button class="back-btn" onclick="app.renderPage('home')">← Назад</button>
                            <h1 class="page-title">
                                <span>👤</span>
                                Профиль
                            </h1>
                        </div>

                        <div class="profile-header">
                            <div class="profile-info" style="display: flex; align-items: center; gap: var(--spacing-lg); margin-bottom: var(--spacing-2xl);">
                                <div class="avatar" style="width: 100px; height: 100px; background: var(--gradient-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2.5rem;">
                                    👨‍⚕️
                                </div>
                                <div class="profile-details" style="flex: 1;">
                                    <h2 style="margin-bottom: var(--spacing-xs);">${user.firstName} ${user.lastName}</h2>
                                    <p style="color: var(--text-secondary); margin-bottom: var(--spacing-sm);">${user.specialization || 'Врач-невролог'}</p>
                                    <div class="level-badge" style="display: inline-block; background: var(--gradient-primary); color: white; padding: var(--spacing-xs) var(--spacing-md); border-radius: var(--border-radius-lg); font-size: var(--font-size-sm); font-weight: 600;">
                                        ${progress.level}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="stats-cards">
                            <div class="stat-card large">
                                <div class="stat-icon">🎯</div>
                                <div class="stat-content">
                                    <div class="stat-value">${progress.completedCourses || 0}</div>
                                    <div class="stat-label">Завершено курсов</div>
                                </div>
                            </div>
                            <div class="stat-card large">
                                <div class="stat-icon">⏱️</div>
                                <div class="stat-content">
                                    <div class="stat-value">${progress.studyHours || 0}</div>
                                    <div class="stat-label">Часов обучения</div>
                                </div>
                            </div>
                            <div class="stat-card large">
                                <div class="stat-icon">📈</div>
                                <div class="stat-content">
                                    <div class="stat-value">${progress.experience || 0}</div>
                                    <div class="stat-label">Опыта (XP)</div>
                                </div>
                            </div>
                            <div class="stat-card large">
                                <div class="stat-icon">🏆</div>
                                <div class="stat-content">
                                    <div class="stat-value">${this.state.achievements.size}</div>
                                    <div class="stat-label">Достижений</div>
                                </div>
                            </div>
                        </div>

                        <div class="subscription-info-section" style="background: var(--bg-card); padding: var(--spacing-xl); border-radius: var(--border-radius-lg); margin: var(--spacing-2xl) 0; border: 1px solid var(--border-primary);">
                            <div class="active-subscription" style="display: flex; justify-content: between; align-items: center;">
                                <div class="subscription-plan-info" style="flex: 1;">
                                    <h4 style="margin-bottom: var(--spacing-xs);">${user.hasActiveSubscription ? '✅ Активная подписка' : '❌ Подписка не активна'}</h4>
                                    <p style="color: var(--text-secondary); margin-bottom: var(--spacing-sm);">
                                        ${user.hasActiveSubscription ? 
                                            `Тариф: ${user.subscription.plan} • Действует до ${this.formatDate(user.subscription.endsAt)}` : 
                                            'Получите доступ ко всем курсам и материалам Академии'
                                        }
                                    </p>
                                    ${user.hasActiveSubscription ? `
                                    <p style="color: var(--text-tertiary); font-size: var(--font-size-sm);">
                                        Автопродление: ${user.subscription.autoRenew ? 'Включено' : 'Выключено'}
                                    </p>
                                    ` : ''}
                                </div>
                                <button class="btn ${user.hasActiveSubscription ? 'btn-outline' : 'btn-primary'}" 
                                        onclick="app.showSubscriptionModal()">
                                    ${user.hasActiveSubscription ? 'Изменить подписку' : 'Активировать подписку'}
                                </button>
                            </div>
                        </div>

                        <div class="action-buttons" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: var(--spacing-md);">
                            <button class="btn btn-outline action-btn" onclick="app.renderPage('favorites')" style="display: flex; flex-direction: column; align-items: center; gap: var(--spacing-sm); padding: var(--spacing-lg);">
                                <span style="font-size: 1.5rem;">❤️</span>
                                <span>Избранное</span>
                            </button>
                            <button class="btn btn-outline action-btn" onclick="app.showSettingsModal()" style="display: flex; flex-direction: column; align-items: center; gap: var(--spacing-sm); padding: var(--spacing-lg);">
                                <span style="font-size: 1.5rem;">⚙️</span>
                                <span>Настройки</span>
                            </button>
                            <button class="btn btn-outline action-btn" onclick="app.showHelp()" style="display: flex; flex-direction: column; align-items: center; gap: var(--spacing-sm); padding: var(--spacing-lg);">
                                <span style="font-size: 1.5rem;">❓</span>
                                <span>Помощь</span>
                            </button>
                            ${this.isAdmin ? `
                            <button class="btn btn-outline action-btn" onclick="app.renderPage('admin')" style="display: flex; flex-direction: column; align-items: center; gap: var(--spacing-sm); padding: var(--spacing-lg);">
                                <span style="font-size: 1.5rem;">🔧</span>
                                <span>Админ-панель</span>
                            </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }

            createAdminPage() {
                if (!this.isAdmin) {
                    return this.createAccessDeniedPage();
                }

                return `
                    <div class="page admin-panel">
                        <div class="page-header">
                            <button class="back-btn" onclick="app.renderPage('home')">← Назад</button>
                            <h1 class="page-title">
                                <span>🔧</span>
                                Админ-панель
                            </h1>
                        </div>

                        <div class="admin-stats">
                            <div class="admin-stat">
                                <div class="admin-stat-value">${this.allContent.courses?.length || 0}</div>
                                <div class="admin-stat-label">Курсов</div>
                            </div>
                            <div class="admin-stat">
                                <div class="admin-stat-value">${this.allContent.podcasts?.length || 0}</div>
                                <div class="admin-stat-label">Подкастов</div>
                            </div>
                            <div class="admin-stat">
                                <div class="admin-stat-value">${this.allContent.streams?.length || 0}</div>
                                <div class="admin-stat-label">Эфиров</div>
                            </div>
                            <div class="admin-stat">
                                <div class="admin-stat-value">${this.allContent.events?.length || 0}</div>
                                <div class="admin-stat-label">Мероприятий</div>
                            </div>
                        </div>

                        <div class="admin-tabs">
                            <button class="admin-tab active" onclick="app.switchAdminTab('courses')">Курсы</button>
                            <button class="admin-tab" onclick="app.switchAdminTab('users')">Пользователи</button>
                            <button class="admin-tab" onclick="app.switchAdminTab('analytics')">Аналитика</button>
                            <button class="admin-tab" onclick="app.switchAdminTab('settings')">Настройки</button>
                        </div>

                        <div class="admin-content">
                            <div id="adminCoursesTab" class="tab-content active">
                                <h3>Управление курсами</h3>
                                <div class="admin-actions" style="margin-bottom: var(--spacing-lg);">
                                    <button class="btn btn-primary" onclick="app.createNewCourse()">
                                        + Создать курс
                                    </button>
                                </div>
                                <table class="admin-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Название</th>
                                            <th>Категория</th>
                                            <th>Студенты</th>
                                            <th>Рейтинг</th>
                                            <th>Действия</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${this.allContent.courses?.map(course => `
                                            <tr>
                                                <td>${course.id}</td>
                                                <td>${course.title}</td>
                                                <td>${this.getCategoryName(course.category)}</td>
                                                <td>${course.studentsCount}</td>
                                                <td>${course.rating}/5</td>
                                                <td>
                                                    <div class="admin-actions">
                                                        <button class="btn btn-small btn-primary" onclick="app.editCourse(${course.id})">Редактировать</button>
                                                        <button class="btn btn-small btn-outline" onclick="app.viewCourseStats(${course.id})">Статистика</button>
                                                    </div>
                                                </td>
                                            </tr>
                                        `).join('') || '<tr><td colspan="6">Курсы не найдены</td></tr>'}
                                    </tbody>
                                </table>
                            </div>
                            <div id="adminUsersTab" class="tab-content">
                                <h3>Управление пользователями</h3>
                                <p>Функционал управления пользователями будет добавлен в ближайшее время</p>
                            </div>
                            <div id="adminAnalyticsTab" class="tab-content">
                                <h3>Аналитика платформы</h3>
                                <p>Функционал аналитики будет добавлен в ближайшее время</p>
                            </div>
                            <div id="adminSettingsTab" class="tab-content">
                                <h3>Настройки платформы</h3>
                                <p>Функционал настроек платформы будет добавлен в ближайшее время</p>
                            </div>
                        </div>
                    </div>
                `;
            }

            createSearchPage() {
                return `
                    <div class="page">
                        <div class="page-header">
                            <button class="back-btn" onclick="app.renderPage('home')">← Назад</button>
                            <h1 class="page-title">
                                <span>🔍</span>
                                Поиск
                            </h1>
                        </div>
                        <div class="empty-state">
                            <div class="empty-icon">🔍</div>
                            <div class="empty-title">Поиск по запросу: "${this.searchTerm}"</div>
                            <div class="empty-description">Функция поиска находится в разработке. Скоро вы сможете находить любой контент на платформе.</div>
                            <div class="empty-actions">
                                <button class="btn btn-primary" onclick="app.renderPage('courses')">
                                    Искать в курсах
                                </button>
                                <button class="btn btn-outline" onclick="app.renderPage('materials')">
                                    Искать в материалах
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            createSettingsPage() {
                return `
                    <div class="page">
                        <div class="page-header">
                            <button class="back-btn" onclick="app.renderPage('home')">← Назад</button>
                            <h1 class="page-title">
                                <span>⚙️</span>
                                Настройки
                            </h1>
                        </div>
                        <div class="empty-state">
                            <div class="empty-icon">⚙️</div>
                            <div class="empty-title">Настройки приложения</div>
                            <div class="empty-description">Используйте кнопку ниже для открытия настроек приложения.</div>
                            <div class="empty-actions">
                                <button class="btn btn-primary" onclick="app.showSettingsModal()">
                                    Открыть настройки
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            createCommunityPage() {
                return `
                    <div class="page">
                        <div class="page-header">
                            <button class="back-btn" onclick="app.renderPage('home')">← Назад</button>
                            <h1 class="page-title">
                                <span>👥</span>
                                Сообщество
                            </h1>
                        </div>
                        <div class="empty-state">
                            <div class="empty-icon">👥</div>
                            <div class="empty-title">Сообщество врачей</div>
                            <div class="empty-description">Раздел сообщества находится в разработке. Скоро здесь появится возможность общаться с коллегами, задавать вопросы и делиться опытом.</div>
                        </div>
                    </div>
                `;
            }

            createCartPage() {
                return `
                    <div class="page">
                        <div class="page-header">
                            <button class="back-btn" onclick="app.renderPage('home')">← Назад</button>
                            <h1 class="page-title">
                                <span>🛒</span>
                                Корзина
                            </h1>
                        </div>
                        <div class="empty-state">
                            <div class="empty-icon">🛒</div>
                            <div class="empty-title">Корзина пуста</div>
                            <div class="empty-description">Добавьте курсы или материалы в корзину, чтобы оформить покупку</div>
                            <div class="empty-actions">
                                <button class="btn btn-primary" onclick="app.renderPage('courses')">
                                    Перейти к курсам
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            createErrorPage(message) {
                return `
                    <div class="empty-state">
                        <div class="empty-icon">⚠️</div>
                        <div class="empty-title">Ошибка</div>
                        <div class="empty-description">${message}</div>
                        <div class="empty-actions">
                            <button class="btn btn-primary" onclick="app.renderPage('home')">
                                На главную
                            </button>
                            <button class="btn btn-outline" onclick="window.location.reload()">
                                Перезагрузить
                            </button>
                        </div>
                    </div>
                `;
            }

            createNotFoundPage() {
                return `
                    <div class="empty-state">
                        <div class="empty-icon">🔍</div>
                        <div class="empty-title">Страница не найдена</div>
                        <div class="empty-description">Запрашиваемая страница не существует или была перемещена</div>
                        <div class="empty-actions">
                            <button class="btn btn-primary" onclick="app.renderPage('home')">
                                На главную
                            </button>
                        </div>
                    </div>
                `;
            }

            createAccessDeniedPage() {
                return `
                    <div class="empty-state">
                        <div class="empty-icon">🚫</div>
                        <div class="empty-title">Доступ запрещен</div>
                        <div class="empty-description">У вас недостаточно прав для просмотра этой страницы</div>
                        <div class="empty-actions">
                            <button class="btn btn-primary" onclick="app.renderPage('home')">
                                На главную
                            </button>
                        </div>
                    </div>
                `;
            }

            // ==================== ДЕТАЛЬНЫЕ СТРАНИЦЫ ====================
            createCourseDetailPage(courseId) {
                const course = this.allContent.courses?.find(c => c.id === courseId);
                if (!course) {
                    return this.createNotFoundPage();
                }

                const progress = this.state.progress.courses?.[courseId] || 0;
                const isEnrolled = progress > 0;
                const isCompleted = progress === 100;
                const modules = this.getCourseModules(courseId);
                const instructors = course.instructors.map(id => 
                    this.instructors.find(i => i.id === id)
                ).filter(Boolean);

                return `
                    <div class="page">
                        <div class="page-header">
                            <button class="back-btn" onclick="app.renderPage('courses')">← Назад к курсам</button>
                            <h1 class="page-title">${course.title}</h1>
                        </div>

                        <div class="detail-content">
                            <img src="${course.imageUrl}" alt="${course.title}" class="detail-image" 
                                 onerror="this.src='https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=600&h=300&fit=crop'">
                            
                            <div class="detail-meta">
                                <div class="detail-meta-item">
                                    <span class="icon">📊</span>
                                    <span>${this.getLevelName(course.level)}</span>
                                </div>
                                <div class="detail-meta-item">
                                    <span class="icon">⏱️</span>
                                    <span>${course.duration}</span>
                                </div>
                                <div class="detail-meta-item">
                                    <span class="icon">🎯</span>
                                    <span>${course.modules} модулей</span>
                                </div>
                                <div class="detail-meta-item">
                                    <span class="icon">👥</span>
                                    <span>${course.studentsCount} студентов</span>
                                </div>
                                <div class="detail-meta-item">
                                    <span class="icon">⭐</span>
                                    <span>${course.rating}/5</span>
                                </div>
                            </div>

                            <div class="detail-description">
                                ${course.fullDescription || course.description}
                            </div>

                            ${isEnrolled ? `
                            <div class="progress-section">
                                <div class="progress-header">
                                    <span>Ваш прогресс</span>
                                    <span>${progress}%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${progress}%"></div>
                                </div>
                            </div>
                            ` : ''}

                            <div class="detail-actions">
                                ${isEnrolled ? `
                                    <button class="btn btn-success btn-large" onclick="app.continueCourse(${courseId})">
                                        ${isCompleted ? '👁️ Повторить курс' : '🎯 Продолжить обучение'}
                                    </button>
                                ` : this.state.user?.hasActiveSubscription || course.finalPrice === 0 ? `
                                    <button class="btn btn-primary btn-large" onclick="app.enrollCourse(${courseId})">
                                        Начать обучение
                                    </button>
                                ` : `
                                    <button class="btn btn-primary btn-large" onclick="app.showSubscriptionModal()">
                                        Получить доступ
                                    </button>
                                `}
                                
                                <button class="btn btn-outline btn-large favorite-btn ${this.isFavorite(courseId, 'courses') ? 'active' : ''}" 
                                        onclick="app.toggleFavorite(${courseId}, 'courses')">
                                    ${this.isFavorite(courseId, 'courses') ? '❤️' : '🤍'} Избранное
                                </button>
                            </div>
                        </div>

                        ${modules.length > 0 ? `
                        <div class="modules-section">
                            <h2 class="section-title">
                                <span>📋</span>
                                Программа курса
                            </h2>
                            <div class="module-list">
                                ${modules.map((module, index) => `
                                    <div class="module-item" onclick="app.startModule(${courseId}, ${module.id})">
                                        <div class="module-icon">${index + 1}</div>
                                        <div class="module-content">
                                            <div class="module-title">${module.title}</div>
                                            <div class="module-description">${module.description}</div>
                                        </div>
                                        <div class="module-duration">${module.duration}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        ` : ''}

                        ${instructors.length > 0 ? `
                        <div class="instructors-section">
                            <h2 class="section-title">
                                <span>👨‍🏫</span>
                                Преподаватели
                            </h2>
                            <div class="content-grid">
                                ${instructors.map(instructor => `
                                    <div class="instructor-card">
                                        <img src="${instructor.avatarUrl}" alt="${instructor.name}" class="instructor-avatar"
                                             onerror="this.src='https://images.unsplash.com/photo-1612349317150-e413f6a5b16d?w=150&h=150&fit=crop'">
                                        <div class="instructor-info">
                                            <div class="instructor-name">${instructor.name}</div>
                                            <div class="instructor-specialization">${instructor.specialization}</div>
                                            <div class="instructor-bio">${instructor.shortBio || instructor.bio}</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                `;
            }

            createPodcastDetailPage(podcastId) {
                const podcast = this.allContent.podcasts?.find(p => p.id === podcastId);
                if (!podcast) {
                    return this.createNotFoundPage();
                }

                return `
                    <div class="page">
                        <div class="page-header">
                            <button class="back-btn" onclick="app.renderPage('podcasts')">← Назад к подкастам</button>
                            <h1 class="page-title">${podcast.title}</h1>
                        </div>

                        <div class="detail-content">
                            <img src="${podcast.imageUrl}" alt="${podcast.title}" class="detail-image">
                            
                            <div class="detail-description">
                                ${podcast.fullDescription || podcast.description}
                            </div>

                            <div class="detail-actions">
                                <button class="btn btn-primary btn-large" onclick="app.previewContent('audio', '${podcast.audioUrl}', {title: '${this.escapeHtml(podcast.title)}', cover: '${podcast.imageUrl}', id: ${podcast.id}})">
                                    ▶️ Слушать подкаст
                                </button>
                                
                                <button class="btn btn-outline btn-large favorite-btn ${this.isFavorite(podcastId, 'podcasts') ? 'active' : ''}" 
                                        onclick="app.toggleFavorite(${podcastId}, 'podcasts')">
                                    ${this.isFavorite(podcastId, 'podcasts') ? '❤️' : '🤍'} Избранное
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            createStreamDetailPage(streamId) {
                const stream = this.allContent.streams?.find(s => s.id === streamId);
                if (!stream) {
                    return this.createNotFoundPage();
                }

                const isLive = stream.isLive && stream.status === 'live';
                const isUpcoming = stream.status === 'scheduled';

                return `
                    <div class="page">
                        <div class="page-header">
                            <button class="back-btn" onclick="app.renderPage('streams')">← Назад к эфирам</button>
                            <h1 class="page-title">
                                ${isLive ? '🔴 ' : ''}${stream.title}
                            </h1>
                        </div>

                        <div class="detail-content">
                            <img src="${stream.imageUrl}" alt="${stream.title}" class="detail-image">
                            
                            <div class="detail-description">
                                ${stream.fullDescription || stream.description}
                            </div>

                            <div class="detail-actions">
                                ${!isUpcoming ? `
                                <button class="btn btn-primary btn-large" onclick="app.previewContent('video', '${stream.recordingUrl || stream.videoUrl}', {title: '${this.escapeHtml(stream.title)}', id: ${stream.id}})">
                                    ▶️ ${isLive ? 'Смотреть LIVE' : 'Смотреть запись'}
                                </button>
                                ` : `
                                <button class="btn btn-primary btn-large" onclick="app.setReminderForStream(${stream.id})">
                                    ⏰ Напомнить о начале
                                </button>
                                `}
                                
                                <button class="btn btn-outline btn-large favorite-btn ${this.isFavorite(streamId, 'streams') ? 'active' : ''}" 
                                        onclick="app.toggleFavorite(${streamId}, 'streams')">
                                    ${this.isFavorite(streamId, 'streams') ? '❤️' : '🤍'} Избранное
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            createEventDetailPage(eventId) {
                const event = this.allContent.events?.find(e => e.id === eventId);
                if (!event) {
                    return this.createNotFoundPage();
                }

                const isRegistered = this.state.progress.events?.[eventId]?.registered;
                const eventDate = new Date(event.date);
                const isUpcoming = eventDate > new Date();

                return `
                    <div class="page">
                        <div class="page-header">
                            <button class="back-btn" onclick="app.renderPage('events')">← Назад к мероприятиям</button>
                            <h1 class="page-title">${event.title}</h1>
                        </div>

                        <div class="detail-content">
                            <img src="${event.imageUrl}" alt="${event.title}" class="detail-image">
                            
                            <div class="detail-meta">
                                <div class="detail-meta-item">
                                    <span class="icon">📅</span>
                                    <span>${this.formatDate(event.date)}</span>
                                </div>
                                <div class="detail-meta-item">
                                    <span class="icon">⏰</span>
                                    <span>${this.formatTime(event.date)}</span>
                                </div>
                                <div class="detail-meta-item">
                                    <span class="icon">👥</span>
                                    <span>${event.registered} зарегистрировано</span>
                                </div>
                                ${event.location && event.type !== 'online' ? `
                                <div class="detail-meta-item">
                                    <span class="icon">📍</span>
                                    <span>${event.location}</span>
                                </div>
                                ` : ''}
                            </div>

                            <div class="detail-description">
                                ${event.fullDescription || event.description}
                            </div>

                            <div class="detail-actions">
                                ${isUpcoming ? `
                                    ${!isRegistered ? `
                                    <button class="btn btn-primary btn-large" onclick="app.registerForEvent(${eventId})">
                                        Зарегистрироваться
                                    </button>
                                    ` : `
                                    <button class="btn btn-outline btn-large" onclick="app.cancelEventRegistration(${eventId})">
                                        Отменить регистрацию
                                    </button>
                                    `}
                                ` : `
                                    <button class="btn btn-primary btn-large" onclick="app.watchEventRecording(${eventId})">
                                        Смотреть запись
                                    </button>
                                `}
                                
                                <button class="btn btn-outline btn-large favorite-btn ${this.isFavorite(eventId, 'events') ? 'active' : ''}" 
                                        onclick="app.toggleFavorite(${eventId}, 'events')">
                                    ${this.isFavorite(eventId, 'events') ? '❤️' : '🤍'} Избранное
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            // ==================== ВСПОМОГАТЕЛЬНЫЕ МЕТОДЫ ДЛЯ ДЕТАЛЬНЫХ СТРАНИЦ ====================
            getCourseModules(courseId) {
                // Демо-модули для курсов
                const modules = {
                    1: [
                        { id: 1, title: 'Введение в мануальную терапию', description: 'Основные принципы и техники безопасности', duration: '45 мин' },
                        { id: 2, title: 'Анатомия позвоночника', description: 'Строение и функции позвоночного столба', duration: '60 мин' },
                        { id: 3, title: 'Диагностика нарушений', description: 'Методы диагностики патологий позвоночника', duration: '75 мин' },
                        { id: 4, title: 'Базовые техники коррекции', description: 'Основные мануальные техники', duration: '90 мин' },
                        { id: 5, title: 'Работа с шейным отделом', description: 'Специфика работы с шейным отделом позвоночника', duration: '80 мин' },
                        { id: 6, title: 'Клинические случаи и разборы', description: 'Разбор реальных клинических случаев', duration: '120 мин' }
                    ],
                    2: [
                        { id: 1, title: 'Основы неврологии', description: 'Введение в неврологическую диагностику', duration: '50 мин' },
                        { id: 2, title: 'Неврологический осмотр', description: 'Методика проведения неврологического осмотра', duration: '65 мин' },
                        { id: 3, title: 'Инструментальная диагностика', description: 'Современные методы инструментальной диагностики', duration: '70 мин' },
                        { id: 4, title: 'Дифференциальная диагностика', description: 'Методы дифференциальной диагностики', duration: '85 мин' },
                        { id: 5, title: 'Тактика ведения пациентов', description: 'Стратегии ведения неврологических пациентов', duration: '75 мин' }
                    ]
                };
                
                return modules[courseId] || [];
            }

            // ==================== ЗАГЛУШКИ ДЛЯ ФУНКЦИОНАЛА ====================
            continueCourse(courseId) {
                this.showNotification('Переход к продолжению курса...', 'info');
                // В реальном приложении здесь будет переход к последнему пройденному модулю
            }

            enrollCourse(courseId) {
                if (!this.state.progress.courses) {
                    this.state.progress.courses = {};
                }
                this.state.progress.courses[courseId] = 0;
                this.saveAppState();
                this.showNotification('Вы успешно записаны на курс!', 'success');
                this.renderPage('courses', `course-${courseId}`);
            }

            startModule(courseId, moduleId) {
                this.showNotification(`Начинаем модуль ${moduleId} курса ${courseId}`, 'info');
                // В реальном приложении здесь будет переход к содержанию модуля
            }

            registerForEvent(eventId) {
                if (!this.state.progress.events) {
                    this.state.progress.events = {};
                }
                this.state.progress.events[eventId] = { registered: true, attended: false };
                this.saveAppState();
                this.showNotification('Вы успешно зарегистрированы на мероприятие!', 'success');
                this.renderPage('events');
            }

            cancelEventRegistration(eventId) {
                if (this.state.progress.events && this.state.progress.events[eventId]) {
                    this.state.progress.events[eventId].registered = false;
                    this.saveAppState();
                    this.showNotification('Регистрация отменена', 'info');
                    this.renderPage('events');
                }
            }

            watchEventRecording(eventId) {
                this.showNotification('Воспроизведение записи мероприятия...', 'info');
            }

            setReminderForStream(streamId) {
                this.showNotification('Напоминание установлено!', 'success');
            }

            applyFilter(contentType, filterType, value) {
                this.filters[contentType][filterType] = value;
                this.renderPage(contentType);
            }

            resetFilters(contentType) {
                this.filters[contentType] = {
                    category: 'all',
                    level: 'all',
                    price: 'all',
                    duration: 'all',
                    rating: 'all',
                    sort: 'newest',
                    search: '',
                    instructor: 'all',
                    tags: []
                };
                this.renderPage(contentType);
            }

            switchAdminTab(tabName) {
                // Скрываем все вкладки
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // Показываем выбранную вкладку
                const targetTab = document.getElementById(`admin${tabName.charAt(0).toUpperCase() + tabName.slice(1)}Tab`);
                if (targetTab) {
                    targetTab.classList.add('active');
                }
                
                // Обновляем активные кнопки табов
                document.querySelectorAll('.admin-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                event.target.classList.add('active');
            }

            createNewCourse() {
                this.showNotification('Функция создания курса в разработке', 'info');
            }

            editCourse(courseId) {
                this.showNotification(`Редактирование курса ${courseId}`, 'info');
            }

            viewCourseStats(courseId) {
                this.showNotification(`Просмотр статистики курса ${courseId}`, 'info');
            }

            showHelp() {
                this.showNotification('Раздел помощи находится в разработке', 'info');
            }

            // ==================== ИНИЦИАЛИЗАЦИЯ ДОПОЛНИТЕЛЬНЫХ КОМПОНЕНТОВ ====================
            initializeAccordions() {
                // Инициализация аккордеонов
                document.querySelectorAll('.accordion-header').forEach(header => {
                    header.addEventListener('click', () => {
                        const content = header.nextElementSibling;
                        const isOpen = content.style.display === 'block';
                        
                        content.style.display = isOpen ? 'none' : 'block';
                        header.classList.toggle('active', !isOpen);
                    });
                });
            }

            initializeTabs() {
                // Инициализация табов
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const tabName = e.target.textContent.trim();
                        this.switchTab(tabName);
                    });
                });
            }

            initializeCarousels() {
                // Инициализация каруселей
                document.querySelectorAll('.carousel').forEach(carousel => {
                    // Базовая инициализация карусели
                });
            }

            initializeLazyLoading() {
                // Инициализация ленивой загрузки изображений
                const lazyImages = document.querySelectorAll('img[data-src]');
                
                const imageObserver = new IntersectionObserver((entries, observer) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const img = entry.target;
                            img.src = img.dataset.src;
                            img.removeAttribute('data-src');
                            observer.unobserve(img);
                        }
                    });
                });
                
                lazyImages.forEach(img => imageObserver.observe(img));
            }

            switchTab(tabName) {
                this.showNotification(`Переключение на вкладку: ${tabName}`, 'info');
            }

            // ==================== УТИЛИТЫ ДЛЯ РАБОТЫ С API ====================
            async apiCall(endpoint, options = {}) {
                const url = `${this.config.API_BASE_URL}${endpoint}`;
                const defaultOptions = {
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${this.state.user?.token}`
                    }
                };
                
                try {
                    const response = await fetch(url, { ...defaultOptions, ...options });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    return await response.json();
                } catch (error) {
                    console.error('API call failed:', error);
                    throw error;
                }
            }

            // ==================== СИСТЕМА КЭШИРОВАНИЯ ====================
            getCachedData(key) {
                const cached = this.contentCache.get(key);
                if (cached && Date.now() - cached.timestamp < this.config.CACHE_TTL) {
                    return cached.data;
                }
                return null;
            }

            setCachedData(key, data) {
                this.contentCache.set(key, {
                    data,
                    timestamp: Date.now()
                });
            }

            clearCache() {
                this.contentCache.clear();
            }
        }

        // ==================== ИНИЦИАЛИЗАЦИЯ ПРИЛОЖЕНИЯ ====================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 DOM загружен, запуск приложения...');
            
            const loadingScreen = document.getElementById('loadingScreen');
            const errorScreen = document.getElementById('errorScreen');
            const appContainer = document.getElementById('app');
            const retryButton = document.getElementById('retryButton');
            
            async function initializeApp() {
                try {
                    // Показать экран загрузки
                    if (loadingScreen) loadingScreen.style.display = 'flex';
                    if (errorScreen) errorScreen.style.display = 'none';
                    if (appContainer) appContainer.style.display = 'none';
                    
                    // Имитация загрузки данных
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    
                    if (typeof AcademyApp === 'undefined') {
                        throw new Error('AcademyApp class not found');
                    }
                    
                    // Создание и инициализация приложения
                    window.app = new AcademyApp();
                    await window.app.init();
                    
                    console.log('✅ Приложение успешно инициализировано');
                    
                } catch (error) {
                    console.error('❌ Критическая ошибка инициализации:', error);
                    
                    if (loadingScreen) loadingScreen.style.display = 'none';
                    if (errorScreen) {
                        errorScreen.style.display = 'flex';
                        const errorMessage = document.getElementById('errorMessage');
                        if (errorMessage) {
                            errorMessage.textContent = error.message || 'Не удалось загрузить приложение. Пожалуйста, попробуйте позже.';
                        }
                    }
                }
            }
            
            // Обработчик кнопки повтора
            if (retryButton) {
                retryButton.addEventListener('click', function() {
                    if (errorScreen) errorScreen.style.display = 'none';
                    if (loadingScreen) loadingScreen.style.display = 'flex';
                    setTimeout(initializeApp, 500);
                });
            }
            
            // Запуск инициализации
            initializeApp();
        });
    </script>
</body>
</html>
