<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–∫–∞–¥–µ–º–∏—è –ê–ù–ë</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app">
        <header class="header">
            <h1>–ê–∫–∞–¥–µ–º–∏—è –ê–ù–ë</h1>
            <div class="admin-badge" id="adminBadge" style="display: none;">üîß –ê–¥–º–∏–Ω</div>
        </header>

        <main class="main" id="mainContent">
            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è JavaScript -->
        </main>

        <nav class="nav">
            <button class="nav-btn active" data-page="home">üè† –î–æ–º–æ–π</button>
            <button class="nav-btn" data-page="courses">üìö –ö—É—Ä—Å—ã</button>
            <button class="nav-btn" data-page="podcasts">üéß –ê–ù–ë FM</button>
            <button class="nav-btn" data-page="streams">üìπ –≠—Ñ–∏—Ä—ã</button>
            <button class="nav-btn" data-page="profile">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
        </nav>
    </div>

    <script>
        // ==================== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –°–¢–†–ê–ù–ò–¶ ====================
        const pages = {
            home: {
                title: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ê–∫–∞–¥–µ–º–∏—é –ê–ù–ë!',
                content: `
                    <div class="search">
                        <input type="text" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∫—É—Ä—Å–∞–º, –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º, —ç—Ñ–∏—Ä–∞–º..." class="search-input" id="searchInput">
                    </div>
                    
                    <div class="grid">
                        <div class="card" onclick="showContentPage('courses')">
                            <div class="card-icon">üìö</div>
                            <div>–ö—É—Ä—Å—ã</div>
                            <div class="card-count" id="coursesCount">0</div>
                        </div>
                        <div class="card" onclick="showContentPage('podcasts')">
                            <div class="card-icon">üéß</div>
                            <div>–ê–ù–ë FM</div>
                            <div class="card-count" id="podcastsCount">0</div>
                        </div>
                        <div class="card" onclick="showContentPage('streams')">
                            <div class="card-icon">üìπ</div>
                            <div>–≠—Ñ–∏—Ä—ã</div>
                            <div class="card-count" id="streamsCount">0</div>
                        </div>
                        <div class="card" onclick="showContentPage('videos')">
                            <div class="card-icon">üéØ</div>
                            <div>–í–∏–¥–µ–æ-—à–ø–∞—Ä–≥–∞–ª–∫–∏</div>
                            <div class="card-count" id="videosCount">0</div>
                        </div>
                        <div class="card" onclick="showContentPage('materials')">
                            <div class="card-icon">üìã</div>
                            <div>–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã</div>
                            <div class="card-count" id="materialsCount">0</div>
                        </div>
                        <div class="card" onclick="showContentPage('events')">
                            <div class="card-icon">üó∫Ô∏è</div>
                            <div>–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</div>
                            <div class="card-count" id="eventsCount">0</div>
                        </div>
                    </div>

                    <div class="news">
                        <h3>üì∞ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</h3>
                        <div class="content-preview" id="latestContent">
                            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                        </div>
                    </div>
                `
            },
            courses: {
                title: 'üìö –ö—É—Ä—Å—ã –ê–∫–∞–¥–µ–º–∏–∏',
                content: `
                    <div class="content-list" id="coursesList">
                        <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∫—É—Ä—Å–æ–≤...</div>
                    </div>
                `
            },
            podcasts: {
                title: 'üéß –ê–ù–ë FM - –ü–æ–¥–∫–∞—Å—Ç—ã',
                content: `
                    <div class="content-list" id="podcastsList">
                        <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–¥–∫–∞—Å—Ç–æ–≤...</div>
                    </div>
                `
            },
            streams: {
                title: 'üìπ –≠—Ñ–∏—Ä—ã –∏ –†–∞–∑–±–æ—Ä—ã',
                content: `
                    <div class="content-list" id="streamsList">
                        <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —ç—Ñ–∏—Ä–æ–≤...</div>
                    </div>
                `
            },
            profile: {
                title: 'üë§ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç',
                content: `
                    <div class="profile-header">
                        <div class="avatar">üë§</div>
                        <div class="profile-info">
                            <div class="name" id="userName">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
                            <div class="status">–ß–ª–µ–Ω –ê–∫–∞–¥–µ–º–∏–∏ –ê–ù–ë</div>
                            <div class="subscription active">–ü–æ–¥–ø–∏—Å–∫–∞: –∞–∫—Ç–∏–≤–Ω–∞</div>
                            <button class="btn" onclick="changeSubscription()">–ò–∑–º–µ–Ω–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É</button>
                        </div>
                    </div>
                `
            }
        };

        // ==================== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ö–û–ù–¢–ï–ù–¢–û–ú ====================
        let contentData = {
            courses: [], podcasts: [], streams: [], videos: [], materials: [], events: []
        };

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞
        async function loadContent() {
            try {
                const response = await fetch('/api/content');
                if (response.ok) {
                    contentData = await response.json();
                    updateContentCounts();
                    renderLatestContent();
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                    if (currentPage in contentData) {
                        renderContentPage(currentPage);
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞:', error);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π
        function updateContentCounts() {
            Object.keys(contentData).forEach(type => {
                const countElement = document.getElementById(`${type}Count`);
                if (countElement) {
                    countElement.textContent = contentData[type].length;
                }
            });
        }

        // –ü–æ–∫–∞–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        function renderLatestContent() {
            const container = document.getElementById('latestContent');
            if (!container) return;

            const allContent = Object.values(contentData).flat();
            const latestContent = allContent
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                .slice(0, 3);

            if (latestContent.length === 0) {
                container.innerHTML = '<div class="empty-state">–ü–æ–∫–∞ –Ω–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</div>';
                return;
            }

            container.innerHTML = latestContent.map(item => `
                <div class="preview-item" onclick="openContent('${item.type}', '${item.id}')">
                    <div class="preview-image">
                        ${item.photoUrl ? 
                            `<img src="${item.photoUrl}" alt="${item.title}" onerror="this.style.display='none'">` : 
                            `<div class="preview-placeholder">${getTypeIcon(item.type)}</div>`
                        }
                    </div>
                    <div class="preview-info">
                        <div class="preview-title">${item.title}</div>
                        <div class="preview-description">${item.description.substring(0, 80)}...</div>
                        <div class="preview-date">${new Date(item.createdAt).toLocaleDateString()}</div>
                    </div>
                </div>
            `).join('');
        }

        // –†–µ–Ω–¥–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
        function renderContentPage(pageType) {
            const container = document.getElementById(`${pageType}List`);
            if (!container) return;

            const content = contentData[pageType];
            const typeNames = {
                courses: '–∫—É—Ä—Å–æ–≤', podcasts: '–ø–æ–¥–∫–∞—Å—Ç–æ–≤', streams: '—ç—Ñ–∏—Ä–æ–≤',
                videos: '–≤–∏–¥–µ–æ-—à–ø–∞—Ä–≥–∞–ª–æ–∫', materials: '–º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤', events: '–º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π'
            };

            if (content.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">${getTypeIcon(pageType)}</div>
                        <div class="empty-title">–ü–æ–∫–∞ –Ω–µ—Ç ${typeNames[pageType]}</div>
                        <div class="empty-description">–ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = content.map(item => `
                <div class="content-item" onclick="openContent('${pageType}', '${item.id}')">
                    <div class="content-image">
                        ${item.photoUrl ? 
                            `<img src="${item.photoUrl}" alt="${item.title}" onerror="this.style.display='none'">` : 
                            `<div class="content-placeholder">${getTypeIcon(pageType)}</div>`
                        }
                    </div>
                    <div class="content-info">
                        <div class="content-title">${item.title}</div>
                        <div class="content-description">${item.description}</div>
                        <div class="content-meta">
                            <span class="content-date">${new Date(item.createdAt).toLocaleDateString()}</span>
                            <span class="content-type">${getTypeName(pageType)}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function getTypeIcon(type) {
            const icons = {
                courses: 'üìö', podcasts: 'üéß', streams: 'üìπ',
                videos: 'üéØ', materials: 'üìã', events: 'üó∫Ô∏è'
            };
            return icons[type] || 'üìÑ';
        }

        function getTypeName(type) {
            const names = {
                courses: '–ö—É—Ä—Å', podcasts: '–ü–æ–¥–∫–∞—Å—Ç', streams: '–≠—Ñ–∏—Ä',
                videos: '–í–∏–¥–µ–æ', materials: '–ú–∞—Ç–µ—Ä–∏–∞–ª', events: '–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ'
            };
            return names[type] || '–ö–æ–Ω—Ç–µ–Ω—Ç';
        }

        // ==================== –ù–ê–í–ò–ì–ê–¶–ò–Ø ====================
        let currentPage = 'home';

        function renderPage(page) {
            currentPage = page;
            const pageData = pages[page];
            
            if (!pageData) return;
            
            document.getElementById('mainContent').innerHTML = `
                <div class="page">
                    <h2>${pageData.title}</h2>
                    ${pageData.content}
                </div>
            `;

            // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.page === page);
            });

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            if (page in contentData) {
                renderContentPage(page);
            }
        }

        function showContentPage(contentType) {
            renderPage(contentType);
        }

        function openContent(type, id) {
            const content = contentData[type].find(item => item.id === id);
            if (content) {
                alert(`üéØ ${content.title}\n\n${content.description}\n\nüìÖ –î–æ–±–∞–≤–ª–µ–Ω–æ: ${new Date(content.createdAt).toLocaleDateString()}`);
            }
        }

        function changeSubscription() {
            alert('üí≥ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–æ–π\n\n–î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–∞ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä—É: @academy_anb');
        }

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        document.addEventListener('DOMContentLoaded', function() {
            // –ù–∞–≤–∏–≥–∞—Ü–∏—è
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    renderPage(this.dataset.page);
                });
            });

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
            loadContent();

            // –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram
            if (window.Telegram && Telegram.WebApp) {
                const user = Telegram.WebApp.initDataUnsafe.user;
                if (user) {
                    document.getElementById('userName').textContent = user.first_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                    if (user.id === 898508164) {
                        document.getElementById('adminBadge').style.display = 'block';
                    }
                }
                Telegram.WebApp.expand();
            }

            // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            setInterval(loadContent, 30000);

            console.log('‚úÖ WebApp –∑–∞–≥—Ä—É–∂–µ–Ω!');
        });
    </script>
</body>
</html>
